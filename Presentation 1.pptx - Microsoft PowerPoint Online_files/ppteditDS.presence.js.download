'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[10],{1294:function(K,U,d){d.r(U);K=d(0);var h=d(7);class e{constructor(nb,Rb){this.MPa=null;this.uXb=nb;this.u4h=Rb}init(){this.uXb.continueWith(()=>{this.MPa=this.uXb.result;this.MPa.Osb(Object(h.a)(this,this.n1,"onUsersUpdated"))})}n1(){e.$Cf(this.MPa.D$a())&&(this.MPa.MVe(Object(h.a)(this,this.n1,"onUsersUpdated")),this.u4h.IsRealCoauthSession=!0)}static $Cf(nb){let Rb=null;for(const mb of nb)if(mb)if(nb=mb.isAnonymous||
!mb.email?mb.clientId:mb.email.toUpperCase(),!Rb)Rb=nb;else if(Rb!==nb)return!0;return!1}}Object(K.a)(e,"CoauthTelemetry",null,[1110]);var r=d(392),m=d(1095),n=d(1244),z=d(27),v;(function(nb){nb[nb.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";nb[nb.notImplemented=1]="notImplemented";nb[nb.renderHandled=2]="renderHandled";nb[nb.renderHandledWithVeto=3]="renderHandledWithVeto"})(v||(v={}));Object(K.b)("CoauthorGalleryTelemetryEndResult",v);var x=d(96),B=d(105),D=d(3);class w{constructor(nb,
Rb,mb,Ub,zc,Pc,Mc,ld,vb){this.Lpf=this.fdf=this.XK=null;this.hqa=nb;this.EGc=new m.a;this.Oa=mb;this.ACd=Rb;this.j7=Ub;this.pi=zc;this.$Ld=Pc;this.HPa=Mc;this.kUh=ld;this.Mhf=this.Jhf=!1;this.oHc=0;this.cdf=1;this.K3a=vb;this.JZb=this.Oa.ka("PeoplesWellExtraButtonInfoIsEnabled");this.GNa=Object(n.a)(String,z.AFrameworkApplication.Od.Application)||""}get eFh(){return this.EGc.task}init(){D.Task.WAA.call(null,this.HPa,this.ACd,this.$Ld).continueWith(()=>{this.XK=this.HPa.result;this.fdf=this.ACd.result;
this.Lpf=this.$Ld.result;D.Task.WAA.call(null,this.ACd.result.iDa,this.$Ld.result.wwd).continueWith(()=>{this.cdf=this.fdf.iDa.result;this.oHc=this.Lpf.wwd.result;this.XK.Osb(Object(h.a)(this,this.lkd,"onUsersUpdatedEventListener"));this.XK.D$a().length&&this.n1()})})}lkd(){this.n1()}n1(){this.kUh(this.XK.D$a())?(this.XK.MVe(Object(h.a)(this,this.lkd,"onUsersUpdatedEventListener")),this.dDk(this.Jhf)):this.EGc.uK(1);this.Jhf=!0}dDk(nb){this.Mhf?this.eFh.continueWith(()=>{r.ULS.sendTraceTag(42062996,
325,15,"We already attempted to log a render of coauthor gallery: {0}",v[this.eFh.result])}):(this.Mhf=!0,this.PUk(0===this.cdf&&!nb))}PUk(nb){nb?this.j7.Mj(4,Object(h.a)(this,this.mMe,"onInteractiveReady")):this.EGc.uK(1)}mMe(){const nb=this.pi.Tg("AppInitStatus_interactivityReady");r.ULS.shipAssertTag(42259235,325,!!this.oHc);const Rb=this.oHc-nb,mb={};mb.InteractiveTime=nb;mb.ReactRenderComplete=this.oHc;mb.HadTabSwitch=this.K3a();mb.IsModernGallery=this.JZb;r.ULS.sendTraceTag(594883104,325,50,
B.a.toJSON(mb));this.JZb?(r.ULS.sendTraceTag(42062997,325,15,Rb.toString()),this.EGc.uK(this.pTl(Rb)?3:2)):r.ULS.sendTraceTag(594883103,325,15,Rb.toString())}pTl(nb){const Rb=nb>this.Oa.wc("CoauthorGalleryTimeToRenderDurationMs",1E4),mb="Word"===this.GNa;if(this.K3a())return r.ULS.sendTraceTag(50455714,325,50,Rb.toString()),!1;mb&&x.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);Rb&&(mb&&x.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded",
"CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),r.ULS.sendTraceTag(42062998,325,15,nb.toString()));return Rb}}Object(K.a)(w,"CoauthorGalleryTelemetry",null,[1104]);class J{constructor(nb){this.XK=null;this.izc={};this.OEc={};this.eVb=null;this.HPa=nb}JWc(nb){const Rb=new m.a;this.init().continueWith(()=>{nb in this.izc?Rb.uK(this.izc[nb]):this.OEc[nb]=Rb});return Rb.task}init(){if(this.eVb)return this.eVb.task;this.eVb=new m.a;this.HPa.continueWith(()=>{this.XK=this.HPa.result;this.XK.Osb(Object(h.a)(this,
this.n1,"onUsersUpdated"));this.nOh();this.eVb.Og(null)});return this.eVb.task}nOh(){const nb=this.XK.D$a();nb.sort(Object(h.a)(this,this.QDi,"comparePresenceUsers"));this.izc={};for(let Rb=0;Rb<nb.length&&nb[Rb]&&nb[Rb].yGa;Rb++)this.ldi(this.izc,nb[Rb].clientId,Rb)}ldi(nb,Rb,mb){nb[Rb]=mb;Rb in this.OEc&&(this.OEc[Rb].uK(mb),delete this.OEc[Rb])}n1(){this.nOh()}QDi(nb,Rb){return nb.yGa>Rb.yGa?1:nb.yGa<Rb.yGa?-1:0}}Object(K.a)(J,"CoauthorPositionFinder",null,[1105]);var G=d(1247),M=d(1246),N=d(1245),
R=d(18),C=d(106);class O{constructor(){this.Tia=null;this.wSb=Array(32)}xor(nb){if(!nb)throw Error.argumentNull("Guid argument cannot be null");const Rb=new O,mb=new Sys.StringBuilder;for(let Ub=0;Ub<nb.wSb.length;Ub++){const zc=this.wSb[Ub]^nb.wSb[Ub];Rb.wSb[Ub]=zc;mb.append(zc.toString(16));7!==Ub&&11!==Ub&&15!==Ub&&19!==Ub||mb.append("-")}Rb.Tia=C.a.Jf(mb.toString());return Rb}toString(){return this.Tia.toString()}equals(nb){if(!nb)throw Error.argumentNull("Guid argument cannot be null");return this.Tia.equals(nb.Tia)}static KTc(nb){if(!nb)throw Error.argumentNull("String input cannot be null");
const Rb=new O;Rb.Tia=C.a.Jf(nb);const mb=Rb.Tia.toString();let Ub=0;for(let Pc=0;Pc<mb.length;Pc++){var zc=nb.charAt(Pc);if(O.SXj(zc))zc=O.xIj(zc,nb.charCodeAt(Pc)),Rb.wSb[Ub++]=zc;else if(!O.jXj(zc))throw Error.argument("String contains characters not valid in Guids");}return Rb}static SXj(nb){return"0"<=nb&&"9">=nb||"A"<=nb&&"F">=nb||"a"<=nb&&"f">=nb}static jXj(nb){return"{"===nb||"}"===nb||"-"===nb}static xIj(nb,Rb){if("0"<=nb&&"9">=nb)return Rb-48;if("A"<=nb&&"F">=nb)return Rb-65+10;if("a"<=
nb&&"f">=nb)return Rb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(K.a)(O,"Guid",null,[]);class S{constructor(nb,Rb,mb,Ub){this.MPa=null;this.Zdf=this.Nnf=!1;this.Zlf=0;this.uXb=nb;this.APd=Rb;this.Oa=mb;this.mKd=Ub;this.TTh=z.AFrameworkApplication.Anb||z.AFrameworkApplication.ZQ;this.Jmf=new G.a(M.a.Ml())}get h2d(){return this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.uXb.continueWith(()=>{this.MPa=this.uXb.result;
this.MPa.Osb(Object(h.a)(this,this.n1,"onUsersUpdated"))})}n1(){this.TCi(this.MPa.D$a())}TCi(nb){var Rb=0;const mb=new N.a(M.a.Ml());for(const Ub of nb)if(Ub&&Ub.isAnonymous){z.AFrameworkApplication.dma("70eb6120;2gfeb930");if(mb.Fb(Ub.userName))mb.ga(Ub.userName).add(Ub.clientId);else{let zc;mb.add(Ub.userName,(zc=new R.a,zc.add(Ub.clientId),zc))}Ub.clientId!==this.mKd?(Rb++,2<=Rb&&!this.Nnf&&this.eck()):!this.Zdf&&this.h2d&&"Guest"===Ub.userName&&(r.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),
this.Zdf=!0)}if(this.h2d&&this.Zlf!==Rb){r.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",Rb+(this.TTh?1:0));this.Zlf=Rb;for(let Ub of mb.keys)2<=mb.ga(Ub).count&&(nb=this.$fj(mb.ga(Ub)),this.Jmf.contains(nb)||(Rb={},Rb.guestsWithSameName=mb.ga(Ub).count,Rb.identifier=nb,r.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Rb),this.Jmf.add(nb)))}}eck(){r.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.Nnf=!0;this.h2d&&
this.APd&&this.APd.continueWith(()=>{window.setTimeout(()=>{this.APd.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}$fj(nb){if(!nb||1>=nb.count)return"";let Rb=O.KTc(nb.ga(0));for(let mb=1;mb<nb.count;mb++)Rb=Rb.xor(O.KTc(nb.ga(mb)));return Rb.toString()}}Object(K.a)(S,"GuestCoauthTelemetry",null,[]);var T=d(1243);class ca{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(K.a)(ca,"PL",null,[]);var L=d(36);class da{constructor(){this.ct=
this.vt=this.d=0}static Evh(nb,Rb,mb){const Ub=new da;Ub.d=nb;Ub.vt=Rb;Ub.ct=mb;return L.c(Ub)}}Object(K.a)(da,"VD",null,[]);var Z=d(89);class fa{constructor(nb,Rb,mb,Ub,zc,Pc,Mc,ld,vb,cc,Hc){this.Qsf=!1;this._id=nb;this.Kj=Rb;this.Gtf=mb;this.Pt=Ub;this.nKd=zc;this.cQd=Pc;this.d7a=Mc;this.d4a=ld;this.BVh=vb;this.K3a=cc;this.cvf=Hc;this.GNa=Object(n.a)(String,z.AFrameworkApplication.Od.Application)||""}kzd(nb){const Rb=[this.nKd,this.cQd];this.cvf&&Rb.push(this.Gtf);D.Task.WAA.apply(null,Rb).continueWith(()=>
{if(this.nKd.result<=this.cQd.result)nb.uK(!1);else{this.cvf&&(this.Kj=this.Gtf.result);var mb=this.Pt-this.Kj,Ub=new ca;Ub.id=this._id;Ub.et=this.Pt;Ub.st=this.Kj;Ub.d=this.Pt-this.Kj;Ub.mp=this.nKd.result;Ub.tp=this.cQd.result;Ub.ct=this.pcj(this.BVh);Ub.vc=this.K3a();var zc=L.c(Ub),Pc="Word"===this.GNa,Mc="PowerPoint"===this.GNa;r.ULS.sendTraceTag(42078597,302,15,zc);if(Pc){const ld=new Map;ld.set("data",zc);x.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",ld)}mb>
this.d7a.value&&!this.Qsf&&!Ub.vc&&(this.Qsf=!0,nb.uK(!0),Ub=Object.assign(new Z.a,{inStaging:!0,extendedProperties:new Map}),Ub.extendedProperties.set("data",zc),Pc&&x.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Ub),mb<this.d4a.value&&(r.ULS.sendTraceTag(42078598,302,15,da.Evh(mb,this.d7a.value,this.d4a.value)),mb=z.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),
Mc&&mb&&x.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],!1,!0,!0,!1,Ub)));nb.task.isCompleted||nb.uK(!1)}})}pcj(nb){switch(nb){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(K.a)(fa,"PresenceLatencyActivityLogger",null,[]);class aa{constructor(nb,Rb,mb){this.Bcf=this.bdf=this.Xyc=this.hzc=this.fob=0;this._id=nb;this.d7a=Rb;this.d4a=mb;this.GNa=Object(n.a)(String,z.AFrameworkApplication.Od.Application)||
""}get xAf(){return this.fob}set xAf(nb){this.fob=nb;this.wYd()}get qLf(){return this.hzc}set qLf(nb){this.hzc=nb;this.wYd()}get DIf(){return this.Xyc}set DIf(nb){this.Xyc=nb;this.wYd()}get rLf(){return 0!==this.bdf}get EIf(){return 0!==this.Bcf}wYd(){!this.rLf&&this.fob&&this.hzc&&(this.bdf=this.kzd(this.hzc,"CoauthGalleryLightupDurationTooLong"));!this.EIf&&this.fob&&this.Xyc&&(this.Bcf=this.kzd(this.Xyc,"CanvasPresenceLightupDurationTooLong"))}kzd(nb,Rb){const mb=nb-this.fob;var Ub=new ca;Ub.id=
this._id;Ub.et=nb;Ub.st=this.fob;Ub.d=mb;var zc=L.c(Ub),Pc="Word"===this.GNa;nb="PowerPoint"===this.GNa;Ub="CanvasPresenceLightupDurationTooLong"===Rb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===Rb?r.ULS.sendTraceTag(572289499,302,15,zc):r.ULS.sendTraceTag(571524118,302,15,zc);if(Pc){var Mc=new Map;Mc.set("data",zc);x.Health.instance.recordKpiUsage(Ub,0,"wordcollabrel",Mc)}return mb>this.d7a.value?(Mc=Object.assign(new Z.a,{inStaging:!0,
extendedProperties:new Map}),Mc.extendedProperties.set("data",zc),zc=mb<this.d4a.value,Mc.extendedProperties.set("cash",zc?"true":"false"),Pc&&x.Health.instance.recordKpiFailure(Ub,Rb,!1,!0,Mc),Pc=z.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientRenderLatencyQoSError"),nb&&Pc&&x.Health.instance.recordQosError(Rb,[Ub],!1,!0,!0,!1,Mc),r.ULS.sendTraceTag(572289500,302,15,da.Evh(mb,this.d7a.value,this.d4a.value)),zc?2:1):3}}Object(K.a)(aa,"PresenceLightupLatencyLogger",
null,[]);var ja=d(285),I=d(279);class sa{constructor(nb,Rb,mb,Ub,zc,Pc,Mc,ld=null,vb=null,cc=null){this.sqf={};this.zCd={};this.blf=new R.a;this.Gyc=this.fVb=this.XK=this.hYb=null;this.bPd=this.aPd=0;this.d7a=new T.a(()=>ld.CQ("PresenceBootLatencyThreshold",1E4));this.d4a=new T.a(()=>ld.CQ("PresenceBootLatencyCutoffThreshold",6E4));this.x$h=new T.a(()=>ld.CQ("PresenceLightupLatencyThreshold",2E3));this.KWh=new T.a(()=>ld.CQ("PresenceLightupLatencyCutoffThreshold",1E4));this.j7=Ub;this.Oa=ld;this.x4h=
zc;this.ddf=nb;this.Vrf=Rb;this.HPa=mb;this.pi=Pc;this.mKd=vb;this.K3a=Mc;this.Ohf=cc;this.CBd=!1;this.init()}aZi(nb,Rb=0){var mb=new Date;const Ub=new m.a;this.init().continueWith(()=>{this.cGk(nb);this.bZi(Ub,nb,mb,Rb)})}get xJe(){return this.mKd||"{"+z.AFrameworkApplication.userSessionId+"}"}init(){if(this.fVb)return this.fVb.task;this.fVb=new m.a;this.K3a()&&r.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.ddf.continueWith(()=>{const nb=this.ddf.result,Rb=nb.iDa,mb=nb.ygd;mb.continueWith(()=>
{Rb.continueWith(()=>{this.Ohf&&this.Ohf.addQosPillar("RealTimeCoauth");this.eBl(Rb.result,mb.result);this.fVb.Og(null)})})});this.Vrf.continueWith(()=>{this.hYb=this.Vrf.result;this.hYb.v7a(Object(h.a)(this,this.VGk,"onRtcConnection"));this.hYb.ECa(Object(h.a)(this,this.HBk,"onCoauthorBootReceived"))});this.HPa.continueWith(()=>{this.XK=this.HPa.result;this.XK.Osb(Object(h.a)(this,this.lkd,"onUsersUpdatedEventListener"));0<this.XK.D$a().length&&this.n1()});return this.fVb.task}$4f(){return this.pi.Zn(ja.a.znb)?
this.pi.Tg(ja.a.znb):I.a.QCa?window.performance.timing.fetchStart:-1}n8f(){this.Gyc||(this.Gyc=new m.a,this.j7.Mj(4,()=>{this.Gyc.uK(this.pi.Tg("AppInitStatus_interactivityReady"))}));return this.Gyc.task}VGk(nb,Rb){if(!this.CBd&&2===Rb.newState)if(this.Nyd){const mb=this.n8f();mb.continueWith(()=>{var Ub=mb.result;Ub=Date.now()-Ub;const zc={};zc.clientId=this.xJe;zc.bootTime=Ub;this.CBd=!0;this.hYb.Xaa(15,zc)})}else nb=this.$4f(),nb=Date.now()-nb,Rb={},Rb.clientId=this.xJe,Rb.bootTime=nb,this.CBd=
!0,this.hYb.Xaa(15,Rb)}HBk(nb,Rb){if(15===Rb.type){nb=Date.now();Rb=Rb.jAa;var mb=Rb.bootTime;this.Kae(Rb.clientId).xAf=nb-mb}}lkd(){this.n1()}n1(){const nb=Date.now();var Rb=this.XK.D$a();const mb=new R.a;for(const Ub of Rb)this.blf.contains(Ub.clientId)||(this.blf.add(Ub.clientId),mb.add(Ub.clientId));if(0<mb.count)for(let Ub of mb)Rb=this.Kae(Ub),Rb.rLf||(Rb.qLf=nb)}cGk(nb){nb=this.Kae(nb);nb.EIf||(nb.DIf=Date.now())}Kae(nb){return nb in this.zCd?this.zCd[nb]:this.zCd[nb]=new aa(nb,this.x$h,this.KWh)}eBl(nb,
Rb=0){this.aPd=nb;this.bPd=Rb?Rb:(new Date).getTime()}bZi(nb,Rb,mb,Ub){mb=mb?mb.getTime():(new Date).getTime();if(Rb in this.sqf)nb.f2();else{const zc=this.Nyd?0:this.etj(),Pc=this.Nyd?this.ftj():null;Ub=new fa(Rb,zc,Pc,mb,this.JWc(this.xJe),this.JWc(Rb),this.d7a,this.d4a,Ub,this.K3a,this.Nyd);this.sqf[Rb]=Ub;Ub.kzd(nb)}}etj(){return 1===this.aPd?this.bPd:this.$4f()}ftj(){return 1===this.aPd?D.Task.qt(this.bPd):this.n8f()}JWc(nb){return this.x4h.JWc(nb)}get Nyd(){return this.Oa.ka("UseAppInteractiveBootTimeForPresenceTelemetry")}}
Object(K.a)(sa,"PresenceBootTelemetry",null,[1103]);var ka=d(182),Ma=d(71),Ea=d(353),ma=d(56),va=d(252);class Ca{get name(){return"Common.App.CoauthTelemetry"}Yb(nb){nb.register(e,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").ma().oa(()=>new e(va.a.Lt(nb.Ia("Common.IPeopleInfoProvider")),z.AFrameworkApplication.Rg));nb.register(w,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").ma().oa(()=>new w(z.AFrameworkApplication.Ra,
va.a.Lt(nb.Ia("Common.ICoauthoringTelemeryInfoProvider")),z.AFrameworkApplication.fa,ka.a.get_instance(),Ea.a.instance,va.a.Lt(nb.Ia("Common.IPeoplesWell")),va.a.Lt(nb.Ia("Common.IPeopleInfoProvider")),e.$Cf,()=>this.hFf()));nb.register(sa,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").ma().oa(()=>new sa(va.a.Lt(nb.Ia("Common.ICoauthoringTelemeryInfoProvider")),va.a.Lt(nb.Ia("Common.IRealtimeChannelBasic")),va.a.Lt(nb.Ia("Common.IPeopleInfoProvider")),
ka.a.get_instance(),nb.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Ea.a.instance,()=>this.hFf(),z.AFrameworkApplication.fa,null,x.Health.instance));nb.register(J,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").ma().oa(()=>new J(va.a.Lt(nb.Ia("Common.IPeopleInfoProvider"))));nb.register(S,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").ma().oa(()=>new S(va.a.Lt(nb.Ia("Common.IPeopleInfoProvider")),va.a.Lt(nb.Ia("Common.ISystemInitiatedFeedback")),
z.AFrameworkApplication.fa,"{"+z.AFrameworkApplication.userSessionId+"}"))}init(){z.AFrameworkApplication.fa.ff(()=>{ma.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();ma.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();z.AFrameworkApplication.fa.ka("CoauthorGalleryTelemetryIsEnabled")&&ma.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();z.AFrameworkApplication.fa.ka("CashTelemetryIsEnabled")&&(ma.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),
ma.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}hFf(){return I.a.QCa&&Ea.a.instance.Zn(ja.a.pxc)?0<Ea.a.instance.Tg(ja.a.pxc)[ja.a.ozd]:!1}static main(){Ma.a.instance.Ac(new Ca)}}Object(K.a)(Ca,"CoauthTelemetryPackage",null,[2,3]);var oa=d(265),Da=d(1249),ta=d(249),ha=d(477);class Ha{constructor(nb,Rb,mb,Ub,zc){this.Yc=nb;this._clientId=Rb;this.mXh=zc;this.mZh=mb||(()=>null);this.nZh=Ub||(()=>null)}get id(){return this.Yc.id}get gIc(){return this.Yc.gIc}get kIc(){return this.Yc.kIc}get jIc(){return this.Yc.jIc}get iIc(){return this.Yc.iIc}get hIc(){return this.Yc.hIc}get mIc(){return this.Yc.mIc}get HRd(){return this.Yc.HRd}get TOb(){return this.Yc.TOb}get Aud(){return this.Yc.Aud}get Ugd(){return this.Yc.Ugd}get clientId(){return this._clientId}get pua(){return this.mZh}get i4(){return this.nZh}get iVi(){return this.mXh}static createInstance(nb,
Rb,mb,Ub,zc=!1){return new Ha(nb,Rb,mb,Ub,zc)}}Object(K.a)(Ha,"PeoplesWellSettings",null,[]);var bb=d(28);class Na{constructor(nb){this.Ej=nb}get iDa(){return this.Ej.iDa}get ygd(){return this.Ej.ygd}}Object(K.a)(Na,"CoauthoringTelemetryInfoProvider",null,[601]);var Ia=d(675),Qa=d(77),qa=d(121),Wa=d(796),Hb=d(584);class jc{constructor(nb,Rb,mb,Ub,zc){this.GHb=new Qa.a;this.Fz=null;this.Ej=nb;this.mgb=mb;this.CJ=Ub;this.CJ.XSd(Object(h.a)(this,this.pid,"onEditorTableUpdate"));this.Ygk=z.AFrameworkApplication.fa.ka("PeoplesWellExtraButtonInfoIsEnabled");
this.wEe=zc;Rb&&Rb.execute(Pc=>{this.Fz=Pc})}dispose(){this.GHb&&(qa.a.Jqd([this.GHb]),this.GHb=null);this.CJ.roh(Object(h.a)(this,this.pid,"onEditorTableUpdate"))}Osb(nb){this.GHb.addHandler("UsersUpdatedEvent",nb)}MVe(nb){this.GHb.removeHandler("UsersUpdatedEvent",nb)}D$a(){return this.K3f(!1)}gaj(){return this.K3f(!0)}K3f(nb){const Rb=[];this.Ej.jnb(this.Ej.AD).returnValue||bb.a.J(512497499,814,50,"PeopleInfoProvider::GetAllUsers - current editor({0}) missing in editortable",this.Ej.AD);var mb=
null;this.Fz&&(mb=this.Fz.ZTc());const Ub=this.wEe.F6f();let zc=!1;for(const Pc of this.Ej.v_)nb&&jc.qKc(Ub,Pc.EmailAddress)?zc=!0:Array.add(Rb,this.ANi(Pc,mb));mb={};mb.fExcludeCurrent=nb;mb.fCurrentExcluded=zc;mb.CurrentID=this.Ej.AD;mb.EditorCount=this.Ej.v_.length;mb.IsRtcNull=!this.Fz;mb.UserCount=Rb.length;bb.a.J(512497498,814,50,"PeopleInfoProvider::GetAllUsers:{0}",L.c(mb));return Rb}ANi(nb,Rb){const mb=this.mgb.oua(new Ia.a(nb.EmailAddress,void 0,nb.Name),nb.ID,1),Ub=new Wa.a;Ub.r1a(0);let zc=
0,Pc=!1,Mc=!1;if(Rb&&nb.ID in Rb){Ub.r1a(1);if(this.Ygk){const ld=Rb[nb.ID];ld&&ld.capabilities&4&&Ub.r1a(4);Pc=!0;ld&&(zc=ld.capabilities,Mc=ld.isAnonymous)}delete Rb[nb.ID]}bb.a.J(512497495,814,50,"PeopleInfoProvider::GetAllUsers; ClientId: {0}; Color: {1}; PresenceCapabilityHasFlagRealTimeChannel: {2}; PresenceCapabilityHasFlagSupportsChat: {3}; MyClientId: {4}; IsEmailAddressEmpty: {5}; rtcCapabilities: {6}; fIssuserinrtc: {7}; isAnonymous: {8}",nb.ID,mb,Ub.dea(1),Ub.dea(4),this.Ej.AD,!nb.EmailAddress,
zc,Pc,Mc);return new Hb.a(nb.ID,nb.Name,mb,Ub,null,nb.EmailAddress,void 0,void 0,Mc,void 0,void 0,nb.JoinCoauthTime)}pid(){bb.a.J(512497494,814,50,"PeopleInfoProvider::OnEditorTableUpdate");this.GHb.raiseEvent("UsersUpdatedEvent",this)}static qKc(nb,Rb){return!!nb&&!!Rb&&nb.toLowerCase()===Rb.toLowerCase()}}Object(K.a)(jc,"PeopleInfoProvider",null,[1088]);var gc=d(82),$b=d(209),wb=d(131),Db=d(319),Xb=d(272);class ab extends $b.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=
null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(K.a)(ab,"PeopleButtonProps",$b.a,[]);var Ab=d(779),rc=d(47),tb=d(72);class Za{constructor(nb){this.sxc=new tb.a;this.f2d=null;this.clientId=nb}Apl(nb){this.s5k();this.akl(nb);for(const Rb of nb)Rb.clientId!==this.clientId&&this.Jyf(Rb)}get Uyd(){const nb=[];for(let Rb of this.sxc.values){const mb=this.Suh(Rb);Array.add(nb,mb)}return nb}get Exa(){return this.sxc.count}QSd(nb,Rb){nb=nb.toUpperCase();let mb;({value:mb}=
this.sxc.wg(nb)).returnValue||(mb=[],this.sxc.$(nb,mb));Array.add(mb,Rb)}s5k(){this.sxc=new tb.a}akl(nb){for(const Rb of nb)if(Rb.clientId===this.clientId){this.f2d=Rb;break}}}Object(K.a)(Za,"UserTracker",null,[1703]);class fb extends Za{constructor(nb,Rb){super(nb);this.oZh=Rb}Jyf(nb){nb.isAnonymous||!nb.email?this.QSd(nb.clientId,nb):this.f2d&&M.a.Ml().equals(this.f2d.email,nb.email)||this.QSd(nb.email,nb)}Suh(nb){let Rb=new Date(0),mb=0<nb.length?nb[0]:null;for(const Ub of nb)(nb=this.oZh(Ub.clientId))&&
Rb.getTime()<nb.nCb.getTime()&&(Rb=nb.nCb,mb=Ub);return mb}}Object(K.a)(fb,"UniqueUserTracker",Za,[]);class ac extends Za{constructor(nb){super(nb)}Jyf(nb){this.QSd(nb.clientId,nb)}Suh(nb){return nb[0]}}Object(K.a)(ac,"UserInstanceTracker",Za,[]);const Dc=(nb,Rb,mb)=>mb?new fb(nb,Rb):new ac(nb);var Sc=d(73),xb=d(679),Ta=d(37);class ib{constructor(nb,Rb=null,mb=null){this.XK=null;this.gQd=new m.a;this.Yc=nb;this.old=Rb;mb&&mb.continueWith(()=>{this.XK=mb.result;this.XK.Osb(Object(h.a)(this,this.n1,
"onUsersUpdated"));this.vod()});new Hb.a(this.settings.clientId,"Anonymous user","#cccccc",new Wa.a(7));this.l1c=this.kId=!0;this.MFd=this.ZLd=!1;this.l2=Dc(this.settings.clientId,this.settings.i4,nb.iVi)}get settings(){return this.Yc}get wUj(){return z.AFrameworkApplication.fa?z.AFrameworkApplication.fa.ka("ColorPresenceHashIsEnabled"):!1}get Kmg(){return z.AFrameworkApplication.fa?z.AFrameworkApplication.fa.ka("PeoplesWellExtraButtonInfoIsEnabled"):!1}Mdj(){let nb;let Rb,mb,Ub,zc;var Pc=this.Ndj();
this.l2.Exa?1===this.l2.Exa?(Rb=!0,mb=this.settings.TOb.cluster,Ub=this.settings.TOb.VOc,zc=this.l2.Uyd[0].color):(Rb=!0,mb=this.settings.Ugd.cluster,Ub=this.settings.Ugd.VOc,zc=""):(Rb=!1,zc=Ub=mb="");nb=Pc[0];Pc=Pc.slice(1);return{sKk:nb,tKk:Pc,oKk:Rb,YXl:mb,qKk:Ub,pKk:zc}}Ndj(){if(2<=this.l2.Exa)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.l2.Exa)];if(1===this.l2.Exa){const nb=this.l2.Uyd[0],Rb=this.settings.i4(nb.clientId);return Rb&&2===Rb.status?
[CommonUIStrings.l_PeoplesWellStateUserIsInactive,nb.userName]:[nb.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,nb.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}uwj(nb){return this.vwj(nb)}YHf(nb,Rb,mb){return Rb?this.Zwi(Rb)?(nb=this.settings.i4(nb))&&2===nb.status?!1:!0:(mb&&r.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(mb&&r.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),
!1)}ktj(nb){return nb.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}vwj(nb){if(!nb.capabilities.dea(1))return this.ktj(nb);const Rb=nb.isReadOnly,mb=this.settings.i4(nb.clientId);nb=this.settings.pua(nb.clientId);if(!mb)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(mb.status){case 1:return nb?Rb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.xIi(nb)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:
CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}Pij(nb){if(this.old.x3c)return this.old.Fvb(nb.email,"O365",z.AFrameworkApplication.gh,0)}iwj(nb){nb=this.settings.i4(nb.clientId);return!nb||nb&&1===nb.status?!0:!1}jwj(nb){var Rb=String.format("buttonPeoplesWellUser-{0}",nb.clientId),mb=nb.clientId,Ub=this.uwj(nb);const zc=nb.userName,Pc=nb.color;var Mc=Object,
ld=Mc.assign,vb=new ab,cc=this.settings.mIc.toString(),Hc=this.settings.Aud.cluster,Pb=this.settings.Aud.VOc,Uc=this.s6f(),sc=nb.isAnonymous,lb;if(lb=[zc],lb.length){var Zb=new Sys.StringBuilder("STRARRY@");for(const Oc of lb)Zb.append(Oc?Oc.length:0),Zb.append(","),Zb.append(Oc),Zb.append(",");lb=Zb.toString().slice(0,-1)}else lb=null;Rb=ld.call(Mc,vb,{Id:Rb,Command:cc,LabelText:"{0}",Image32by32:Hc,Image32by32Class:Pb,MenuItemId:mb,CommandValueId:mb,Alt:zc,DisplayMode:Uc,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",
Description:Ub,ImageBackColor:Pc,IsAnonymous:sc,LabelTextUserGeneratedPlaceholderReplacements:lb,Upn:nb.email});z.AFrameworkApplication.fa.ka("PeoplesWellExtraButtonInfoIsEnabled")&&this.old&&(mb=this.Pij(nb),Ub=this.iwj(nb),Rb.ImageUrl=mb,Rb.ActiveStatus=Ub,Rb.JoinTimeInMS=nb.yGa,nb=this.YHf(nb.clientId,this.settings.pua(nb.clientId),!1),Rb.CanJump=nb,""===mb&&r.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return Rb}aij(){return Object.assign(new $b.a,{Id:"BasicChat",Command:"2288458806",
LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}s6f(){return this.wUj?"Initials":"Menu32"}kwj(nb){const Rb=[];for(const mb of nb)nb=this.jwj(mb),Array.add(Rb,nb);return Rb}Sme(){return 0<this.l2.Exa}UWk(nb){if(!this.kId)return!0;this.l1c||(nb[xb.a.Visible]=!0);let Rb,mb,Ub,zc,Pc;({sKk:Rb,tKk:mb,oKk:Ub,qKk:zc,pKk:Pc}=this.Mdj());nb[xb.a.LabelText]=Rb;mb&&mb.length&&(nb[xb.a.LabelTextUserGeneratedPlaceholderReplacements]=
mb);nb[xb.a.ImageIsVisible]=Ub;nb[xb.a.Image16by16Class]=zc;nb[xb.a.ImageBackColor]=Pc;this.kId=!1;return!0}CPk(nb){if(0>=this.l2.Exa)return!1;var Rb=this.uzl(this.l2.Uyd),mb=this.kwj(Rb);Rb=Object.assign(new Db.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});mb=Object.assign(new Xb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.s6f(),ControlList:mb});z.AFrameworkApplication.fa.ka("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.old&&(mb.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,
mb.TitleId="menuCoauthorsTitle",mb.Theme="Light");Array.add(Rb.MenuSectionList,mb);z.AFrameworkApplication.fa.ka("DocChatIsEnabled")&&z.AFrameworkApplication.fa.ka("PeoplesWellExtraButtonInfoIsEnabled")&&z.AFrameworkApplication.Aa&&z.AFrameworkApplication.Aa.ob.Pp&&(mb=[],Array.add(mb,this.aij()),mb=Object.assign(new Xb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:mb}),Array.add(Rb.MenuSectionList,mb));z.AFrameworkApplication.Aa&&z.AFrameworkApplication.Aa.ob.Pp?nb.MenuItems=Rb:
nb.PopulationXML=wb.l(Rb);return!0}SRl(nb){r.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");nb=nb.MenuItemId;if(!nb)return!1;const Rb=this.settings.pua(nb);if(!this.YHf(nb,Rb,!0))return!1;this.O6j(nb,Rb);return!0}W1k(){const nb=this.jaj();this.l2.Apl(nb);this.l1c&&1<=this.l2.Exa&&(r.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.l1c=!1);this.kId=!0}n1(){this.MFd||(window.setTimeout(()=>{this.vod();this.MFd=!1},3E3),this.MFd=!0)}jaj(){let nb;
nb=this.haj()||[];for(const Rb of nb)this.Bel(Rb);return nb}Bel(nb){nb.clientId||(nb.clientId=C.a.create().toString());nb.userName||(nb.userName="Anonymous user");nb.capabilities||(nb.capabilities=new Wa.a);nb.color||(nb.color="#cccccc");nb.yGa||(nb.yGa=0)}uzl(nb){const Rb=[];Array.addRange(Rb,nb);Rb.sort(ib.dKk);return Rb}e4k(){z.AFrameworkApplication.fa.ka("CoauthorGalleryTelemetryIsEnabled")&&!this.ZLd&&(z.AFrameworkApplication.Ra.GT(Ta.a.uLf)&&Ab.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||
z.AFrameworkApplication.Ra.ra(Ta.a.uLf,Sc.a.frame,Object(h.a)(this,this.IBk,"onCoauthorGalleryFirstRender"),96));this.f4k();this.ZLd=!0;this.vod()}IBk(nb,Rb,mb,Ub,zc){this.gQd.uK(zc.RenderTime);return 32}get wwd(){return this.gQd.task}vod(){if(!this.ZLd&&(this.gQd.uK((new Date).getTime()),r.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.Kmg))return;this.W1k();this.Kmg&&this.l1c?z.AFrameworkApplication.fa&&z.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",
!1)||ha.a.waa("ribbon","coauthorGallery"):(z.AFrameworkApplication.fa&&z.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(ha.a.dP("ribbon","coauthorGallery"),ha.a.vaa("ribbon","coauthorGallery")),this.X1k())}dispose(){this.XK&&(this.XK.MVe(Object(h.a)(this,this.n1,"onUsersUpdated")),this.XK=null)}static dKk(nb,Rb){return nb.capabilities.dea(1)&&Rb.capabilities.dea(1)||!nb.capabilities.dea(1)&&!Rb.capabilities.dea(1)?rc.a.localeCompare(nb.userName,
Rb.userName):nb.capabilities.dea(1)?-1:1}}Object(K.a)(ib,"APeoplesWell",null,[1590,107]);var ob=d(40);class fc extends ib{constructor(nb,Rb,mb=null,Ub=null){super(nb,mb,Ub);this.WAa=()=>!0;this.Ca=Rb}WWk(nb){return this.UWk(nb)}EPk(nb){return this.CPk(nb)}URl(nb){return this.SRl(nb)}LQ(nb,Rb,mb,Ub,zc,Pc){nb=!1;switch(mb){case 1:nb=zc(Ub);break;case 2:nb=Pc(Ub)}return fc.dqi(nb)}WUj(nb,Rb,mb,Ub,zc){return this.LQ(nb,Rb,mb,zc,()=>this.Sme(),this.WAa)}VWk(nb,Rb,mb,Ub,zc){return this.LQ(nb,Rb,mb,zc,Object(h.a)(this,
this.WWk,"queryUsersProxy"),this.WAa)}DPk(nb,Rb,mb,Ub,zc){return this.LQ(nb,Rb,mb,zc,this.WAa,Object(h.a)(this,this.EPk,"populateFlyoutContentsProxy"))}mDi(nb,Rb,mb,Ub,zc){return this.LQ(nb,Rb,mb,zc,this.WAa,this.WAa)}lDi(nb,Rb,mb,Ub,zc){return this.LQ(nb,Rb,mb,zc,this.WAa,this.WAa)}TRl(nb,Rb,mb,Ub,zc){return this.LQ(nb,Rb,mb,zc,this.WAa,Object(h.a)(this,this.URl,"userButtonClickProxy"))}aOk(nb,Rb,mb,Ub,zc){return this.LQ(nb,Rb,mb,zc,this.WAa,()=>{this.vod();return!0})}f4k(){this.Ca.ya(this.settings.gIc,
ob.a.application,Object(h.a)(this,this.WUj,"isControlEnabledHandler"));this.Ca.ra(this.settings.kIc,ob.a.application,Object(h.a)(this,this.VWk,"queryUsersHandler"),96);this.Ca.ra(this.settings.iIc,ob.a.application,Object(h.a)(this,this.mDi,"commandMenuOpenHandler"),96);this.Ca.ra(this.settings.hIc,ob.a.application,Object(h.a)(this,this.lDi,"commandMenuCloseHandler"),96);this.Ca.ra(this.settings.jIc,ob.a.application,Object(h.a)(this,this.DPk,"populateFlyoutContentsHandler"),96);this.Ca.ya(this.settings.mIc,
ob.a.application,Object(h.a)(this,this.TRl,"userButtonClickHandler"));this.Ca.ra(this.settings.HRd,ob.a.application,Object(h.a)(this,this.aOk,"peoplesWellRefreshControlHandler"),96)}dispose(){super.dispose()}static dqi(nb){return nb?32:8}}Object(K.a)(fc,"ABox4PeoplesWell",ib,[]);var Jb=d(748);class xc extends Sys.EventArgs{constructor(nb){super();this.controlId=nb}}Object(K.a)(xc,"RibbonControlStatusChangedEventArgs",Sys.EventArgs,[]);class ic extends fc{constructor(nb,Rb,mb,Ub,zc,Pc,Mc,ld,vb,cc,
Hc,Pb,Uc,sc,lb,Zb,Oc,md){super(nb,Rb,Zb,md?D.Task.qt(md):null);this.Fz=null;this.yze=!1;if(!zc)throw Error.argumentNull("coauthStateGetter");if(!Pc)throw Error.argumentNull("appFrame");if(!Mc)throw Error.argumentNull("taskManager");this.Ej=zc;this.Vb=Pc;this.wb=Mc;Ub&&Ub.execute(Ib=>{this.Fz=Ib});mb&&mb.execute(Ib=>{Ib.Fhi(Object(h.a)(this,this.TSk,"presenceChanged"))});this.oc=ld;this.De=vb;this.le=cc;this.Kgc=Uc;this.Xek=Hc;this.mgb=Pb;this.KDb=sc;this.$X=lb;this.wEe=Oc;this.pOg=md;this.wwd.continueWith(()=>
{this.$X.ZZi(this.wwd.result)})}O6j(nb,Rb){let mb=null;({data:mb}=this.K7e(Rb)).returnValue&&mb&&mb.pk&&(bb.a.J(512497493,814,50,"PowerPointPeoplesWell : JumpToUserLocation; clientId: {0}; slideId: {1}; MyClientId: {2};",nb,mb.pk,this.Ej.AD),(nb=this.oc.Wka(mb.pk))?(this.De.ksd(),this.De.$J(nb.ue)):bb.a.J(512497492,814,15,"PowerPointPeoplesWell : JumpToUserLocation; failed to find slide by id: {0}; ",mb.pk))}K7e(nb){let Rb;Rb=null;if(!nb)throw bb.a.J(512497491,814,10,"PowerPointPeoplesWell : TryGetPresenceData; Presence was null; MyClientId: {0};",
this.Ej.AD),Error.argumentNull("presence");return nb?(Rb=Jb.a.qOc(nb.data))?{returnValue:!0,data:Rb}:{returnValue:!1,data:Rb}:{returnValue:!1,data:Rb}}Zwi(nb){let Rb=null;return({data:Rb}=this.K7e(nb)).returnValue&&Rb&&Rb.pk?!0:!1}haj(){if(this.pOg)return this.pOg.gaj();bb.a.J(512497490,814,50,"PowerPointPeoplesWell::GetAllUsersInfo - PeopleInfoProvider is null.");const nb=this.iaj();0<nb.length&&bb.a.J(512497489,814,50,"PowerPointPeoplesWell::GetAllUsersInfo - non-empy editor count {0}.",nb.length);
return nb}iaj(){const nb=[],Rb=this.wEe.F6f();this.Ej.jnb(this.Ej.AD).returnValue||bb.a.J(512497488,814,50,"PowerPointPeoplesWell : GetAllUsersInfo, there is no current editorId:{0} in the editortable",this.Ej.AD);let mb=null;this.Fz&&(mb=this.Fz.ZTc());var Ub=z.AFrameworkApplication.fa.ka("PeoplesWellExtraButtonInfoIsEnabled");for(var zc of this.Ej.v_){var Pc=this.mgb.oua(new Ia.a(zc.EmailAddress,void 0,zc.Name),zc.ID,1),Mc=new Wa.a;Mc.r1a(0);let ld=0,vb=!1;if(ic.v5j(zc.ID,mb)){Mc.r1a(1);if(Ub){let cc=
mb[zc.ID];cc&&(ld=cc.capabilities);vb=!0;cc&&cc.capabilities&4&&Mc.r1a(4)}delete mb[zc.ID]}ic.qKc(Rb,zc.EmailAddress)||(Array.add(nb,new Hb.a(zc.ID,zc.Name,Pc,Mc,null,zc.EmailAddress)),bb.a.J(8958496,814,50,"PowePointPeoplesWell : GetAllUsersInfo; ClientId: {0}; Color: {1}; PresenceCapabilityHasFlagRealTimeChannel: {2}; PresenceCapabilityHasFlagSupportsChat: {3}; MyClientId: {4}; IsEmailAddressEmpty: {5}; rtcCapabilities:{6}; fIssuserinrtc{7};",zc.ID,Pc,Mc.dea(1),Mc.dea(4),this.Ej.AD,!zc.EmailAddress,
ld,vb))}if(!Ub&&this.Kgc&&mb)for(let ld in mb)Ub=mb[ld],!ic.qKc(Rb,Ub.email)&&Ub&&Ub.userName&&(zc=new Wa.a,zc.r1a(1),Ub.capabilities&4&&zc.r1a(4),Pc=this.KDb.y$d(Ub.email)||Ub.email,Mc=this.mgb.oua(new Ia.a(Pc,void 0,Ub.userName),Ub.clientId,1),Array.add(nb,new Hb.a(Ub.clientId,Ub.userName,Mc,zc,null,Pc)),bb.a.J(38897818,814,50,"PowePointPeoplesWell : GetAllUsersInfo; Get info from RTC when user is not in editor table and username is provided; ClientId: {0}; Color: {1}; PresenceCapabilityHasFlagRealTimeChannel: {2}; PresenceCapabilityHasFlagSupportsChat: {3}; MyClientId: {4}; IsEmailAddressEmpty: {5}; rtcPresenceCapabilities: {6};",
Ub.clientId,Mc,zc.dea(1),zc.dea(4),this.Fz.clientId,!Ub.email,Ub.capabilities));return nb}xIi(nb){let Rb=null,mb=" ";({data:Rb}=this.K7e(nb)).returnValue&&Rb&&Rb.pk&&(nb=this.oc.Wka(Rb.pk))&&(mb=String.format(ResourceStrings.l_PeoplesWellUserStatusIsEditingSlide,nb.ue+1));return mb}TSk(){this.Vb.eu.$Fa?this.yze||(this.wb.Hb(new gc.a(2,1,0,Object(h.a)(this,this.handlePendingRefresh,"handlePendingRefresh"),90,"70")),this.yze=!0):this.Ca.processAction(Ta.a.G8a,2)}X1k(){this.le.aZk(new xc(this.settings.id,
!0));const nb=1<this.l2.Exa||1===this.l2.Exa&&this.l2.Uyd[0].clientId!==this.settings.clientId;this.Xek.execute(Rb=>{nb&&this.$X&&this.$X.sck();Rb.aRb()});nb&&this.$X.ji(14,Date.now())}handlePendingRefresh(){this.yze=!1;this.Ca.processAction(Ta.a.G8a,2)}dispose(){super.dispose()}static v5j(nb,Rb){return Rb&&nb in Rb?!0:!1}static qKc(nb,Rb){return!!nb&&!!Rb&&nb.toLowerCase()===Rb.toLowerCase()}}Object(K.a)(ic,"PowerPointPeoplesWell",fc,[]);class nc{constructor(nb){this.$ic=null;nb.execute(Rb=>{this.$ic=
Rb})}pua(nb){return this.$ic?this.$ic.pua(nb):null}i4(nb){return this.$ic?this.$ic.i4(nb):null}}Object(K.a)(nc,"PresenceUserInfoGetterProxy",null,[1075]);var Wb=d(33);class wc{constructor(){this.w5=this.CJ=this.jh=this.K=null}get name(){return"PowerPointWebEditor.PeoplesWell"}Yb(nb){wc.Jec=Date.now();this.K=nb;this.w5=this.K.resolve("PowerPointWebEditor.Core.IBundleMetricRecorder");this.jh=this.w5.XEa(6,this.name);this.K.register(1075,"PowerPointWebEditor.IPresenceUserInfoGetter").ma().oa(()=>new nc(this.K.Ia("PowerPointWebEditor.IDelayedPresenceUserInfoGetter")));
this.K.register(601,"Common.ICoauthoringTelemeryInfoProvider").ma().oa(()=>new Na(this.K.resolve("PowerPointWebEditor.ICoauthStateGetter")));this.K.register(jc,"PowerpointPresence.PeopleInfoProvider").as("Common.IPeopleInfoProvider").ma().oa(()=>new jc(this.K.resolve("PowerPointWebEditor.ICoauthStateGetter"),this.K.Ia("Common.IRealtimeChannelBasic"),this.K.resolve("PowerpointPresence.IPresenceColorProvider"),this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler"),this.K.resolve("PowerpointPresence.IPresencePrepCacheParser")));
if(Wb.a("PeoplesBaseUlrConfiguredForPods")&&(nb=this.K.resolve("Common.App.People.IExternalPeopleAPI"),this.K.resolve("PowerPointWebEditor.IApplicationSettings").yg)){const Rb=this.K.resolve("Common.IAppSettingsManager").Ha("368");nb.qdh(Rb+"p")}bb.a.J(509669911,814,50,"PPTWebEditorPeoplesWellPackage:Configure")}init(){if(z.AFrameworkApplication.fa&&z.AFrameworkApplication.fa.ka("UnifiedScriptLoaderForDSEnabled"))this.K.resolve("PowerPointWebEditor.ScriptLoader.IUnifiedScriptLoader").Dda("pptedit.presence1",
null,()=>d.e(4).then(d.bind(null,1293)));else{const nb=Da.a.create("pptedit.presence1",null,()=>d.e(4).then(d.bind(null,1293)));ta.a.oy(nb)}this.K.resolve("Common.ICoauthoringTelemeryInfoProvider");this.K.resolve("Common.IPeopleInfoProvider");z.AFrameworkApplication.qB.EEa?(this.CJ=this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler"),ha.a.waa("ribbon","coauthorGallery"),this.CJ.WSd(Object(h.a)(this,this.Rjg,"initializePeoplesWellHandler"))):this.Qjg()}Rjg(){try{z.AFrameworkApplication.qB.EEa||
(this.Qjg(),this.CJ.qVe(Object(h.a)(this,this.Rjg,"initializePeoplesWellHandler")))}catch(nb){bb.a.J(8958610,814,10,"PresencePackage::Init; Loading presence and peoples well failed: {0}",nb)}}Qjg(){const nb=this.jh.Zt("peoplewell");this.AOj(this.K.resolve("PowerPointWebEditor.IPresenceUserInfoGetter"),this.K.resolve("Common.IActionManagerExtended"),this.K.resolve("PowerPointWebEditor.AppFrame"),this.K.resolve("Common.ITaskManager"),this.K.resolve("PowerPointWebEditor.IApplicationSettings"),this.K.resolve("PowerpointPresence.RtcParams").clientId);
this.jh.fu(nb)}AOj(nb,Rb,mb,Ub,zc,Pc){var Mc=this.K.resolve("PowerpointPresence.IPresencePerfLogger");Mc.ji(10,wc.Jec);Mc.ji(9,wc.ljc);Mc.ji(11,(new Date).getTime());Mc=Date.now();const ld=oa.CuiHelper.Mnj(z.AFrameworkApplication.Cm,z.AFrameworkApplication.Cm,z.AFrameworkApplication.Cm);nb=Ha.createInstance(ld,Pc,Object(h.a)(nb,nb.pua,"getUserPresence"),Object(h.a)(nb,nb.i4,"getUserStatusInfo"),!0);(Pc=this.K.resolve("PowerpointPresence.PeopleInfoProvider"))||bb.a.J(509669910,814,10,"InitializePeoplesWellInternal; null PeopleInfoProvider");
bb.a.J(509669909,814,50,"InitializePeoplesWellInternal; creating peopleswell");const vb=new ic(nb,Rb,this.K.Ia("PowerpointPresence.IPresenceManager"),this.K.Ia("Common.IRealtimeChannelBasic"),this.K.resolve("PowerPointWebEditor.ICoauthStateGetter"),mb,Ub,this.K.resolve("PowerPointWebEditor.IPresentationReader"),this.K.resolve("PowerPointWebEditor.IThumbnailNavigationPaneView"),this.K.resolve("PowerPointWebEditor.View.IViewEventNotifier"),this.K.Ia("Box4.IBox4BridgeCommandUi"),this.K.resolve("PowerpointPresence.IPresenceColorProvider"),
zc.podsDefaultToRtcForPresenceEnabled,this.K.resolve("PowerpointPresence.IPresenceEmailConverter"),this.K.resolve("PowerpointPresence.IPresencePerfLogger"),this.K.resolve("Common.App.People.IPeopleManager"),this.K.resolve("PowerpointPresence.IPresencePrepCacheParser"),Pc);vb.e4k();this.K.register(ic,"PowerpointPresence.PowerPointPeoplesWell").as("Common.IPeoplesWell").ma().oa(()=>vb);this.K.resolve("Common.IPeoplesWell");this.K.Ia("Box4.IBox4BridgeCommandUi").execute(cc=>{cc.aRb()});bb.a.J(8958615,
814,50,"PresencePackage::InitializePeoplesWell; People's Well loaded and initialized. Time cost: {0}",Date.now()-Mc);this.K.resolve("PowerpointPresence.IPresencePerfLogger").c_i()}dispose(){}static main(){wc.ljc=Date.now();if(z.AFrameworkApplication.fa&&z.AFrameworkApplication.fa.ka("IsSyncConfigPresenceEnabled")){const nb=new wc;nb.Yb(ma.a.instance);nb.init()}else Ma.a.instance.Ac(new wc)}}wc.ljc=0;wc.Jec=0;Object(K.a)(wc,"PPTWebEditorPeoplesWellPackage",null,[2,3]);Type.registerNamespace("PowerPointWebEditor");
Type.registerNamespace("PowerPointWebEditor.PeoplesWell");Type.registerNamespace("PowerpointPresence");Type.registerNamespace("RealtimePresenceUI");window.g_hermesPresenceJS=new Date;Type.registerNamespace("Common.App.CoauthTelemetry");Ca.main();Type.registerNamespace("RealtimePresenceUI");wc.main()},748:function(K,U,d){K=d(0);var h=d(62);class e{constructor(m,n,z){this.slideId=m;this.shapes=n;this.sn=z}}Object(K.a)(e,"SerializablePresenceData",null,[]);d.d(U,"a",function(){return r});class r{constructor(m,
n,z=0){if(!r.isValid(m))throw Error.create("Invalid Presence Data");this.SB=m;this.Fdd=n;this.EYg=z?z:++r.CQi}get pk(){return this.SB}get fV(){return this.Fdd}toString(){return this.SB.toString()+" : "+(this.fV&&this.fV.length?this.fV[0].toString():"")+" : "+this.EYg}Hce(){return new e(this.SB.Gxc,this.Fdd,this.EYg)}static isValid(m){return!!m}static qOc(m){return new r(new h.a(m.slideId),m.shapes,m.sn)}}r.CQi=0;Object(K.a)(r,"PresenceData",null,[])}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/19809348/wdjs/ppteditDS.presence.js.map