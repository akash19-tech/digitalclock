'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[4],{1014:function(K,U,d){d.d(U,"a",function(){return h});K=d(0);var h;(function(e){e[e.disconnected=0]="disconnected";e[e.connecting=1]="connecting";e[e.connected=2]="connected"})(h||(h={}));Object(K.b)("ChannelConnectionState",h)},1015:function(K,U,d){d.r(U);d.d(U,"MaxOutstandingThrottler",function(){return m});K=d(0);var h=d(7),e=d(77);U=d(1016);var r=d(743);class m extends U.a{constructor(n,z=""){super(n,z);this.Bhb=
this.QMa=0;this.Ma=new e.a;this.eqb=!1;this.cEc=this.Izc=this.qzc=this.dQd=0;this.qHc=[];this.clearTimeout=m.x2d}add(n){this.fqb||this.init(m.VRf,m.KRf);this.N6a++;const z=new r.a;this.eBb?this.Vsd(n,z):this.cEc<this.Bhb?this.vsc(n,z):(this.Vsd(n,z),this.eqb=!1);return z}vsc(n,z){n=this.Gsf(n);const v=this.setTimeout(Object(h.a)(this,this.XEk,"onMessageWaitTimeExpired"),this.QMa);++this.cEc;Array.add(this.qHc,v);const x=this.qzc;n.ejd(B=>{z.clc(B)});n.djd(B=>{this.qzc===x&&(this.WEk(x,v),z.LZa(B))})}WEk(n,
z){this.qzc===n&&(--this.cEc,this.clearTimeout(z),Array.remove(this.qHc,z),this.eBb&&this.Xhl())}Xhl(){this.eBb&&!this.eqb&&(this.dQd=this.setTimeout(Object(h.a)(this,this.Yhl,"sendThrottledMessageFromTimer"),0),this.eqb=!0)}Yhl(){this.eqb=!1;if(this.eBb){const n=this.mHc,z=this.dsb;this.W1b(!1);this.vsc(n,z)}}XEk(){++this.Izc;this.Izc>Math.floor(this.Bhb/2)&&(this.Izc=-1E9,this.Ma.raiseEvent("TMUDM"))}rJc(n){this.Ma.addHandler("TMUDM",n)}reset(){this.N6a=this.nZb=this.LTb=this.Izc=0;++this.qzc;for(const n of this.qHc)this.clearTimeout(n);
this.cEc=0;this.qHc=[];this.W1b(!0);this.eqb&&(this.clearTimeout(this.dQd),this.dQd=0,this.eqb=!1)}init(n,z){this.fqb||(this.QMa=n,this.Bhb=z,this.fqb=!0)}static createInstance(n,z=""){return new m(n,z)}static x2d(n){window.clearTimeout(n)}}m.VRf=15E3;m.KRf=5;Object(K.a)(m,"MaxOutstandingThrottler",U.a,[1205,1206])},1016:function(K,U,d){d.d(U,"a",function(){return e});K=d(0);var h=d(392);class e{constructor(r,m=""){this.LTb=this.nZb=0;this.DHd=!1;this.dsb=this.mHc=null;this.fqb=!1;this.Gsf=r;this.DIh=
m;this.setTimeout=e.H2d;this.N6a=this.nZb=this.LTb=0}cUe(){0<this.N6a&&0<this.LTb&&h.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.DIh,this.LTb,this.N6a);0<this.N6a&&0<this.nZb&&h.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.DIh,this.nZb,this.N6a)}get eBb(){return this.DHd}Vsd(r,m){this.nZb++;this.W1b(!0);this.DHd=!0;this.mHc=r;this.dsb=m}W1b(r){this.DHd=!1;this.dsb&&r&&(this.LTb++,this.dsb.fIe());this.dsb=
this.mHc=null}static H2d(r,m){return window.setTimeout(r,m)}}Object(K.a)(e,"ThrottlerBase",null,[])},1017:function(K,U,d){d.r(U);d.d(U,"MaxRateThrottler",function(){return r});K=d(0);var h=d(7);U=d(1016);var e=d(743);class r extends U.a{constructor(m,n=""){super(m,n);this.Dhb=0;this.dWb=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(m){this.fqb||(this.Dhb=m,this.fqb=!0)}add(m){this.fqb||this.init(r.ERf);this.N6a++;const n=this.currentTime(),z=new e.a;this.dWb>n&&(this.dWb=
n);this.eBb?(this.W1b(!0),this.Vsd(m,z)):this.dWb+this.Dhb<=n?this.vsc(m,z):(this.Vsd(m,z),this.setTimeout(Object(h.a)(this,this.Whl,"sendThrottledMessage"),this.dWb+this.Dhb-n));return z}Whl(){if(this.eBb){const m=this.mHc,n=this.dsb;this.W1b(!1);this.vsc(m,n)}}vsc(m,n){this.dWb=this.currentTime();m=this.Gsf(m);m.ejd(z=>{n.clc(z)});m.djd(z=>{n.LZa(z)})}static createInstance(m,n=""){return new r(m,n)}}r.ERf=200;Object(K.a)(r,"MaxRateThrottler",U.a,[1207,1206])},1018:function(K,U,d){d.d(U,"a",function(){return h});
K=d(0);class h extends Sys.EventArgs{constructor(e,r,m,n){super();this.type=e;this.jAa=r;this.ISi=m;this.FMa=n}}Object(K.a)(h,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1019:function(K,U,d){d.d(U,"a",function(){return h});K=d(0);class h{}h.DXe="rr";h.sdl="rd";h.odl="rbp";h.RYe="sa";Object(K.a)(h,"RtcReconnectParams",null,[])},1020:function(K,U,d){d.d(U,"a",function(){return h});K=d(0);class h{}h.Dhb="throttling_messageDelay";h.sBb="enabled";h.QMa="throttling_timeToWaitForResponse";h.Bhb=
"throttling_maxNumberOfOutstandingMessages";h.zee="throttling_globalMaxNumberOfOutstandingMessages";h.errorMessage="errorMessage";h.I2e="url";h.o6="queryString";h.rB="connectionString";Object(K.a)(h,"RtcFindSessionOutputFieldNameConstants",null,[])},1021:function(K,U,d){d.d(U,"a",function(){return h});K=d(0);class h{constructor(){this.VXc=this.Xfd=this.Yfd=this.agd=0;this.$bc=!1;this.correlationId=this.rB=this.o6=this.D2b=this.errorMessage=null}get rMf(){return this.D2b+"?"+this.o6}}Object(K.a)(h,
"FindSessionResponse",null,[])},1066:function(K,U,d){d.r(U);K=d(0);var h=d(392),e=d(7),r=d(1095),m=d(317),n=d(18);class z{constructor(x){this.messageId=x;this.Zhl=(new Date).getTime();this.rre=new n.a}}Object(K.a)(z,"MessageLatencyDetails",null,[]);d.d(U,"ClientToClientMessageTelemetry",function(){return v});class v{constructor(x,B,D){this.Wqa=null;this.DJd=this.eOd=0;this.Yc=B;this.tnf=D;this.xYb=!1;this.Fl=x;this.Fl.ECa(Object(e.a)(this,this.g0k,"receiveMessage"))}start(){if(this.tnf&&!this.xYb){const x=
this.Yc.Nsh;this.DJd=this.Yc.Ksh;x<=this.DJd?(h.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Yc.Nsh,this.Yc.Ksh),this.tnf=!1):(this.xYb=!0,this.eOd=window.setInterval(Object(e.a)(this,this.sendMessage,"sendMessage"),x))}}sendMessage(){if(this.xYb){const x=m.a.create().toString();this.Wqa=new z(x);this.Fl.wTe(16,x,!1,new r.a);
window.setTimeout(()=>{this.$bk(x)},this.DJd)}}$bk(x){this.Wqa&&this.Wqa.messageId===x&&(0<this.Wqa.rre.count?(x=this.Wqa.rre.toArray().join(","),h.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",x)):h.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.Wqa=null)}stop(){this.eOd&&(window.clearInterval(this.eOd),this.xYb=!1)}g0k(x,B){16===B.type?this.Fl.wTe(17,B.jAa,!1,new r.a):17===B.type&&this.xYb&&B.jAa&&this.processMessage(B.jAa)}processMessage(x){x&&
this.Wqa&&x.toString()===this.Wqa.messageId&&this.Wqa.rre.add((new Date).getTime()-this.Wqa.Zhl)}static get instance(){return v.La}static Smj(x,B,D){return v.instance||(v.La=new v(x,B,D))}}v.La=null;Object(K.a)(v,"ClientToClientMessageTelemetry",null,[])},1176:function(K,U,d){d.r(U);d.d(U,"RealtimeChannelMetrics",function(){return n});K=d(0);var h=d(392),e=d(173),r=d(105),m=d(195);class n{constructor(){this.vof=this.wof=this.xof=this.tof=this.sof=this.uof=this.SWb=this.NKd=0;this.ZAc=this.$Id=this.eWb=
this.QId=this.RId=this.IId=this.ZOa=this.YVb=this.mqb=this.HId=this.XAc=this.vpb=null;this.IJd=this.BWb=this.Jsf=this.Rcf=0;this.vnf=!1;this.pod=this.RTe;this.UTe=this.VTe;this.qod=this.TTe;this.xqc=this.XTe;this.Jlh=this.WTe;this.dUe=this.eUe;this.aUe=this.bUe;this.Ljb=this.ZTe;this.zqc=this.$Te;this.Elh=this.STe;this.pIb=this.FJe;this.Ulc=this.GJe}RTe(){this.NKd++;this.HId=new Date;this.vpb||(this.vpb=new Date)}VTe(){this.SWb++;this.ZOa=new Date;this.XAc||(this.XAc=this.ZOa);this.eWb=this.ZOa;this.rEi()}TTe(){this.uof++;
this.IId=new Date}XTe(){this.sof++;this.mqb=new Date}WTe(){this.tof++;this.YVb=new Date}bUe(){this.RId=new Date;this.xof++}$Te(){this.ZAc||(this.ZAc=new Date);this.wof++}ZTe(){this.QId=new Date;this.vof++}eUe(){if(!this.vnf&&this.NKd){var z=this.XMc();h.ULS.sendTraceTag(39321871,500,15,r.a.toJSON(z));this.vnf=!0}}STe(z){let v,x;({Tge:z,Uge:v,ej:x}=m.RtcUtils.qZf(z));z&&z!==e.a.mx&&(h.ULS.sendTraceTag(40157596,500,15,r.a.toJSON({["HttpErrorCode"]:z,["HttpErrorStatus"]:v,["Exception"]:x})),e.a.Emg(z)&&
this.Rcf++,e.a.Lrg(z)&&this.Jsf++)}FJe(){this.$Id=new Date}GJe(){this.mqb=this.eWb=new Date}XMc(){return{["numberOfConnectionAttempts"]:this.NKd,["numberOfSuccessfulConnections"]:this.SWb,["numberOfFailedConnections"]:this.uof,["numberOfDisconnectedConnections"]:this.sof,["numberOfExplicitDisconnectedConnections"]:this.tof,["numberOfSentMessages"]:this.xof,["numberOfReceivedMessages"]:this.wof,["numberOfLostMessages"]:this.vof,["firstConnectionAttempt"]:this.vpb?this.vpb:null,["firstMessageReceived"]:this.ZAc?
this.ZAc:null,["firstConnectionSuccess"]:this.XAc?this.XAc:null,["lastConnectionAttempt"]:this.HId?this.HId:null,["lastConnectionSuccess"]:this.ZOa?this.ZOa:null,["lastConnectionFailure"]:this.IId?this.IId:null,["lastMessageSent"]:this.RId?this.RId:null,["lastMessageLost"]:this.QId?this.QId:null,["lastDisconnect"]:this.mqb?this.mqb:null,["lastExplicitDisconnect"]:this.YVb?this.YVb:null,["lastTimeOnline"]:this.eWb?this.eWb:null,["lastTimeOffline"]:this.$Id?this.$Id:null,["maxDisconnectedTimeMs"]:this.BWb,
["maxExplicitDisconnectedTimeMs"]:this.IJd,["clientConnectionErrors"]:this.Rcf,["serverConnectionErrors"]:this.Jsf}}rEi(){this.vpb&&1===this.SWb&&(this.BWb=Math.max(this.BWb,this.ZOa.getTime()-this.vpb.getTime()));this.mqb&&1<this.SWb&&(this.BWb=Math.max(this.BWb,this.ZOa.getTime()-this.mqb.getTime()));this.YVb&&1<this.SWb&&(this.IJd=Math.max(this.IJd,this.ZOa.getTime()-this.YVb.getTime()))}static createInstance(z){n.La||(n.La=new n,h.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",
z));return n.La}}n.La=null;Object(K.a)(n,"RealtimeChannelMetrics",null,[1179,302])},1177:function(K,U,d){d.d(U,"a",function(){return h});K=d(0);class h extends Sys.EventArgs{constructor(e,r){super();this.iRb=e;this.eUf=r}}Object(K.a)(h,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1178:function(K,U,d){d.d(U,"a",function(){return h});K=d(0);var h;(function(e){e[e.unspecified=0]="unspecified";e[e.word=1]="word";e[e.excel=2]="excel";e[e.powerPoint=3]="powerPoint";e[e.test=4]="test";e[e.wacFrontEnd=5]=
"wacFrontEnd";e[e.oneNote=6]="oneNote";e[e.visio=7]="visio";e[e.officeMobile=8]="officeMobile";e[e.cosmosDBChangefeed=9]="cosmosDBChangefeed";e[e.last=10]="last"})(h||(h={}));Object(K.b)("RtcClientAppName",h)},1186:function(K,U,d){K=d(0);var h=d(7),e=d(1244),r=d(301),m=d(302),n=d(67),z=d(99);class v extends r.a{constructor(C,O){super(C);this.Ch=null;this.wca=O.get(8,!1);this.Rha=O.get(6,0);this.element=C;this.element.className=v.B6b;this.W6a=this.createElement("ul");this.element.appendChild(this.W6a);
this.xq=O.get(10);this.xq.rb(n.a.click,this.element,Object(h.a)(this,this.onClick,"onClick"));this.Xz=O.get(9);this.Xz.rb(n.a.pointerOut,this.element,Object(h.a)(this,this.qG,"onPointerOut"));this.Xz.rb(n.a.pointerDown,this.element,Object(h.a)(this,this.kF,"stopPropagationAndPreventDefaultBehavior"));this.CZ=O.get(13);this.CZ.rb(this.element,Object(h.a)(this,this.kF,"stopPropagationAndPreventDefaultBehavior"))}g8(C){this.addHandler(m.a.zw,C)}Voa(C){this.removeHandler(m.a.zw,C)}get Cba(){return this.Ch}dispose(){this.element&&
(this.xq.Bb(n.a.click,this.element,Object(h.a)(this,this.onClick,"onClick")),this.Xz.Bb(n.a.pointerDown,this.element,Object(h.a)(this,this.kF,"stopPropagationAndPreventDefaultBehavior")),this.Xz.Bb(n.a.pointerOut,this.element,Object(h.a)(this,this.qG,"onPointerOut")),this.CZ.Bb(this.element,Object(h.a)(this,this.kF,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(C,O,S){this.hide();!C||0>=C.length||(this.wca?this.element.style.right=O+"px":this.element.style.left=
O+"px",this.element.style.top=S+"px",this.RSd(C),this.visible=!0)}RSd(C){this.Ch=C;z.a.vv(this.W6a);for(let O=C.length-1;0<=O;O--)this.kB(C[O])}kB(C){const O=document.createElement("li");O.style.backgroundColor=C.color;O.style.height=this.Rha+"px";O.id="fly_"+C.clientId;O.style.lineHeight=this.Rha+"px";z.a.Mz(O,C.userName);O.setAttribute("dir","auto");this.W6a.appendChild(O)}onClick(){this.hide();return!1}qG(C){this.raiseEvent(m.a.zw,new m.a(3,C));return!1}}v.B6b="prFlyout UIFont";Object(K.a)(v,"PresenceTooltipFlyoutControl",
r.a,[]);var x=d(78);class B extends r.a{constructor(C,O,S){super(C);this.LZ=null;this.Ch=[];this.element.className="prGlyph";this.Yc=O;this.R7=this.Yc.get(9);this.Hn=this.Yc.get(10);this.CZ=this.Yc.get(13);this.Gge();this.kB(S);this.Z4a=!1}get eP(){return this.Ch.length}get Cba(){return this.Ch}g8(C){this.addHandler(m.a.zw,C)}Voa(C){this.removeHandler(m.a.zw,C)}dispose(){this.A8e();super.dispose()}kB(C){Array.add(this.Ch,C);2===this.eP?this.zba(!0):1===this.eP?this.zba(!1):this.zba(this.Z4a)}nP(C){this.r7d(C)&&
(1<this.eP&&this.zba(!0),1===this.eP?this.zba(!1):1>this.eP&&this.hide())}show(){this.zba(2<=this.eP);this.visible=!0}hide(){this.visible=!1}zae(C){return C?this.k7b(0,5):this.k7b(1,4)}r7d(C){for(let O=0;O<this.eP;O++)if(this.Ch[O].clientId===C)return C=this.Ch[O],Array.removeAt(this.Ch,O),C;return null}zba(C){this.Z4a!==C&&(this.LZ&&this.element.removeChild(this.LZ),this.LZ=this.zae(C),this.element.appendChild(this.LZ),this.Z4a=C);this.LZ.childNodes[0].style.backgroundColor=this.Ch[this.Ch.length-
1].color}k7b(C,O){const S=this.Yc.get(6,0),T=this.Yc.get(14);return x.createClusteredImageFromClusterWithImageClass(S,S,this.Yc.get(C),this.Yc.get(O),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,T?T.cloneNode(!0):null)}NM(C){3!==C.ng&&this.raiseEvent(m.a.zw,new m.a(2,C));return!1}onClick(C){this.raiseEvent(m.a.zw,new m.a(1,C));return!0}qG(C){3!==C.ng&&this.raiseEvent(m.a.zw,new m.a(3,C));return!1}A8e(){this.element&&(this.R7.Bb(n.a.pointerDown,this.element,Object(h.a)(this,
this.kF,"stopPropagationAndPreventDefaultBehavior")),this.R7.Bb(n.a.pointerOver,this.element,Object(h.a)(this,this.NM,"onPointerOver")),this.R7.Bb(n.a.pointerOut,this.element,Object(h.a)(this,this.qG,"onPointerOut")),this.Hn.Bb(n.a.doubleClick,this.element,Object(h.a)(this,this.kF,"stopPropagationAndPreventDefaultBehavior")),this.Hn.Bb(n.a.click,this.element,Object(h.a)(this,this.onClick,"onClick")),this.CZ.Bb(this.element,Object(h.a)(this,this.kF,"stopPropagationAndPreventDefaultBehavior")))}Gge(){this.element&&
(this.R7.rb(n.a.pointerDown,this.element,Object(h.a)(this,this.kF,"stopPropagationAndPreventDefaultBehavior")),this.R7.rb(n.a.pointerOver,this.element,Object(h.a)(this,this.NM,"onPointerOver")),this.R7.rb(n.a.pointerOut,this.element,Object(h.a)(this,this.qG,"onPointerOut")),this.Hn.rb(n.a.doubleClick,this.element,Object(h.a)(this,this.kF,"stopPropagationAndPreventDefaultBehavior")),this.Hn.rb(n.a.click,this.element,Object(h.a)(this,this.onClick,"onClick")),this.CZ.rb(this.element,Object(h.a)(this,
this.kF,"stopPropagationAndPreventDefaultBehavior")))}}Object(K.a)(B,"PresenceTooltipGlyph",r.a,[]);var D=d(121);d(65);var w=d(205);class J extends r.a{constructor(C,O,S){super(C);this.Ch=[];this.tm=[];this.xI=0;this.Mia=this.y7=!1;this.YRb=null;this.dia={};this.Yc=S;this.kl=S.get(8,!1);this.MG=S.get(11,!1);C=S.get(12,0);this.imageDimension=S.get(6,0);this.Hrb=O;this.element.id=J.R6b();this.element.className=r.a.p1d(this.kl);C&&(this.zIndex=C);this.rtl=this.kl;this.Esc(O);this.Sz=this.createElement("div");
this.Sz.className=this.MG?"prContainerV":"prContainerHr";this.element.appendChild(this.Sz);this.pUb=Array(this.xI);for(O=0;O<this.xI;O++)this.uw[O]=new v(this.createElement("div"),this.Yc),this.uw[O].g8(Object(h.a)(this,this.sY,"onInteractivityChanged")),this.element.appendChild(this.uw[O].element)}get xKb(){return w.a.clone(this.Ch)}getGlyph(C){return this.dia[C]}get uw(){return this.pUb}get d_b(){return this.YRb}get nMa(){return this.imageDimension+2}get width(){return this.MG?this.nMa:this.Hrb}get height(){return this.MG?
this.Hrb:this.nMa}g8(C){this.addHandler(m.a.zw,C)}Voa(C){this.removeHandler(m.a.zw,C)}dispose(){if(this.uw)for(const C of this.uw)C.Voa(Object(h.a)(this,this.sY,"onInteractivityChanged")),D.a.Ry(C);D.a.Jqd(this.tm);this.tm=this.pUb=null;super.dispose()}eMa(){this.YW();this.Plb();this.visible=!0;this.y7=!1}hud(){!this.tm||1>this.tm.length||(this.YW(),this.visible=!0,this.Plb(),this.xKa(this.tm[this.tm.length-1]),this.y7=!0)}aMa(){if(this.tm&&!(1>this.tm.length)){this.visible=!0;this.Plb();var C=0;
for(const O of this.tm)this.xKa(O,C++);this.y7=!1;this.Mia=!0}}hide(){this.visible=!1;this.YW();for(let C=0;C<this.tm.length;C++)this.tm[C].hide();this.y7=!1}L1b(){if(!this.Mia)return!1;let C=0;for(const O of this.uw)O.visible&&C++;return this.Mia=0<C&&(this.Ch.length<=this.xI?C===this.Ch.length:C===this.xI)}kB(C){if(!(0>=this.xI)){C.clientId||(C.clientId=(J.OOa++).toString());if(C.clientId in this.dia){var O=this.wka(C.clientId);if(0<=O){O=this.Ch[O];if(O.color===C.color&&O.userName===C.userName)return;
this.nP(C.clientId)}}O=this.L1b();var S=0;if(this.Ch.length<this.xI){var T=new B(this.createElement("div"),this.Yc,C);T.g8(Object(h.a)(this,this.sY,"onInteractivityChanged"));this.kl&&!this.MG&&0<this.Ch.length?this.Sz.insertBefore(T.element,this.Sz.firstChild):(this.Sz.appendChild(T.element),S=this.tm.length);Array.add(this.tm,T)}else this.kl&&!this.MG?T=this.tm[0]:(S=this.tm.length-1,T=this.tm[S]),T.kB(C);T.show();this.dia[C.clientId]=T;Array.add(this.Ch,C);this.Wwc(T,S);O&&this.aMa()}}nP(C){const O=
this.L1b();O&&this.YW();this.y0a(C);this.Ch.length>=this.xI&&this.tm.length<this.xI&&this.PTe();0>=this.Ch.length?this.hide():O&&this.aMa()}Rgd(){}y0a(C){var O=this.wka(C);0>O||(C=this.Ch[O],Array.removeAt(this.Ch,O),O=this.dia[C.clientId],delete this.dia[C.clientId],O.nP(C.clientId),this.Wwc(O),0>=O.eP&&(this.Sz.removeChild(O.element),Array.remove(this.tm,O),O.dispose()))}gOb(){}PTe(){var C=this.Hbe();!C||1>=C.Cba.length||(C=Array.clone(this.Ch),C.forEach(O=>{this.y0a(O.clientId)}),C.forEach(O=>
{this.kB(O)}))}wka(C){for(let O=0;O<this.Ch.length;O++)if(this.Ch[O].clientId===C)return O;return-1}Hbe(){return this.kl&&!this.MG?this.tm[0]:this.tm[this.tm.length-1]}position(C,O){this.element.style.top=O+"px";this.element.style.left=C+"px"}Plb(){for(let C=0;C<this.tm.length;C++)this.tm[C].show()}YW(){for(let C=0;C<this.xI;C++)this.uw[C].hide();this.Mia=!1}xKa(C,O=0){if(C)if(this.YRb=C,this.MG){const S=this.imageDimension;if(1<C.Cba.length)this.uw[O].show(C.Cba,S,this.height-this.imageDimension);
else{const T=this.Sz.children.length;for(let ca=0;ca<this.Sz.children.length;ca++)C.element===this.Sz.children[ca]&&this.uw[O].show(C.Cba,S,this.height-(T-ca)*this.nMa+2)}}else this.uw[O].show(C.Cba,this.width,0)}sY(C,O){var S=Object(e.a)(B,C);S=S?this.a6b(S):-1;if(2===O.type||1===O.type&&-1!==S&&!this.uw[S].visible)this.xKa(C);else if(1===O.type)this.YW(),this.y7=!1;else if(3===O.type){if(this.JRc(O.Bj))return;this.y7||this.YW()}this.raiseEvent(m.a.zw,O)}JRc(C){C=J.c8b(C);let O=!1;for(const S of this.uw)if(z.a.GVa(S.element,
C)){O=!0;break}return this.Sz!==C&&z.a.GVa(this.Sz,C)||O}Wwc(C,O=0){const S=this.hme(C);S&&0>=C.eP?this.uw[O].hide():S?this.xKa(C):this.uw[O].hide()}a6b(C){let O=0;for(const S of this.tm){if(C===S)return O;O++}return-1}hme(C){const O=this.a6b(C);return!!this.d_b&&C===this.d_b&&-1!==O&&this.uw[O].visible}Esc(C){this.xI=C===this.imageDimension?1:Math.floor(C/this.nMa);this.MG?(this.element.style.height=C+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=C+"px",this.element.style.height=
this.imageDimension+"px")}static R6b(){return String.format("{0}-{1}","presencetooltip",J.OOa++)}static c8b(C){C=C.mc.rawEvent;return C.relatedTarget||C.toElement}}J.OOa=0;Object(K.a)(J,"PresenceTooltipControl",r.a,[325,107]);var G=d(239),M=d(318),N=d(281);d.d(U,"a",function(){return R});class R{constructor(C){this.Yc=C;this.Yc.$Z(10,G.a.instance);this.Yc.$Z(9,N.a.instance);this.Yc.$Z(6,16);this.Yc.$Z(13,M.a.instance)}G0d(C,O){return new J(C,O,this.Yc)}h3b(C){return new J(C,16,this.Yc)}}Object(K.a)(R,
"PresenceTooltipFactory",null,[324])},1293:function(K,U,d){d.r(U);var h=d(0),e=d(392),r=d(7),m=d(18),n=d(77),z=d(82),v=d(37),x=d(3);class B{constructor(Xa,Bb,mc,Qc,td,Md,Pd,Be,fe=!1){this.DNa=null;this.OEd=!0;this.kMd=this.LS=this.oBd=null;this.Ma=new n.a;this.P2h=Xa;this.Wrf=Bb;this.fqf=mc;this.eqf=Qc;this.Obf=Md;B.Zd=td;this.N4h=Pd;this.sPa=Be;this.F5h=fe;x.Task.WAA(Bb,mc).continueWith(Object(r.a)(this,this.KMj,"initOnTaskReady"))}alh(){this.Ma.raiseEvent("u",null,this)}KMj(){this.Wrf.result&&this.fqf.result&&
(this.LS=this.Wrf.result,this.kMd=this.fqf.result,this.LS.mJc(Object(r.a)(this,this.Smc,"onPresenceUpdated")),this.oBd=new z.a(2,2,this.Obf,Object(r.a)(this,this.dNl,"updateAwayClientsTask"),88),B.Zd.Hb(this.oBd))}Smc(Xa,Bb){(this.OEd||this.j0k(Bb.iRb))&&B.Zd.E1(this.oBd,0)}j0k(Xa){for(let mc in Xa){var Bb=this.eqf.C$f({key:mc,value:Xa[mc]});if(Bb&&Bb.clientId&&(Bb=Bb.clientId.toLowerCase(),(Bb=this.DNa[Bb]||this.DNa[Bb.toUpperCase()])&&2===Bb.status))return!0}return!1}dNl(Xa){var Bb=this.LS.kaj();
if(Bb){var mc=new Date,Qc=!1;if(this.OEd){this.DNa=Bb;this.OEd=!1;var td=this.DNa;for(var Md in td){Bb=Md;var Pd=td[Md];Pd.nCb<mc&&(mc=Pd.nCb);2===Pd.status&&(Qc=!0,this.kMd.Wod(Bb))}Qc&&this.alh();B.Zd.E1(Xa,this.x9f(mc))}else{Pd=new m.a;Md=!1;var Be=this.DNa;for(td in Be){Be=td;if(!(Be in this.DNa)||this.P2h.clientId===Be)continue;var fe=this.DNa[Be];const Mf=Bb[Be];if(fe&&Mf){fe=fe.status;const Bd=Mf.status;2===fe&&1===Bd?(Pd.add(Be),e.ULS.sendTraceTag(38052609,392,50,Be+" returned from away")):
1===fe&&2===Bd&&(Md=Qc=!0,this.kMd.Wod(Be),e.ULS.sendTraceTag(38052610,392,50,Be+" went away"));1===Bd&&Mf.nCb<mc&&(mc=Mf.nCb)}}this.DNa=Bb;B.Zd.E1(Xa,this.x9f(mc));(0<Pd.count||Qc)&&this.alh();0<Pd.count&&!this.F5h?(Xa=this.Gcj(Pd),this.BGl(Xa)):Xa=new m.a;(Md||0<Xa.count)&&this.N4h(v.a.G8a,2)}}}BGl(Xa){if(Xa.count)for(let Bb of Xa)Xa=this.sPa.vDa(String.format(CommonUIStrings.l_EditorsToastArriving,Bb),!1),Xa.image=5,Xa.iea="CoAuth_AuthorStatus_16x16x32",this.sPa.ji(Xa)}Gcj(Xa){const Bb=this.LS.ZTc(),
mc=new m.a;for(let Qc in Bb){const td={key:Qc,value:Bb[Qc]};if(Xa.contains(td.key)){const Md=this.eqf.C$f(td);Md&&(mc.add(Md.userName),Xa.remove(td.key))}}mc.count||e.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return mc}x9f(Xa){return Math.max(Xa.getTime()+this.Obf-(new Date).getTime(),0)}}B.Zd=null;Object(h.a)(B,"AwayManager",null,[]);var D=d(584),w=d(27),J=d(252),G=d(56),M=d(346),N=d(71),R=d(1178),C=d(1095),O=d(1021),S=d(717),T=d(715),ca=d(195),L=d(1020),da=d(29),Z=d(460),
fa=d(201),aa=d(28),ja=d(796),I=d(47),sa=d(1244),ka=d(19),Ma=d(967),Ea=d(383),ma=d(41),va=d(62);class Ca{constructor(Xa,Bb){this.shapeNode=Xa;this.KEh=Bb}}Object(h.a)(Ca,"ShapeNodeStartEditingNotificationTracking",null,[]);class oa{constructor(Xa,Bb,mc,Qc,td="",Md=""){if(!Xa||!Bb||0>mc)throw Error.argumentNull("LockEntry");this.Lx=Xa;this.SB=Bb;this.Hfa=mc;this.Ykk=Qc;this.N_g=td;this.E_g=Md;this.SLg=new Date}get clientId(){return this.Lx}get Cud(){return this.SB}get shapeId(){return this.Hfa}get lockType(){return this.Ykk}get tHh(){return this.N_g}get fHh(){return this.E_g}get ssg(){return!I.a.Xa(this.E_g)&&
!I.a.Xa(this.N_g)}get vug(){return this.SLg}set vug(Xa){this.SLg=Xa}}Object(h.a)(oa,"LockEntry",null,[]);class Da{constructor(Xa,Bb,mc,Qc,td="",Md=""){this.clientId=Xa;this.slideId=Bb;this.shapeId=mc;this.lockType=Qc;this.rowId=td;this.cellId=Md}}Object(h.a)(Da,"SerializableLockData",null,[]);var ta=d(189),ha=d(219);class Ha{constructor(Xa,Bb,mc,Qc,td,Md,Pd,Be,fe,Mf,Bd,Rc,Gf,Nf,Oa,cb,Ic,qd,le,yb,ef,Cb){this.Vxj=new D.a("",ResourceStrings.L_GhostUserName,Ma.a.RRf,new ja.a(1));this.sFb={};this.tFb=
{};this.rFb={};this.xLg=da.App.pn;this.bCe=null;this.rFe={};this.F5c={};this.I5c={};this.yLg=da.App.pn;this.v_g=!0;this.MNg=this.PMg=0;this.Pad=(new Date(0)).getTime();this.Qad=(new Date(0)).getTime();this.sic=(new Date(0)).getTime();this.FDe=(new Date(0)).getTime();this.u_g=!1;this.iXa=Xa;this.LE=Bb;this.CFb=mc;this.ijc=Qc;this.Tb=td;this.wb=Md;this.pa=Pd;this.Ffk=Be;this.rr=fe;this.Ga=Mf;this.zc=Bd;this.Bic=Rc;this.yve=Gf.nng;this.Ns=Nf;this.lY=Oa;this.ta=cb;this.SYg=Ic;this.nd=qd;this.nd.eii(Object(r.a)(this,
this.IHk,"onShapeViewElementRequestUpdateAuthorInfo"));(this.Sv=w.AFrameworkApplication.fa.ka("PPTCanvasPresenceBubbleUXEnabled"))&&this.pa.fE(Object(r.a)(this,this.QH,"onSelectionChanged"));this.ijc.ECa(Object(r.a)(this,this.onc,"onUpdateNotificationReceived"));this.hsk=le;this.We=yb;this.frk=ef;this.Ea=Gf;this.fZa=Cb;this.QMj()}QMj(){aa.a.J(509219588,828,50,"CoauthStateChangesHandler:InitRttRelatedTasks - IsDedicatedSession: {0}, RttLockSettings: {1}",this.yve,this.Ns.$ck());this.Ns.E3d||(0<this.Ns.$jb?
this.wb.Hb(new z.a(2,2,this.Ns.$jb,Object(r.a)(this,this.removeExpiredLock,"removeExpiredLock"),90,"71")):aa.a.J(509219587,804,10,"RemoveExipredLockIntervalMs is not set correctly while RTT lock is enabled"),0<this.Ns.EPb?(this.wb.Hb(new z.a(2,2,this.Ns.EPb/2,Object(r.a)(this,this.switchPendingSveToFidelity,"switchPendingSveToFidelity"),90,"72")),this.v_g=!1):aa.a.J(509219586,804,50,"Switch to fidelity delay after unlock is disabled"),0<this.Ns.z$b?this.wb.Hb(new z.a(2,2,this.Ns.z$b,Object(r.a)(this,
this.updateLockIfImeActive,"updateLockIfImeActive"),90,"73")):aa.a.J(509219585,804,50,"IME typing lock notification disabled"),0<this.Ns.Ahb?this.wb.Hb(new z.a(2,2,this.Ns.Ahb,Object(r.a)(this,this.detectLockLeak,"detectLockLeak"),90,"74")):aa.a.J(509219584,804,50,"Lock leack detection is disabled"),this.Ffk.addHandler(Ea.a.yMf,(Xa,Bb)=>{this.jEi(Bb)}),this.Ns.eQc||this.$uc||(this.Bic.BCa(Object(r.a)(this,this.W7g,"onBeforeParagraphNodePropertyChanged")),0<this.Ns.nnb?this.wb.Hb(new z.a(2,2,this.Ns.nnb,
Object(r.a)(this,this.updateLockForActiveShapeNodes,"updateLockForActiveShapeNodes"),90,"75")):aa.a.J(509219555,804,15,"DedicatedWorkerTypingUpdateIntervalMs is not set correctly")),this.$uc&&(this.frk.BCa(Object(r.a)(this,this.akd,"onTableCellNodePropertyChanged")),this.Bic.BCa(Object(r.a)(this,this.W7g,"onBeforeParagraphNodePropertyChanged")),this.hsk.initialize(),0<this.Ns.nnb&&this.wb.Hb(new z.a(2,2,this.Ns.nnb,Object(r.a)(this,this.updateLockForActiveTableCellNodes,"updateLockForActiveTableCellNodes"),
90,"76")),0<this.Ns.$jb&&this.wb.Hb(new z.a(2,2,this.Ns.$jb,Object(r.a)(this,this.removeExpiredTableCellLock,"removeExpiredTableCellLock"),90,"77"))))}get $uc(){return this.Ns.a5d&&this.Ns.EWf}removeExpiredLock(){var Xa=ha.a(this.sFb);for(const Bb of Xa){Xa=Object(sa.a)(119,this.sFb[Bb]);if(!Xa){delete this.sFb[Bb];continue}const mc=Xa.shapeNode;mc&&mc.isConnected?this.lY.B6f(mc)||this.Pmd(Bb)||(delete this.sFb[Bb],this.lY.t7b(mc)||Xa.Nl?aa.a.J(509219554,814,50,"Previous non wet changes lock is expired but the shape contains wet changes now"):
this.nMh(Xa)):delete this.sFb[Bb]}}removeExpiredTableCellLock(){var Xa=ha.a(this.tFb);for(const Bb of Xa){Xa=Object(sa.a)(1128,this.tFb[Bb]);if(!Xa){delete this.tFb[Bb];continue}const mc=Xa.tableCellNode;mc&&mc.isConnected?I.a.Xa(this.lY.h7b(mc))&&!this.Pmd(Bb)&&(delete this.tFb[Bb],this.oMh(Xa)):delete this.tFb[Bb]}}detectLockLeak(){const Xa=[],Bb=new Date,mc=this.ddg();for(const Qc of mc)Qc.hq&&+Bb-+Qc.S4c>this.Ns.Ahb&&Xa.push(Qc.shapeNode.Kr);0<Xa.length&&aa.a.J(509219553,828,15,"Following objects are locked longer than {0} : {1}",
this.Ns.Ahb,Xa.join(";"))}switchPendingSveToFidelity(){const Xa=new Date,Bb=this.ddg();for(const mc of Bb)mc.hq||mc.shapeNode.vd&&this.$uc||!mc.io||mc.ry||!(+Xa-+mc.R$j>this.Ns.EPb)||mc.CB||mc.DPb()}updateLockIfImeActive(){if(this.xLg>=this.yLg&&this.bCe){const Xa=this.l5i(this.bCe);this.ezd(Xa)&&this.xsc(Xa.slideId,Xa.get_shapeId(),2)}this.yLg=new Date}updateLockForActiveShapeNodes(){var Xa=ha.a(this.F5c);for(const Bb of Xa)Xa=Object(sa.a)(4,this.F5c[Bb]),this.ezd(Xa)&&this.xsc(Xa.slideId,Xa.get_shapeId(),
3);this.F5c={}}updateLockForActiveTableCellNodes(){var Xa=ha.a(this.I5c);for(const Bb of Xa)if(Xa=Object(sa.a)(130,this.I5c[Bb]),this.ezd(Xa)){const mc=this.Ga.vn(Xa);this.xsc(mc.slideId,mc.get_shapeId(),3,Xa.rowId.toString(),Xa.cellId.toString())}this.I5c={}}l5i(Xa){return(Xa=this.rr.$I(Xa))?this.Ga.vn(Xa.gb):null}W7g(Xa,Bb){Bb&&Bb.node?(Xa=Object(sa.a)(5,Bb.node),Xa)?Xa.loading||Xa.mpc||Bb.property.id!==ma.a.tq.id||(Bb=this.Ga.Tda(Xa),Xa=this.zc.gFa(Xa),Bb&&(Xa?(Bb=this.pUc(Bb.slideId,Bb.get_shapeId(),
Xa.rowId.toString(),Xa.cellId.toString()),this.I5c[Bb]=Xa):(Xa=this.Wyb(Bb.slideId,Bb.get_shapeId()),this.F5c[Xa]=Bb))):aa.a.J(509219551,828,10,"Invalid argument."):aa.a.J(509219552,828,10,"Invalid argument.")}yfl(Xa){const Bb=new z.a(2,1,this.Ns.Rud,Object(r.a)(this,this.rtcNotifyStartEditing,"rtcNotifyStartEditing"),90,"78");Bb.customData=new Ca(Xa,!1);this.wb.Hb(Bb);this.rFe[this.Wyb(Xa.slideId,Xa.get_shapeId())]=Bb}rtcNotifyStartEditing(Xa){Xa=Object(sa.a)(Ca,Xa.customData);const Bb=Xa.shapeNode;
this.ezd(Bb)&&this.N3j(Bb)&&this.xsc(Bb.slideId,Bb.get_shapeId(),1);Xa.KEh=!0}ezd(Xa){return Xa?Xa.isConnected:!1}N3j(Xa){return(Xa=this.rk(Xa))?Xa.pO:!1}rk(Xa){return Object(sa.a)(119,Xa.tg(this.Tb.Mn.Na))}ddg(){const Xa=[];if(!this.ta.Ba)return Xa;var Bb=this.ta.Ba.Uj();if(!Bb)return Xa;for(const mc of Bb)(Bb=this.rk(mc))&&!Bb.Nl?Xa.push(Bb):aa.a.J(509219549,828,50,"Shape {0} on active slide doesn't have valid view element",mc.Kr);return Xa}yHk(Xa){this.$Ah(Xa)&&(this.iXa.amIAlone||this.yfl(Xa))}QH(Xa,
Bb){for(Xa=0;Xa<Bb.XE.length;Xa++){const Qc=Bb.XE[Xa];var mc=Object(sa.a)(4,Qc.context.node);mc&&mc.isConnected&&(mc=Object(sa.a)(119,mc.qc(this.We)))&&(mc=this.SYg.dJ(mc.shapeNode))&&(1===Qc.uda?mc.Elc():0===Qc.uda&&mc.kJe())}}xHk(Xa){if(this.$Ah(Xa)&&!this.Ns.cQc){var Bb=this.Wyb(Xa.slideId,Xa.get_shapeId()),mc=Object(sa.a)(z.a,this.rFe[Bb]);if(mc){const Qc=Object(sa.a)(Ca,mc.customData);this.wb.Lg(mc);Qc&&Qc.KEh&&this.xsc(Xa.slideId,Xa.get_shapeId(),4);this.rFe[Bb]=null}}}IHk(Xa,Bb){this.och(Bb.$w)}och(Xa){Xa.iJ()||
Xa.shapeNode.Wbb?this.Gci(Xa):this.pch(Xa)}akd(Xa,Bb){if((Bb=Object(sa.a)(ta.TableCellNode,Bb.node))&&(Xa=Object(sa.a)(1128,Bb.tg(this.We)))&&Bb.isConnected){Bb=this.lY.h7b(Bb);const mc=this.gSe(Xa.tableCellNode);I.a.Xa(Bb)?mc?(this.fse(Xa,this.Ska(mc.clientId,Ha.N4d)),this.q9e(Xa)):I.a.Xa(Bb)&&(this.gSe(Xa.tableCellNode)||this.oMh(Xa)):(this.fse(Xa,this.Ska(Bb,Ha.N4d)),this.q9e(Xa))}}fse(Xa,Bb){Xa.lock(Bb)}oMh(Xa){Xa.unlock()}xsc(Xa,Bb,mc,Qc="",td=""){try{const Md=new Da(this.CFb,Xa.Gxc,Bb,mc,Qc,
td);this.ijc.Xaa(7,Md)}catch(Md){aa.a.J(509219548,814,10,"LockManager.SendLockNotification : MyClientId: {0}; Exception: {1}. ",this.CFb,Md.stack)}}onc(Xa,Bb){this.Ea.pptCoauthSurveyFloodgateEnabled&&!this.u_g&&8===Bb.type&&this.fZa&&this.qul(Bb)&&(aa.a.J(509219547,814,50,"Log coauth activity"),this.u_g=!0,this.fZa.continueWith(()=>{this.fZa.result.logActivity("CoauthContentMerge","PptCoauthSurveyFloodgateEnabled")}));7===Bb.type&&((Xa=Bb.jAa)?Xa.clientId===this.CFb?aa.a.J(509219545,828,15,"Lock notification : lock notification from myself recieved"):
(aa.a.J(509219544,828,50,"Lock notification : LockClientId {0}, MyClientId: {1}.",Xa.clientId,this.CFb),Xa=new oa(Xa.clientId,Xa.slideId,Xa.shapeId,Xa.lockType,Xa.rowId,Xa.cellId),this.Vci(Xa),this.AUk(Xa)):aa.a.J(509219546,828,10,"Lock notification: invalid lock data recieved"))}pch(Xa){if(!Xa||Xa.Nl)aa.a.J(509219543,828,15,"UpdateAuthorInfoTaskHandler: shapeViewElement is null: {0}.",!Xa);else{var Bb=Xa.shapeNode;if(!(Bb.Wf||this.yve&&Bb.vd&&(this.Ns.dwb||this.$uc))){var mc=this.lY.t7b(Bb);mc?this.R4c(Xa,
this.Ska(mc,Ha.N4d)):(Bb=this.lY.B6f(Bb))?(this.R4c(Xa,this.Ska(Bb,Ha.BXi)),this.p9e(Xa)):(Bb=this.gSe(Xa.shapeNode))?(this.R4c(Xa,this.Ska(Bb.clientId,this.abe(Bb.lockType))),this.p9e(Xa)):Xa.hq&&this.nMh(Xa)}}}nMh(Xa){const Bb=this.SYg.dJ(Xa.shapeNode);Bb&&(Bb.Byd(null),Xa.unlock(this.v_g||!Bb.Xfe))}R4c(Xa,Bb){Xa.lock(Bb);Xa.iJ()&&this.pa.nh()}qul(Xa){if(!Xa||null===Xa.jAa)return!1;Xa=this.WMk(Xa.jAa);for(const Bb of Xa)Bb&&Bb.clientId&&(Bb.clientId.toLowerCase()===this.CFb.toLowerCase()?(this.PMg++,
this.Pad=this.Pad===(new Date(0)).getTime()?(new Date).getTime():this.Pad,this.Qad=(new Date).getTime()):this.QZj(Bb.clientId)||(this.MNg++,this.sic=this.sic===(new Date(0)).getTime()?(new Date).getTime():this.sic,this.FDe=(new Date).getTime()));return 5<=this.PMg&&5<=this.MNg&&(this.FDe>=this.Pad&&this.sic<=this.Qad||this.Qad>=this.sic&&this.Qad<=this.FDe)&&1<=this.LE.Jyb()?!0:!1}WMk(Xa){let Bb=null;try{Bb=Xa}catch(mc){}if(null===Bb||!Bb.length){let mc=null;try{mc=Xa}catch(Qc){aa.a.J(509219541,828,
10,"UpdateHint can't convert to RTC message.")}if(null!==mc)return[mc]}return Bb}QZj(Xa){Xa=this.Ska(Xa);const Bb=this.Ska(this.CFb);return Xa&&Bb&&Xa.userName===Bb.userName&&Xa.email===Bb.email?!0:!1}abe(Xa){switch(Xa){case 1:return Ha.GAl;case 2:return Ha.pLj;case 3:return Ha.iLl;case 4:return Ha.RYi}aa.a.J(509219539,828,10,"Unknown lock type");return"Unknown lock type"}Vci(Xa){if(Xa&&Xa.Cud){var Bb=Xa.ssg?this.pUc(new va.a(Xa.Cud),Xa.shapeId,Xa.tHh,Xa.fHh):this.Wyb(new va.a(Xa.Cud),Xa.shapeId);
if(4===Xa.lockType)this.rFb[Bb]=Xa;else{var mc=Object(sa.a)(oa,this.rFb[Bb]);mc?(mc=this.$ae(mc),this.$ae(Xa)>mc&&(this.rFb[Bb]=Xa)):this.rFb[Bb]=Xa}}}$ae(Xa){return this.Gkj(Xa.lockType)-(+new Date-+Xa.vug)}Gkj(Xa){switch(Xa){case 1:return this.Ns.Qud;case 2:return this.Ns.CZc;case 3:return this.Ns.Hxd;case 4:return this.Ns.Bwb}aa.a.J(509219536,828,10,"Unknown lock type");return 0}gSe(Xa){if(Object(ka.a)(4,Xa)){Xa=Object(sa.a)(4,Xa);if(!Xa.slideId)return null;Xa=this.Wyb(Xa.slideId,Xa.get_shapeId());
return this.Pmd(Xa)}if(Object(ka.a)(130,Xa)){Xa=Object(sa.a)(130,Xa);let Bb=this.Ga.Tda(Xa);if(!Bb.slideId)return null;Xa=this.pUc(Bb.slideId,Bb.get_shapeId(),Xa.rowId.toString(),Xa.cellId.toString());return this.Pmd(Xa)}return null}Pmd(Xa){if(!Xa)return null;const Bb=Object(sa.a)(oa,this.rFb[Xa]);return Bb?0>=this.$ae(Bb)?this.rFb[Xa]=null:Bb:null}p9e(Xa){const Bb=this.Brj(Xa);Bb&&(this.sFb[Bb]=Xa)}q9e(Xa){const Bb=this.juj(Xa);Bb&&(this.tFb[Bb]=Xa)}Brj(Xa){return Xa?this.Wyb(Xa.shapeNode.slideId,
Xa.shapeNode.get_shapeId()):null}juj(Xa){if(!Xa)return null;Xa=Xa.tableCellNode;const Bb=this.Ga.Tda(Xa);return this.pUc(Bb.slideId,Bb.get_shapeId(),Xa.rowId.toString(),Xa.cellId.toString())}Wyb(Xa,Bb){return String.format("{0}#{1}#{2}",Xa.sid,Xa.cid,Bb)}pUc(Xa,Bb,mc,Qc){return String.format("{0}#{1}#{2}#{3}#{4}",Xa.sid,Xa.cid,Bb,mc,Qc)}uZj(Xa){const Bb=Object(sa.a)(118,this.ta.Ba);return Bb&&va.a.tDh(Xa.Cud,Bb.Db.Gxc)?!0:!1}AUk(Xa){if(this.uZj(Xa)){var Bb=Xa.shapeId,mc=Xa.clientId;this.ta.Ba&&(Bb=
this.ta.Ba.GQ(Bb))&&(Xa.ssg&&this.Ns.a5d?this.NUk(Xa,mc,Bb):this.HUk(Xa,mc,Bb))}}HUk(Xa,Bb,mc){mc.Wf||this.yve&&mc.vd&&(this.Ns.dwb||this.$uc)||!(mc=this.rk(mc))||(this.R4c(mc,this.Ska(Bb,this.abe(Xa.lockType))),this.p9e(mc))}NUk(Xa,Bb,mc){if((mc=this.luj(mc,Xa.tHh,Xa.fHh))&&mc.isConnected){var Qc=Object(sa.a)(1128,mc.tg(this.We));Qc&&I.a.Xa(this.lY.h7b(mc))&&(this.fse(Qc,this.Ska(Bb,this.abe(Xa.lockType))),this.q9e(Qc))}}luj(Xa,Bb,mc){Xa=this.zc.ZN(Object(sa.a)(4,Xa));if(!Xa)return null;var Qc=this.zc.Zka(Xa);
Xa=null;for(const td of Qc){Qc=this.zc.Aab(td);for(const Md of Qc)if(Md.rowId.toString()===Bb&&Md.cellId.toString()===mc){Xa=Md;break}}return Xa}Gci(Xa){const Bb=new z.a(0,1,0,()=>{this.pch(Xa)},90,"79");this.wb.Hb(Bb)}jEi(Xa){this.xLg=new Date;this.bCe=this.u4i(Xa.Bc)}u4i(Xa){return Xa?Xa.querySelector(".Paragraph"):null}Ska(Xa,Bb=""){const mc=this.LE.Ska(Xa);if(mc)return mc;aa.a.J(509219531,828,50,"Failed to find presence user for client id: {0}; DataSource: {1}.",Xa,Bb);return this.Vxj}$Ah(Xa){return!this.Ns.E3d&&
!(this.Ns.dwb&&Xa.vd)&&!Xa.Wf}}Ha.N4d="EditingBy";Ha.BXi="EditingByInSameWorker";Ha.GAl="StartEditing";Ha.RYi="EndEditing";Ha.pLj="ImeTyping";Ha.iLl="Typing";Object(h.a)(Ha,"CoauthStateChangesHandler",null,[1149]);class bb{constructor(Xa){this.sva={};this.Lx=Xa.AD;this.init(Xa)}init(Xa){if(Xa=Xa.v_)for(const Bb of Xa)Bb.ID!==this.Lx&&(this.sva[Bb.ID]=new Date)}Kbi(Xa){for(let Bb=0;Bb<Xa.length;Bb++)Xa[Bb]in this.sva||Xa[Bb]===this.Lx||(this.sva[Xa[Bb]]=new Date)}GBl(Xa){const Bb=this.sva[Xa];Bb&&
(aa.a.J(37590341,814,50,"EditorPresenceTracker : Presence of coauthoring user never appeared, but leaving coauth; MyClientID: {0}; Coauthor clientID: {1}; TimeElapsed: {2}",this.Lx,Xa,(new Date).getTime()-Bb.getTime()),delete this.sva[Xa])}FBl(Xa){const Bb=this.sva[Xa];Bb&&(aa.a.J(37590343,814,50,"EditorPresenceTracker : Presence of coauthoring user appeared; MyClientID: {0}; Coauthor clientID: {1}; TimeElapsed: {2}",this.Lx,Xa,(new Date).getTime()-Bb.getTime()),delete this.sva[Xa])}EBl(){for(const Xa of Object.keys(this.sva))aa.a.J(37590345,
814,15,"EditorPresenceTracker : Presence of coauthoring user never appear; MyClientID: {0}; Coauthor clientID: {1}; TimeElapsed: {2}",this.Lx,Xa,(new Date).getTime()-this.sva[Xa].getTime());this.sva={}}}Object(h.a)(bb,"EditorPresenceTracker",null,[1150]);class Na{constructor(Xa){this.Nok=Xa;this.GM=new C.a;this.GM.Og(this.Nok)}}Object(h.a)(Na,"PPTRtcProvider",null,[1148]);var Ia=d(106),Qa=d(1243),qa=d(712);class Wa{constructor(Xa,Bb,mc,Qc,td){this.cfa=null;this.wU=!1;this.$ue=this.KCe=null;this.Lfk=
Ia.a.create();this.Z7c=!1;this.h6b=0;this.$X=td;mc.yg&&(this.findSessionResponse=Xa,Qc.Nzf(Object(r.a)(this,this.Dil,"sessionPropertiesChanged")));this.xHa=new Qa.a(()=>Bb())}get findSessionResponse(){return this.cfa}set findSessionResponse(Xa){if(this.wU)aa.a.J(50943949,814,15,"PptAssignRtcMachineStrategy : FindSessionResponse Not updating cached find session response as it is already set");else if(this.cfa=Xa)this.wU=!0,this.KCe=this.cfa.rMf,this.$ue=this.cfa.rB}get Rna(){return this.wU?this.KCe:
this.xHa.value.Rna}set Rna(Xa){this.wU?this.KCe=Xa:this.xHa.value.Rna=Xa}B_e(Xa){this.xHa.value.B_e(Xa)}get rB(){return this.wU?this.$ue:this.xHa.value.rB}set rB(Xa){this.wU?this.$ue=Xa:this.xHa.value.rB=Xa}rVc(){let Xa;aa.a.J(51140180,814,50,"PptAssignRtcMachineStrategy : OnConnectionStateChanged isFindSessionResponseValid:{0}, havePerformedFindSessionWithLazyStrategy:{1}",this.wU,this.Z7c);return this.wU?(Xa=this.cfa.correlationId||this.Lfk.toString(),aa.a.J(40130654,500,50,"CorrelationId after FindSession: {0}",
Xa),{returnValue:String.format("{0}&{1}={2}",this.cfa.o6,w.AFrameworkApplication.g0d,I.a.Qe(Xa)),correlationId:Xa}):this.Z7c?this.xHa.value.rVc():(aa.a.J(51140183,814,50,"PptAssignRtcMachineStrategy : GetFindSessionRequestQs returning null QS to avoid crashing"),{returnValue:null,correlationId:null})}yce(Xa,Bb,mc,Qc,td){aa.a.J(51140185,814,50,"PptAssignRtcMachineStrategy : GetRtcMachine isFindSessionResponseValid:{0}",this.wU);this.wU?(Xa(this.cfa.D2b),mc(new qa.a(this.cfa.agd,this.cfa.Yfd,this.cfa.Xfd,
this.cfa.VXc))):(this.xHa.value.yce(Xa,Bb,mc,Qc,td),this.Z7c=!0);this.$X&&this.$X.ji(26,!this.Z7c)}X3d(){aa.a.J(51140187,814,50,"PptAssignRtcMachineStrategy : GetRtcMachine isFindSessionResponseValid:{0}",this.wU);this.wU?this.wU=!1:this.xHa.value.X3d()}goa(Xa,Bb){aa.a.J(51140189,814,50,"PptAssignRtcMachineStrategy : GetRtcMachine isFindSessionResponseValid:{0}",this.wU);this.wU||this.xHa.value.goa(Xa,Bb)}Dil(){aa.a.J(40464838,814,50,"PptAssignRtcMachineStrategy : SessionPropertiesChanged; FindSessionQs refreshed isFindSessionResponseValid:{0}",
this.wU);this.wU=!1}}Object(h.a)(Wa,"PptAssignRtcMachineStrategy",null,[1147]);var Hb=d(1198);class jc{constructor(){this.Xn=null}I_b(Xa,Bb){this.Xn||(this.Xn={});this.Xn[Bb]||(this.Xn[Bb]=0);this.Xn[Bb]+=Xa}getData(){return this.Xn}reset(){this.Xn=null}}Object(h.a)(jc,"MultiSumDataAggregator",null,[1536]);class gc{constructor(Xa,Bb){this.NAd=Hb.a.PW(Xa,Bb,new jc,!0)}Kf(Xa){this.NAd.track(1,Xa)}}Object(h.a)(gc,"MultiCounter",null,[1568]);class $b{constructor(Xa,Bb,mc,Qc){this.Fz=Xa;this.x5=Bb;this.Prk=
mc;this.Kik=Qc;this.Fz.ECa(Object(r.a)(this,this.wdl,"rtcOnUpdateNotificationReceived"))}wdl(Xa,Bb){0===Bb.type&&(this.Kik.Kf("CU"),this.Prk||this.QF())}QF(){!w.AFrameworkApplication.Yg&&this.x5.nX&&this.x5.QF(null,null,null)}}Object(h.a)($b,"ContentNotificationManager",null,[]);class wb extends $b{constructor(Xa,Bb,mc,Qc){super(Xa,Bb,mc,Qc)}static init(){if(da.App.Lb){var Xa=da.App.Lb.Kd;if(Xa&&(Xa.Nyf(wb.F7g),Xa=Xa.Di)&&(Xa=Xa.contentReplicator)){var Bb=da.App.Mh;if(Bb&&Bb.Bw&&(Bb=G.a.instance.resolve("AppRealtimeChannel.IRealtimeChannel"))){var mc=
w.AFrameworkApplication.fa.ka("Box4ThrottleInboundRequests"),Qc=new gc(11,1);wb.v6c=wb.v6c||new wb(Bb,Xa,mc,Qc);wb.v6c.QF()}}}}static F7g(Xa){wb.v6c||(Xa.poh(wb.F7g),wb.init())}}wb.v6c=null;Object(h.a)(wb,"PptContentNotificationManager",$b,[]);var Db=d(105),Xb=d(353),ab=d(96),Ab;(function(Xa){Xa[Xa.signalRConnectFailed=0]="signalRConnectFailed";Xa[Xa.findSessionFailed=1]="findSessionFailed"})(Ab||(Ab={}));Object(h.b)("RtcConnectFailureType",Ab);var rc=d(261),tb=d(33);class Za{constructor(Xa,Bb,mc,
Qc,td,Md){this.Yad=this.bNg=this.Hfb=this.Gfb=0;this.qfb=this.$Ha=this.Xma=this.whc=this.s8c=this.A0=null;this.S8c=this.U8c=this.V8c=this.Q8c=this.R8c=!1;this.$Xg=Xa;this.Ej=Bb;this.WX=mc;this.WX.cTd(Object(r.a)(this,this.YIb,"onNetworkHealthStateChanged"));this.jk=Qc;this.nFe=Md;$addHandler(window,"visibilitychange",Object(r.a)(this,this.onVisibilityChange,"onVisibilityChange"));this.Bpk=td;this.Bpk.Vhi(Object(r.a)(this,this.UGk,"onRtcConnectFailed"))}YIb(Xa,Bb){Bb.Doe||(this.U8c=this.V8c=!0)}onVisibilityChange(){window.document.hidden&&
(this.Q8c=this.R8c=!0)}UGk(Xa,Bb){Xa=Bb.T2i;if(Bb=Bb.errorMessage){if(0===Xa){let Qc,td;({Tge:mc,Uge:Qc,ej:td}=ca.RtcUtils.qZf(Bb.ErrorDetails));Bb.HttpErrorCode=mc;Bb.HttpErrorStatus=Qc;Bb.Exception=td;delete Bb.ErrorDetails;if(!mc&&this.nFe&&0<this.nFe.length)try{var mc=!0;const Md=window.location.hostname.toLowerCase();for(const Pd of this.nFe.split(";"))if(Md.endsWith(Pd)){mc=!1;break}Bb.IsCORS=mc.toString()}catch(Md){Bb.Unexpected=Md.message}}aa.a.J(508946247,500,15,"PptRealtimeChannelMetrics:OnRtcConnectFailed; AmIAlone:{0}; IsPageHidden:{1}; IsNetworkHealthy:{2}; rtc connect failed type:{3}; errorMessage:{4}",
this.Ej.amIAlone,window.document.hidden,this.jk.UQ,Ab[Xa],Db.a.toJSON(Bb));this.S8c||(this.S8c=this.S2j(Xa,Bb))}}S2j(Xa,Bb){const mc=rc.c(Bb,"HttpErrorCode",-1);return 500<=mc&&599>=mc||1===Xa&&"FindSessionRequestFailed"!==Bb.FindSessionFailureReason?!0:!1}Qgg(){return this.A0&&1===this.Hfb?this.R8c||this.V8c:this.Xma&&1<this.Hfb?this.Q8c||this.U8c:!1}Pgg(){return this.Xma&&0<this.Yad?this.Q8c||this.U8c:this.A0&&0<this.Gfb?this.R8c||this.V8c:!1}pod(){this.Gfb++;this.whc=new Date;this.A0||(this.A0=
new Date,this.R8c=window.document.hidden,this.V8c=!this.jk.UQ)}UTe(){this.Flh(0)}Flh(Xa){this.Hfb++;this.$Ha=new Date;this.s8c?this.vNc>this.$Xg.Hsh&&(Xa={["hasExceededReconnectionThrehold"]:!0,["numberOfSuccessfullConnections"]:this.Hfb,["numberOfConnectionAttempts"]:this.Gfb,["firstConnectionAttempt"]:this.A0?this.A0.toISOString():"",["lastConnectionSuccess"]:this.$Ha?this.$Ha.toISOString():"",["lastUnexpectedDisconnect"]:this.Xma?this.Xma.toISOString():"",["lastExplicitDisconnect"]:this.qfb?this.qfb.toISOString():
"",["reconnectDurationInMs"]:this.vNc,["hasPageHiddenOrNetworkIssue"]:this.Qgg()},aa.a.J(36804373,500,15,Db.a.toJSON(Xa))):(this.s8c=this.$Ha,Xb.a.instance.lc("FirstPresenceUpdated",(new Date).getTime().toString()),this.vNc>this.$Xg.Hsh&&(Xa={["hasExceededConnectionThrehold"]:!0,["numberOfConnectionAttempts"]:this.Gfb,["firstConnectionAttempt"]:this.A0?this.A0.toISOString():"",["firstConnectionSuccess"]:this.s8c?this.s8c.toISOString():"",["lastExplicitDisconnect"]:this.qfb?this.qfb.toISOString():
"",["connectDurationInMs"]:this.vNc,["connectionDurationFromStopWatchInMs"]:Xa,["hasPageHiddenOrNetworkIssue"]:this.Qgg()},aa.a.J(36804373,500,15,Db.a.toJSON(Xa))))}qod(){this.bNg++;const Xa={["numberOfFailedConnections"]:this.bNg,["numberOfConnectionAttempts"]:this.Gfb,["firstConnectionAttempt"]:this.A0?this.A0.toISOString():"",["lastConnectionAttempt"]:this.whc?this.whc.toISOString():"",["lastExplicitDisconnect"]:this.qfb?this.qfb.toISOString():"",["lastConnectionFail"]:(new Date).toISOString(),
["disconnectedDurationMs"]:this.fUf,["hasPageHiddenOrNetworkIssue"]:this.Pgg()};this.S8c?(e.ULS.sendTraceTag(508946246,500,15,Db.a.toJSON(Xa)),this.Qlh("ClientRTCSetupFailureDueToServerError")):(e.ULS.sendTraceTag(36804375,500,15,Db.a.toJSON(Xa)),this.Qlh("ClientRTCSetupFailureDueToClientError"))}Qlh(Xa){!this.Pgg()&&5E3<this.fUf&&tb.a("ClientRTCSetupFailureQoSErrorEnabled")&&ab.Health.instance.recordQosError(Xa,["PresenceExperienceDegraded"],!1,!0,!0,!1,null)}xqc(){this.Yad++;this.Xma=new Date;this.Q8c=
window.document.hidden;this.U8c=!this.jk.UQ}Q0k(){this.ctl()&&this.qod();this.qfb=new Date;this.fBi()}fBi(){this.Yad=this.Hfb=this.Gfb=0;this.$Ha=this.Xma=this.whc=this.A0=null;this.S8c=!1}ctl(){return!!this.whc&&!this.$Ha&&!this.Xma}get vNc(){if(this.$Ha){if(this.A0&&1===this.Hfb)return this.Ej.yUc(this.A0,this.$Ha);if(this.Xma&&1<this.Hfb)return this.Ej.yUc(this.Xma,this.$Ha)}return 0}get fUf(){return this.Xma&&0<this.Yad?this.Ej.yUc(this.Xma,new Date):this.A0&&0<this.Gfb?this.Ej.yUc(this.A0,new Date):
0}}Object(h.a)(Za,"PptRealtimeChannelMetrics",null,[1146]);var fb=d(75),ac=d(34),Dc=d(39);class Sc{constructor(Xa,Bb,mc,Qc,td){this.Llk=Xa.toLowerCase();this.gIa=Bb;this.Yl=mc;this.Pr=Qc;this.Vq=td;this.Pr.jja(Object(r.a)(this,this.anc,"onShapeNodeLoaded"));this.Vq.Szf(Object(r.a)(this,this.cnc,"onShapeViewElementUnlocked"))}dispose(){this.Pr.A0a(Object(r.a)(this,this.anc,"onShapeNodeLoaded"));this.Vq.lph(Object(r.a)(this,this.cnc,"onShapeViewElementUnlocked"))}LC(Xa){return this.cHi(Xa)||this.bNf(Xa)}bNf(Xa){if(!Xa||
Xa.Wf)return!1;const Bb=Xa.sa(Dc.a.M4d,"");return+new Date-+Xa.S4c<this.gIa&&!!Bb&&Bb.toLowerCase()!==this.Llk}cHi(Xa){return!!this.t7b(Xa)}B6f(Xa){let Bb="";Xa&&this.bNf(Xa)&&(Bb=Xa.eb(Dc.a.M4d));return Bb}t7b(Xa){return Xa?Xa.sa(Dc.a.QVf,""):""}h7b(Xa){return Xa?Xa.sa(Dc.a.Oxi,""):""}jQl(Xa){if(Xa&&(Xa.LC=this.LC(Xa),Xa.anchor)){const mc=this.Yl.Msa(Xa);for(;mc.moveNext();){var Bb=mc.currentNode;ac.ParagraphReader.ae(Bb)&&(Bb=Object(sa.a)(fb.AParagraphNode,Bb))&&(Bb.LC=Xa.LC)}}}cnc(Xa,Bb){this.jQl(Bb.$w.shapeNode)}anc(Xa,
Bb){Xa=Bb.node;Xa.cPl();Xa.LC=this.LC(Xa)}}Object(h.a)(Sc,"PptWetChangeHandler",null,[1145,107]);class xb{constructor(Xa){this.pok=Xa}X3(){return this.pok.X3()}}Object(h.a)(xb,"PresenceCache",null,[]);var Ta=d(675),ib=d(1177),ob=d(1268),fc=d(1050),Jb=d(1256);class xc extends n.a{constructor(){super();this.$bd=[]}fja(Xa){Xa&&(aa.a.J(8958528,814,50,"PresenceDataManager : AddPresence; clientId: {0}; presence: {1}",Xa.clientId,Xa.presence.toString()),Array.add(this.$bd,Xa))}Wod(Xa){(Xa=this.Iab(Xa))&&
this.XLb(Xa);return Xa}XLb(Xa){Xa&&(aa.a.J(8958530,814,50,"PresenceDataManager : RemovePresence; clientId: {0}; presence: {1}",Xa.clientId,Xa.presence.toString()),Array.remove(this.$bd,Xa))}Iab(Xa){for(const Bb of this.$bd)if(Bb.clientId===Xa)return Bb;return null}X3(){return this.$bd}}Object(h.a)(xc,"PresenceDataManager",n.a,[]);var ic=d(40),nc=d(748);class Wb{constructor(Xa,Bb,mc,Qc,td,Md,Pd,Be,fe,Mf,Bd){this.clientId=Xa;this.data=Pd;this.chatThreadId=Bb;this.chatThreadDiscoveryUri=mc;this.inChat=
Qc;this.email=td;this.capabilities=Md;this.userName=Be;this.clientType=fe;this.fHasClientEverExperiencedNetworkLoss=Mf;this.isAnonymous=Bd}}Object(h.a)(Wb,"SerializablePresenceInfo",null,[]);class wc{constructor(Xa,Bb,mc,Qc,td,Md,Pd,Be,fe,Mf,Bd){this.Zic=null;this.Lx=Xa.toLowerCase();this.SB=Bb;this.uEe=mc;this.xzg=Qc;this.wzg=td;this.eGg=Md;this.ufc=Pd;this.jzg=Be;this.Nna=fe;this.XXg=Mf;this.fDg=Bd}Hce(){return new Wb(this.Lx,this.xzg,this.wzg,this.eGg,this.ufc,this.jzg.capabilities,this.uEe?this.uEe.Hce():
null,this.Nna,this.XXg,this.fDg,w.AFrameworkApplication.Anb||w.AFrameworkApplication.ZQ)}QHj(Xa){if(!(Xa&&this.pk.equals(Xa.slideId)&&this.presence&&this.presence.fV))return!1;for(const Bb of this.presence.fV)if(Bb===Xa.get_shapeId())return!0;return!1}get presence(){return this.uEe}get clientId(){return this.Lx}get chatThreadId(){return this.xzg}get chatThreadDiscoveryUri(){return this.wzg}get inChat(){return this.eGg}get email(){return this.ufc}get capabilities(){return this.jzg}get pk(){return this.SB}get userName(){return this.Nna}get clientType(){return this.XXg}get fHasClientEverExperiencedNetworkLoss(){return this.fDg}get presenceUser(){return this.Zic}set presenceUser(Xa){this.Zic&&
(Xa?!this.Zic.client||0===this.Zic.client||Xa.client&&0!==Xa.client||aa.a.J(50942305,814,50,"PresenceEntry::SetPresenceUser; Specific to non-specific ClientType {0}.",this.Lx):aa.a.J(50942303,814,50,"PresenceEntry::SetPresenceUser; Non-null to null PresenceUser {0}.",this.Lx));this.Zic=Xa}static qOc(Xa){if(!Xa||!Xa.clientId)return aa.a.J(50942301,814,50,"PresenceEntry : CreateFromData; Invalid presence info"),null;const Bb=nc.a.qOc(Xa.data);let mc=0;Xa.clientType&&8>=Xa.clientType&&(mc=Xa.clientType);
return new wc(Xa.clientId,Bb.pk,Bb,Xa.chatThreadId,Xa.chatThreadDiscoveryUri,Xa.inChat,Xa.email,new ja.a(Xa.capabilities),Xa.userName,mc,Xa.fHasClientEverExperiencedNetworkLoss)}}Object(h.a)(wc,"PresenceEntry",null,[]);class nb extends Sys.EventArgs{constructor(Xa,Bb,mc,Qc,td,Md){super();this.SB=Xa;this.ysk=mc;this.Fdd=Bb;this.z_h=Qc;this.yqk=td;this.tok=Md}get slideId(){return this.SB}get user(){return this.ysk}get shapes(){return this.Fdd}get u9(){return this.z_h}get HDh(){return this.yqk}get Ahh(){return this.tok}}
Object(h.a)(nb,"SlidePresenceChangedEventArgs",Sys.EventArgs,[]);var Rb=d(30);class mb extends n.a{constructor(Xa,Bb,mc,Qc,td,Md,Pd,Be,fe,Mf,Bd,Rc,Gf,Nf,Oa,cb,Ic,qd,le,yb,ef,Cb,oc,vc,nd,id,Nd){super();this.yR=new xc;this.Xo=null;this.nAg=[];this.oAg=null;this.CDb=!0;this.Teb=!1;this.LLg=new Date;this.pZa=null;this.pDg=this.Vgk=this.tFg=!1;this.Zbd=null;this.H$=Xa;Xa.userName||(Xa.userName=vc);this.Jb=Bb;this.Fz=mc;this.Lx=Qc.clientId;this.caa=Qc.ex;this.Fe=td;this.pc=ef;this.Wic=yb;this.$X=Cb;this.Qma=
Nd;oc.execute(Ce=>{this.Xo=Ce});this.$Ij();this.Ej=Gf;this.Mq=Nf;this.ohc=Oa.a3j;this.Kgc=Oa.podsDefaultToRtcForPresenceEnabled;this.Kjk=Oa.podsNoClientRtcConnectWhenAccessTokenExpiredEnabled;this.eLg=w.AFrameworkApplication.jA;this.cBe=Oa.yg&&Oa.pptNoRtcConnectWhenReadOnlyEnabled;this.pa=Md;this.pa.fE(Object(r.a)(this,this.QH,"onSelectionChanged"));this.Js=Pd;this.Js.Sii(Object(r.a)(this,this.ZIk,"onValidShapeIdLoaded"));this.nd=Be;this.nd.aT(Object(r.a)(this,this.dAk,"onActiveSlideDOMReady"));this.CJ=
fe;this.CJ.XSd(Object(r.a)(this,this.pid,"onEditorTableUpdate"));this.li=cb;this.li.GC(Object(r.a)(this,this.WE,"onSessionEnd"));this.li.HC(Object(r.a)(this,this.Mo,"onSessionRehydrated"));this.li.IQa(Object(r.a)(this,this.Qmc,"onOutboundReplication"));this.Rek=Oa.pptAwayStatusTimeGapForPresenceUpdateInMs;this.ia=Bd;this.ta=Mf;this.acd=Rc;this.E7c=Ic;this.mgb=qd;this.KDb=le;Oa.yg&&(this.li.Mzf(Object(r.a)(this,this.Xmc,"onSessionAccessTokenExpiring")),this.li.nJc(Object(r.a)(this,this.soa,"onSessionAccessTokenExpired")),
this.li.wTd(Object(r.a)(this,this.Mjd,"onSessionExpired")),this.Jb.ff(()=>{this.H$.userName=this.Jb.appSettings.UserName;this.H$.email||(this.H$.email=w.AFrameworkApplication.fa.Ha("UserPrincipalName"));this.pc.VL||(aa.a.J(512360717,814,50,"PresenceManager : Disconnect from RTC"),this.disconnect());this.cBe&&this.li.i8(Object(r.a)(this,this.Sw,"onUnifiedAppStateChanged"))}),this.eLg&&this.li.sJc(Object(r.a)(this,this.kga,"onWopiTokenRefreshed")));aa.a.J(512360716,814,50,"PresenceManager - m_isWopiTokenRefreshEnabled:{0}",
this.eLg)}vb(){this.ia.ra(Rb.a.i0a,ic.a.application,Object(r.a)(this,this.i0a,"querySlidePresenceUsers"),96)}i0a(Xa,Bb,mc,Qc,td){td.quc=this.x8b(td.slideId);td.zhh=this.Jyb();return 32}x8b(Xa){return(Xa=this.nbg(Xa))?Xa.length:0}$Ij(){this.Fz.v7a(Object(r.a)(this,this.wGi,"connectionStateChanged"));this.Fz.mJc(Object(r.a)(this,this.presenceUpdated,"presenceUpdated"));w.AFrameworkApplication.fa.ka("PPTForceUpdateEditorTableEnabled")&&this.Fz.ECa(Object(r.a)(this,this.lPl,"updateNotificationReceived"));
T.a.getInstance().Afi(Object(r.a)(this,this.M9g,"onGotCompletePersistentStateWithMetadata"));this.pZa=this.caa.Ii("WebServiceCall","RtcConnection");this.$X.b_i();this.Fz.connect()}imh(){const Xa=this.Fz.ZTc();this.oOh(new ib.a(Xa,null));this.tsc()}M9g(Xa,Bb){this.$X.e_i(Bb.USk);T.a.getInstance().v7k(Object(r.a)(this,this.M9g,"onGotCompletePersistentStateWithMetadata"))}wGi(Xa,Bb){aa.a.J(512360715,814,50,"PresenceManager : Connection State changed; oldState: {0}; newState: {1}; MyClientId: {2}",mb.a$d(Bb.oldState),
mb.a$d(Bb.newState),this.Lx);switch(Bb.newState){case 2:this.pZa.stop();Xa=this.pZa.dr;this.$X.a_i();this.imh();this.Wic.Flh(Xa);break;case 1:2===Bb.oldState&&this.Wic.xqc();this.Wic.pod();break;case 0:this.CDb?this.jBi():2===Bb.oldState&&(window.setTimeout(()=>{this.Fz.connect()},0),aa.a.J(512360714,814,50,"PresenceManager : Reconnect rtc; Session time: {0}",this.Fe.m8b().getTime()),this.Wic.xqc())}}getSelectedShapes(){if(!this.ohc)return null;const Xa=[],Bb=this.pa.Xd();for(let mc=0;mc<Bb.length;++mc)Array.add(Xa,
Bb[mc].get_shapeId());0<Xa.length&&Xa.sort();return Xa}jBi(){var Xa=this.yR.X3();if(Xa&&Xa.length){Xa=Array.clone(Xa);for(const Bb of Xa)this.XLb(Bb);this.raiseEvent("PresenceChanged")}}bZe(Xa,Bb){try{this.H$.email||(this.H$.email=w.AFrameworkApplication.fa.Ha("UserPrincipalName"));const mc=new nc.a(Xa,Bb),Qc=new wc(this.H$.clientId,Xa,mc,this.H$.chatThreadId,this.H$.chatThreadDiscoveryUri,this.H$.inChat,this.H$.email,this.H$.capabilities,this.H$.userName,1,this.Vgk);this.H$.email||aa.a.J(512360713,
814,15,"PresenceManager : SendPresence; empty email for user");this.Fz.bZe(Qc.Hce()).continueWith(()=>{aa.a.J(8958538,814,50,"PresenceManager : SendPresence; Send presence update; MyClientId: {0}; presence: {1}; session time: {2}",this.Lx,mc.toString(),this.Fe.m8b().getTime())});this.LLg=new Date;this.$X.jbk();this.N0k(Xa,Bb);aa.a.J(8958540,814,50,"PresenceManager : SendPresence; Sending presence update; MyClientId: {0}; presence: {1}; session time: {2}",this.Lx,mc.toString(),this.Fe.m8b().getTime());
this.n1k(mc)}catch(mc){aa.a.J(512360712,814,10,"PresenceManager : SendPresence; Exception creating presence data {0}; MyClientId: {1};",mc.toString(),this.Lx)}}presenceUpdated(Xa,Bb){Xa=!!this.Xo&&this.Xo.z_;aa.a.J(8958544,814,50,"PresenceManager : PresenceUpdated; Received presence update; MyClientId: {0}, Rehydrating: {1} ",this.Lx,Xa);if(!Xa){this.$X.lbk(Bb.iRb);Xa=null;this.caa&&(Xa=this.caa.Ii("ServerNotification","Presence Updated"));try{this.oOh(Bb)}finally{Xa&&Xa.stop()}}}lPl(Xa,Bb){aa.a.J(512360711,
814,50,"PresenceManager : Update notification received; Type: {0}; MyClientId: {1}",Bb.type,this.Lx)}oOh(Xa){this.Wci(Xa.iRb);this.x0a(Xa.eUf);aa.a.J(8958546,814,50,"PresenceManager::UpdatePresenceCache; Refresh Peoples Well on presence update");this.raiseEvent("PresenceChanged")}tsc(){this.ta.pk?this.bZe(this.ta.pk,this.getSelectedShapes()):aa.a.J(512360708,814,50,"PresenceManager::SendCurrentSelection: m_graphTopologyManager.CurrentSlideId is null")}QH(){if(this.ta.pk){var Xa=this.getSelectedShapes();
(mb.UHj(this.oAg,this.ta.pk)||mb.$fe(Xa,this.nAg))&&this.tsc()}else aa.a.J(512360707,814,50,"PresenceManager::OnSelectionChanged: m_graphTopologyManager.CurrentSlideId is null")}dAk(Xa,Bb){Bb.Ba?this.ta.pk?this.tsc():aa.a.J(512360705,814,50,"PresenceManager::OnActiveSlideDOMReady: m_graphTopologyManager.CurrentSlideId is null"):aa.a.J(512360706,814,50,"PresenceManager::OnActiveSlideDOMReady: ActiveSlide is null")}ZIk(Xa,Bb){this.ta.pk?Array.contains(this.getSelectedShapes(),Bb.shapeNode.get_shapeId())&&
this.tsc():aa.a.J(512360704,814,50,"PresenceManager::OnValidShapeIdLoaded: m_graphTopologyManager.CurrentSlideId is null")}Bxl(Xa,Bb,mc){Bb=this.g5f(Bb);Xa=this.g5f(Xa);this.Fe.Hcj().Kvc.raiseEvent(mb.Q4d,new ob.a(this.Ej.AD,null,Bb,Xa,null,0,0,mc))}g5f(Xa){const Bb=new fc.a;for(let mc=0;mc<Xa.length;mc++){const Qc=Xa[mc];if(!Qc)continue;if(Qc.ID===this.Ej.AD)continue;if(!Qc.EmailAddress){Bb.$(Qc.ID,this.f5f(Qc));continue}const td=this.yR.Iab(this.Ej.AD);td&&td.email&&Qc.EmailAddress&&td.email.toUpperCase()===
Qc.EmailAddress.toUpperCase()||Bb.$(Qc.EmailAddress.toUpperCase(),this.f5f(Qc))}return Bb.values}f5f(Xa){const Bb=new Jb.a;Bb.EmailAddress=Xa.EmailAddress;Bb.Id=Xa.ID;Bb.Name=Xa.Name;return Bb}pid(Xa,Bb){this.Bxl(Bb.Qug,Bb.mDf,Bb.JWj);if(Xa=this.Ej.v_){var mc=Bb.Qug;for(var Qc=0;Qc<mc.length;Qc++)this.E7c.GBl(mc[Qc].ID);mc=[];Bb=Bb.mDf;for(Qc=0;Qc<Bb.length;Qc++){let Md=Bb[Qc];const Pd=Md.ID;if(Pd!==this.Ej.AD){const Be=this.yR.Iab(Pd);Be?this.KDb.EFf(Be.email,Md.EmailAddress):Array.add(mc,Pd)}}this.E7c.Kbi(mc);
2<=Xa.length&&aa.a.J(512360674,814,50,"PresenceManager : EditorTable has atleast 2 coauthors; MyClientID: {0}; EditorTableCount: {1}",this.Lx,Xa.length);mc=[];Bb=[];for(var td of Xa)Array.add(mc,td.ID),td.ID===this.Ej.AD||this.yR.Iab(td.ID)||Array.add(Bb,td.ID);aa.a.J(512360673,814,50,"PresenceManager : OnEditorTableUpdate; Received Editor Table update; MyClientID: {0}; editorTableCount: {1}; ClientIDs : {2}; ClientIDs with missing presence: {3}",this.Lx,Xa.length,mc.join(","),Bb.join(","));for(const Md of this.yR.X3())({editor:td}=
this.Ej.jnb(Md.clientId)).returnValue?(this.j1k(Md),Xa=this.mgb.oua(new Ta.a(td.EmailAddress,void 0,td.Name),td.ID,0),Md.presenceUser=new D.a(Md.clientId,td.Name,Xa,new ja.a(1),null,null,Md.clientType),this.acd.dod(new nb(Md.pk,Md.presence.fV,Md.presenceUser,!0,this.x8b(Md.pk),this.Jyb())),aa.a.J(512360671,814,50,"PresenceManager : OnEditorTableUpdate; Adding/Updating presence UI; ClientId: {0};  Presence: {1}; Color: {2}; MyClientId: {3};",Md.clientId,Md.presence.toString(),Md.presenceUser.color,
this.Lx)):aa.a.J(512360670,814,50,"PresenceManager : OnEditorTableUpdate; Client not in Editor table; ClientId: {0};  Presence: {1}: Color: {2}; MyClientId: {3};",Md.clientId,Md.presence.toString(),Md.presenceUser?Md.presenceUser.color:"",this.Lx);this.raiseEvent("PresenceChanged")}else aa.a.J(512360675,814,50,"PresenceManager : OnEditorTableUpdate; Received null on Editor Table update; MyClientID: {0};",this.Lx)}WE(Xa,Bb){this.E7c.EBl();5!==Bb.GD&&(aa.a.J(512360669,814,50,"PresenceManager : OnSessionEnd - Disconnect from RTC"),
this.disconnect())}Xmc(){aa.a.J(512360668,814,50,"PresenceManager : OnSessionAccessTokenExpiring");this.Teb||(aa.a.J(512360667,814,50,"PresenceManager : OnSessionAccessTokenExpiring; Access token expired"),this.Teb=!0)}soa(){aa.a.J(512360666,814,50,"PresenceManager : OnSessionAccessTokenExpired; Disconnecting from RTC");this.Teb||(aa.a.J(512360665,814,50,"PresenceManager : OnSessionAccessTokenExpired; Access token expired"),this.Teb=!0)}Mjd(){aa.a.J(512360664,814,50,"PresenceManager : OnSessionExpired - Disconnect from RTC");
this.disconnect()}kga(Xa,Bb){aa.a.J(512360663,814,50,"PresenceManager : OnWopiTokenRefreshed");try{Bb.p3c?(aa.a.J(512360662,814,50,"PresenceManager::OnWopiTokenRefreshed Token refresh succeeded. - RTC Connection State: {0}",mb.a$d(this.Fz.connectionState)),this.Teb=!1,this.cBe&&!this.pc.VL?aa.a.J(512360661,814,15,"PresenceManager : OnWopiTokenRefreshed; Do not connect to RTC in readonly mode"):this.CDb||2!==this.Fz.connectionState?this.connect():(Xa={},Xa.qs=this.Qma.presentationId.string,aa.a.J(512360660,
814,50,"PresenceManager : OnWopiTokenRefreshed; Calling UpdateClientInfo"),this.Fz.qnb(Xa))):aa.a.J(512360659,814,15,"PresenceManager::OnWopiTokenRefreshed Token refresh failed.")}catch(mc){aa.a.J(512360658,814,10,"PresenceManager::OnWopiTokenRefreshed Exception: {0}",mc)}}Mo(Xa,Bb){this.Kjk&&this.Teb||this.cBe&&!this.pc.VL?aa.a.J(512360657,814,50,"PresenceManager : OnSessionRehydrated; Do not connect to RTC; IsAccessTokenExpired={0}; IsInEditingModeOrCanEditAnyway={1};",this.Teb,this.pc.VL):4!==
Bb.Bya||this.CDb?this.connect():(aa.a.J(512360656,814,50,"PresenceManager : OnSessionRehydrated - catch up presence"),this.imh())}Sw(Xa,Bb){Bb.boe&&!this.pc.VL&&(aa.a.J(512360655,814,50,"PresenceManager : OnUnifiedAppStateChanged; Change to readonly, disconnect from RTC"),this.disconnect())}connect(){aa.a.J(512360654,814,50,"PresenceManager : Connect");this.CDb=!1;this.Fz.connect()}Qmc(){this.ttl()&&(aa.a.J(512360653,814,50,"PresenceManager : OnOutboundReplication; Send presence update for editing actions"),
this.tsc())}ttl(){const Xa=this.Fz.Tlj();return Xa?2===Xa.status||+new Date-+this.LLg>this.Rek?!0:!1:!1}j1j(){const Xa=this.yR.X3();if(0<Xa.length)for(const Bb of Xa)if(Bb.presence&&Bb.presence.pk)return!0;return!1}Qsl(){return!this.tFg&&this.Kgc&&2!==this.Ej.qda}Wci(Xa){for(let mc in Xa){var Bb=Xa[mc];try{const Qc=wc.qOc(Bb);if(!Qc||Qc.clientId===this.Lx)continue;const td=Qc.clientId;this.Qsl()&&(this.tFg=!0,this.Mq.Swc(2),aa.a.J(512360652,814,50,"PresenceManager : Update coauth status to Coauthoring from RTC"));
aa.a.J(39326610,814,50,"PresenceManager : AddOrUpdatePresence; ClientId: {0}; NewPresence: {1};",td,Qc.presence.toString());const Md=Qc.email;if(!this.KDb.y$d(Md)){let Pd;({editor:Pd}=this.Ej.jnb(td)).returnValue&&this.KDb.EFf(Md,Pd.EmailAddress)}this.Yci(Qc);this.$X.$Zi()}catch(Qc){aa.a.J(512360651,814,10,"PresenceManager : AddOrUpdatePresence; Invalid Presence Data Received {0}; MyClientId: {1};",Qc.toString(),this.Lx)}}this.$X.kbk(Xa)}Yci(Xa){this.WYi(Xa);const Bb=this.Fz.i4(Xa.clientId);Bb&&2===
Bb.status?aa.a.J(39326613,814,50,"PresenceManager : AddOrUpdatePresenceWithAwayStatus; Do not add presence for inactive user; ClientId: {0};",Xa.clientId):this.Xci(Xa)}Xci(Xa){const Bb=this.yR.Iab(Xa.clientId);if(Bb){if(!this.JHj(Bb,Xa))return;aa.a.J(8958560,814,50,"PresenceManager : AddOrUpdatePresence; Updating existing presence; ClientId: {0};  ExistingPresence: {1}; NewPresence: {2}; MyClientId: {3};",Xa.clientId,Bb.presence.toString(),Xa.presence.toString(),this.Lx);this.XLb(Bb)}this.odi(Xa)}XLb(Xa){Xa&&
(this.yR.XLb(Xa),Xa.presenceUser&&this.acd.dod(new nb(Xa.pk,Xa.presence.fV,Xa.presenceUser,!1,this.x8b(Xa.pk),this.Jyb())))}LXf(Xa){if(Xa)if(Xa.presenceUser)aa.a.J(512360649,814,100,"PresenceManager:AddOrUpdatePresence; PresenceUser already created for ClientId{0};",Xa.clientId);else{const Bb=this.B$f(Xa.clientId);Bb?Xa.presenceUser=Bb:aa.a.J(512360650,814,50,"PresenceManager:AddOrUpdatePresence; Null presence user for ClientId{0};",Xa.clientId)}}odi(Xa){Xa&&(this.yR.fja(Xa),this.E7c.FBl(Xa.clientId),
this.LXf(Xa),Xa.presenceUser?this.acd.dod(new nb(Xa.pk,Xa.presence.fV,Xa.presenceUser,!0,this.x8b(Xa.pk),this.Jyb())):aa.a.J(512360648,814,50,"PresenceManager:AddOrUpdatePresence; Null presence user for ClientId{0};",Xa.clientId))}JHj(Xa,Bb){let mc;(mc=!Xa.pk.equals(Bb.pk))&&aa.a.J(512360647,814,50,"Slide Presence Changed - CurrentSlide: {0} ; NewSlide: {1}",Xa.pk,Bb.pk);(Xa=this.ohc&&mb.Fql(Xa,Bb))&&aa.a.J(512360646,814,50,"Shape Presence Changed");return mc||Xa}x0a(Xa){if(Xa){for(let Bb=0;Bb<Xa.length;Bb++)Xa[Bb]=
Xa[Bb].toLowerCase();for(const Bb of Xa)aa.a.J(512360645,814,50,"PresenceManager : RemovePresence; Removing presence for disconnected clients; ClientId: {0}",Bb),(Xa=this.yR.Wod(Bb))?Xa.presenceUser?this.acd.dod(new nb(Xa.pk,Xa.presence.fV,Xa.presenceUser,!1,this.x8b(Xa.pk),this.Jyb())):aa.a.J(512360643,814,15,"PresenceManager : RemovePresence; entry.PresenceUser is null"):aa.a.J(512360644,814,15,"PresenceManager : RemovePresence; entry did not exist")}}nbg(Xa){const Bb=[];for(const mc of this.yR.X3())mc.pk.equals(Xa)&&
mc.presenceUser&&Array.add(Bb,mc.presenceUser);return Bb}Wag(Xa){const Bb=[];for(const mc of this.yR.X3())mc.presence&&mc.QHj(Xa)&&mc.presenceUser&&Array.add(Bb,mc.presenceUser);return Bb}W6b(){const Xa=[];for(const Bb of this.yR.X3())Bb.presenceUser&&Array.add(Xa,Bb.presenceUser);return Xa}Jyb(){const Xa=this.W6b();return Xa?Xa.length:0}Ska(Xa){if(!Xa)return null;Xa=Xa.toLocaleLowerCase();for(const Bb of this.yR.X3())if(Bb.presenceUser&&Bb.presenceUser.clientId===Xa)return Bb.presenceUser;return this.B$f(Xa)}Wod(Xa){const Bb=
this.yR.Iab(Xa);this.XLb(Bb);aa.a.J(512360641,814,50,"PresenceManager : RemoveUserPresence; Removing presence; ClientId: {0};  MyClientId: {1};",Bb?Bb.clientId:Xa+" not found",this.Lx)}Fhi(Xa){this.addHandler("PresenceChanged",Xa)}X3(){return this.yR.X3()}connectionState(){return this.Fz.connectionState}disconnect(){try{aa.a.J(512360640,814,50,"PresenceManager : Disconnect"),this.CDb||this.Wic.Q0k(),this.CDb=!0,this.Fz.disconnect()}catch(Xa){aa.a.J(512360611,814,10,"PresenceManager : Disconnect; Exception disconnecting rtc; Message: {0}; Callstack: {1}",
Xa.message,Xa.stack)}}N0k(Xa,Bb){this.oAg=Xa;this.nAg=Bb}B$f(Xa){let Bb;const mc=({editor:Bb}=this.Ej.jnb(Xa)).returnValue;var Qc=this.Fz.pua(Xa),td=!!Qc;if(!mc&&!td)return aa.a.J(512360610,814,50,"PresenceUser:GetPresenceUser; ClientId {0} neither in presence nor rtc.",Xa),null;Qc=td?Qc:null;mc||aa.a.J(512360609,814,50,"PresenceUser:GetPresenceUser; ClientId{0} not in EditorTable",Xa);td||aa.a.J(512360608,814,50,"PresenceUser:GetPresenceUser; ClientId{0} not in Presence",Xa);td&&mc&&aa.a.J(512360607,
814,50,"PresenceUser:GetPresenceUser; ClientId {0} in both. IsSameID={1}, IsSameEmail={2}.",Xa,Qc.clientId!==Bb.ID,Qc.email!==Bb.EmailAddress);var Md=mc?new Ta.a(Bb.EmailAddress,void 0,Bb.Name):new Ta.a(this.KDb.y$d(Qc.email)||Qc.email,void 0,Qc.userName);Md=this.mgb.oua(Md,mc?Bb.ID:Qc.clientId,0);td=td?Qc.clientType:0;return new D.a(Xa,mc?Bb.Name:Qc.userName,Md,new ja.a(1),null,null,td)}j1k(Xa){this.ta.pk.equals(Xa.pk)&&Xa.presence.fV&&Xa.presence.fV.length&&aa.a.J(512360606,814,50,"PresenceManager : {0}; Begin to add shape presence; ClientId: {1};  Presence data: {2}; MyClientId: {3}; Session time: {4}",
"OnEditorTableUpdate",Xa.clientId,Xa.presence.toString(),this.Lx,this.Fe.m8b().getTime());aa.a.J(512360605,814,50,"PresenceManager : {0}; Begin to add slide presence; ClientId: {1};  Presence data: {2}; MyClientId: {3}; Session time: {4}","OnEditorTableUpdate",Xa.clientId,Xa.presence.toString(),this.Lx,this.Fe.m8b().getTime())}n1k(Xa){const Bb=[this.Ej.userName];let mc=0;for(var Qc of this.yR.X3())Qc.presence.pk.equals(Xa.pk)&&!mb.$fe(Qc.presence.fV,Xa.fV)&&(mc++,Qc.presenceUser&&Array.add(Bb,Qc.presenceUser.userName));
if(0<mc){Qc={};let td=0,Md=0;for(let Pd=0;Pd<Bb.length;++Pd){let Be=Bb[Pd];Be&&Be.length||(Be="anonymous",Md++);Be in Qc||(Qc[Be]=!0,td++)}aa.a.J(512360604,814,50,"PresenceManager : {0} users, {2} unique users are selecting same {1}. {3} users have no identity",mc+1,Xa.fV&&0<Xa.fV.length?"shape":"slide",td,Md)}}WYi(Xa){try{this.$X.E2i()&&!this.yR.Iab(Xa.clientId)&&(this.LXf(Xa),this.XYi(Xa.presenceUser))}catch(Bb){aa.a.J(512360603,814,15,"PresenceManager:EndPresenceBootTelemetry; Exception {0};",
Bb.toString())}}XYi(Xa){Xa&&Xa.clientId&&(this.pDg||this.Zbd||(this.pDg=!0,this.Zbd=G.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),this.Zbd&&this.Zbd.aZi(Xa.clientId,mb.gqj(Xa)))}static a$d(Xa){let Bb="";switch(Xa){case 2:Bb="Connected";break;case 1:Bb="Connecting";break;case 0:Bb="Disconnected"}return Bb}static $fe(Xa,Bb){if(!Xa&&!Bb)return!1;if(!Xa&&Bb||Xa&&!Bb||Xa.length!==Bb.length)return!0;for(let mc=0;mc<Xa.length;mc++)if(Xa[mc]!==Bb[mc])return!0;return!1}static UHj(Xa,
Bb){return!va.a.hba(Xa,Bb)}static Fql(Xa,Bb){return Xa.pk.equals(Bb.pk)&&mb.$fe(Xa.presence.fV,Bb.presence.fV)}static gqj(Xa){return Xa&&1===Xa.client?1:0}}mb.Q4d="ETU";Object(h.a)(mb,"PresenceManager",n.a,[1141,1142,1143,1144]);var Ub=d(1297),zc=d(1186),Pc=d(1306),Mc=d(78),ld=d(49),vb=d(296);class cc{constructor(Xa,Bb,mc,Qc,td){this.ru=null;this.Sv=w.AFrameworkApplication.fa.ka("PPTCanvasPresenceBubbleUXEnabled");Bb=this.moj(Bb,Qc,td);this.ru=this.Sv?(new Ub.a(Bb)).h3b(Xa):(new zc.a(Bb)).G0d(Xa,
mc)}dispose(){this.ru.dispose()}qQe(){return ld.a.ki(document.getElementById(vb.a.b1b))}moj(Xa,Bb,mc){const Qc=new Pc.a;Qc.add(0,Mc.getImageClassWithCluster(w.AFrameworkApplication.cO,"MoreUsersGlyph_16x16x32"));Qc.add(5,w.AFrameworkApplication.Cm);Qc.add(1,Mc.getImageClassWithCluster(w.AFrameworkApplication.cO,this.Sv?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph_16x16x32"));Qc.add(4,w.AFrameworkApplication.Cm);Qc.add(6,mc);Qc.add(8,w.AFrameworkApplication.isRtl);Qc.add(12,Xa);Qc.add(11,Bb);
this.Sv&&(Qc.add(16,Object(r.a)(this,this.qQe,"presenceViewportBoundsCallback")),Qc.add(17,!0));return Qc}kB(Xa){this.ru?(aa.a.J(8958619,814,50,"PresencePawn:AddUser at PresencePawn for ClientId {0}",Xa.clientId),this.ru.kB(Xa)):aa.a.J(509219530,814,10,"PresencePawn:AddUser - Presence tool tip is null, skipping AddUser for ClientID {0}",Xa.clientId)}nP(Xa){this.ru?(aa.a.J(509219528,814,50,"PresencePawn:RemoveUser at PresencePawn for ClientId {0}",Xa.clientId),this.ru.nP(Xa.clientId)):aa.a.J(509219529,
814,15,"PresencePawn:RemoveUser - Presence tool tip is null, skipping RemoveUser for ClientId {0}",Xa.clientId)}clear(){if(this.ru)if(aa.a.J(509219526,814,50,"PresencePawn:Clear at PresencePawn "),this.e9())for(const Xa of this.e9())this.nP(Xa);else aa.a.J(509219525,814,50,"PresencePawn:Clear - Pawn has no users");else aa.a.J(509219527,814,15,"PresencePawn:Clear - Presence tool tip is null, skipping ClearPresence ")}e9(){return this.ru?this.ru.xKb:null}l2e(){this.ru&&(this.Sv&&this.ru.eMa(),this.ru.aMa())}tge(){this.ru&&
this.ru.eMa()}}Object(h.a)(cc,"PresencePawn",null,[264,107]);class Hc{wQf(Xa,Bb,mc){return new cc(Xa,2,Bb,!0,mc)}}Object(h.a)(Hc,"PresencePawnFactory",null,[1100]);var Pb=d(32);class Uc{constructor(Xa,Bb,mc,Qc,td,Md,Pd,Be,fe,Mf,Bd){this.XDe=[];this.fZa=null;this.aEg=this.$Dg=this.Rye=0;this.O8c=this.P8c=null;this.ubd=[];if(!Bb)throw Error.argumentNull("graphTopologyManager");if(!mc)throw Error.argumentNull("presenceManager");if(!Qc)throw Error.argumentNull("dragInputManager");if(!td)throw Error.argumentNull("coauthStateChangesHandler");
this.nd=Xa;this.ta=Bb;this.LE=mc;this.mu=Qc;this.Mue=td;this.nna=Md;this.Sb=Pd;this.We=Be;this.dhb=fe;this.mna=Mf;this.rR=Bd;this.mna.x7a(Object(r.a)(this,this.Gud,"slidePresenceChanged"));this.nd.aT(Object(r.a)(this,this.t_a,"onSlideNavigation"));this.nd.qJc(Object(r.a)(this,this.Txa,"onThumbnailRefresh"));this.nd.Nsb(Object(r.a)(this,this.kNe,"onThumbnailVisibleRangeChanged"));this.$Gg=w.AFrameworkApplication.fa.ka("PPTCanvasPresenceFloodGateSurveyEnabled");(this.Sv=w.AFrameworkApplication.fa.ka("PPTCanvasPresenceBubbleUXEnabled"))&&
this.$Gg&&(this.$Dg=w.AFrameworkApplication.fa.wc("PPTCanvasPresenceFloodGateSurveyTimeLapseSec",30),this.aEg=w.AFrameworkApplication.fa.wc("PPTCanvasPresenceFloodGateSurveyTriggerThreshold",3),this.Rye=0,this.fZa=J.a.Lt(G.a.instance.Ia("Common.ISystemInitiatedFeedbackWithTimeLapse")));this.nd.Msb(Object(r.a)(this,this.Oql,"shapeViewElementAdded"));this.nd.Qzf(Object(r.a)(this,this.Pql,"shapeViewElementLocked"));this.nd.hhi(Object(r.a)(this,this.JHk,"onShapeViewElementShowLockHint"));this.nd.ihi(Object(r.a)(this,
this.KHk,"onShapeViewElementShowPresenceHint"));this.nd.fhi(Object(r.a)(this,this.DHk,"onShapeViewElementHidePresenceHint"))}t_a(){this.ta.pk&&(aa.a.J(512263071,814,50,"PresencePresenter::OnSlideNavigation; refreshing shape presence for slideId: {0}",this.ta.pk),this.j2k(this.ta.pk))}j2k(Xa){if(this.ta.pk&&this.ta.pk.equals(Xa)&&(aa.a.J(512263070,814,50,"PresencePresenter::RefreshShapePresenceOnSlide refreshing presence for slideId: {0}",Xa),Xa=new Pb.GraphIterator,Xa.set(this.ta.Ba),Xa.Cb(1))){do if(0<
Xa.currentNode.eb(Dc.a.shapeId)){const Bb=Object(sa.a)(4,Xa.currentNode);Bb&&this.smh(Bb)}while(Xa.Gf(1))}}Gud(Xa,Bb){this.mu.$Fa?(aa.a.J(512263069,814,50,"PresencePresenter:SlidePresenceChanged - DragInputManager active."),this.O8c||(this.O8c=new z.a(2,1,0,()=>{this.handlePendingPresenceChangedEvent(Bb)},90,"68"),w.AFrameworkApplication.Ae.Hb(this.O8c)),Bb&&this.ubd.push(Bb)):(this.KUk(Bb),this.IUk(Bb))}handlePendingPresenceChangedEvent(){this.O8c=null;this.h2k();if(this.ta.pk&&0<this.ubd.length){const mc=
{},Qc={};var Xa=this.ta.pk;for(var Bb of this.ubd){if(!Xa.equals(Bb.slideId))continue;if(!Bb.shapes||!Bb.user)continue;Bb.user.clientId in Qc||(mc[Bb.user.clientId]=Bb.user,Qc[Bb.user.clientId]=new fc.a(0));const td=Qc[Bb.user.clientId];for(const Md of Bb.shapes){const Pd=Bb.u9?1:0;td.Fb(Md)?0<(td.ga(Md)^Pd)&&td.$(Md,Pd):td.add(Md,Pd)}}for(let td in mc){Xa=mc[td];Bb=td;if(!(Bb in Qc))continue;const Md=[],Pd=[];Qc[Bb].forEach((Be,fe)=>{0<fe?Pd.push(Be):Md.push(Be);return!0});0<Md.length&&this.hoh(Md,
Xa);0<Pd.length&&this.ryf(Pd,Xa)}this.ubd=[]}}KUk(Xa){Xa.u9?this.fja(Xa.slideId,Xa.user):this.x0a(Xa.slideId,Xa.user)}Txa(Xa,Bb){this.qmh([Bb.IIh])}kNe(Xa,Bb){this.qmh(Bb.gha)}qmh(Xa){const Bb=[];for(const mc of Xa)Xa=this.rR?this.Sb.jXc(mc):this.Sb.Wka(mc),this.rR&&0>=Xa.xV||Xa&&Array.add(Bb,Xa);this.pmh(Bb)}fja(Xa,Bb){const mc=this.ycg(Xa);mc?(mc.fja(Bb),this.hse(),aa.a.J(512263067,814,50,"ThumbnailNavigationPaneView : Add slide presence succeeded. slideId  = {0}",Xa.toString())):aa.a.J(21770506,
814,50,"ThumbnailNavigationPaneView : AddPresence - slideId is invalid {0}",Xa.toString())}x0a(Xa,Bb){const mc=this.ycg(Xa);mc?mc.x0a(Bb):aa.a.J(512263066,814,50,"ThumbnailNavigationPaneView : RemovePresence - slideId is invalid {0}",Xa.toString())}ycg(Xa){const Bb=this.Sb.Wka(Xa);return Bb?Object(sa.a)(662,Bb.tg(this.dhb)):(aa.a.J(512263065,814,50,"ThumbnailNavigationPaneView : RemovePresence - slideId is invalid {0}",Xa.toString()),null)}h2k(){const Xa=this.ta.presentation;if(!Xa)throw Error.argumentNull("Presentation is null");
this.pmh(Xa.slides||[])}pmh(Xa){for(const mc of Xa){var Bb=Object(sa.a)(118,mc);Bb?(Xa=Bb.Db,(Bb=Object(sa.a)(662,Bb.tg(this.dhb)))?(aa.a.J(512263062,814,50,"ThumbnailNavigationPaneView : RefreshPresenceForAllThumbnail - updating presence for {0}",Xa.toString()),Bb.W2a(this.LE.nbg(Xa))):aa.a.J(512263063,814,50,"ThumbnailNavigationPaneView : RefreshPresenceForAllThumbnail - thumbnailViewElement is null for slide {0}",Xa.toString())):aa.a.J(512263064,814,10,"ThumbnailNavigationPaneView : RefreshPresenceForThumbnails - could not cast slide to ISlideNode while updating presence for {0}",
mc.Db.toString())}}hse(){this.Sv&&this.$Gg&&(this.MIl()||this.fZa&&this.fZa.continueWith(()=>{this.fZa.result.logActivity("PresenceBubbleRendered","PPTCanvasPresenceFloodGateSurveyEnabled",this.$Dg)&&this.Rye++}))}MIl(){return this.Rye>=this.aEg}IUk(Xa){this.ta.pk&&this.ta.pk.equals(Xa.slideId)&&Xa.shapes&&(Xa.u9?this.ryf(Xa.shapes,Xa.user):this.hoh(Xa.shapes,Xa.user))}Oql(Xa,Bb){Xa=Bb.$w;this.Qrg(Xa.shapeNode)&&(this.XDe.push(Xa),this.P8c||(this.P8c=new z.a(2,1,0,Object(r.a)(this,this.handlePendingShapePresenceUpdate,
"handlePendingShapePresenceUpdate"),90,"69"),w.AFrameworkApplication.Ae.Hb(this.P8c)))}handlePendingShapePresenceUpdate(){this.P8c=null;for(const Xa of this.XDe){if(!this.Qrg(Xa.shapeNode))return;this.smh(Xa.shapeNode)}Array.clear(this.XDe)}smh(Xa){const Bb=Object(sa.a)(119,Xa.qc(this.We));if(Bb&&!Xa.get_smartArtModelId()){var mc=this.LE.Wag(Xa);if(mc)if(mc.length){Xa=this.nna.ZI(Xa);Xa.CKf();for(const Qc of mc)Xa.fja(Qc),this.hse()}else(mc=this.nna.dJ(Xa))&&mc.CKf();this.Mue.och(Bb)}}ryf(Xa,Bb){var mc=
this.Zag();let Qc=!1;for(const td of mc){if(!Array.contains(Xa,td.get_shapeId())||td.get_smartArtModelId())continue;mc=Object(sa.a)(119,td.qc(this.We));if(!mc||td.get_smartArtModelId())continue;const Md=this.nna.ZI(td);Md?(mc.isSelected&&(Md.Ntb=!1),Md.fja(Bb),this.hse(),mc.isSelected&&Md.Elc()):Qc=!0}Qc||aa.a.J(512263060,814,50,"PresencePresenter::AddShapePresence succeeded")}hoh(Xa,Bb){var mc=this.Zag();for(const Qc of mc)Array.contains(Xa,Qc.get_shapeId())&&(mc=this.nna.ZI(Qc))&&mc.x0a(Bb)}Zag(){let Xa=
null;this.ta.Ba&&(Xa=this.ta.Ba.Uj());return Xa||[]}Qrg(Xa){return!!this.ta.Ba&&this.ta.Ba.Db.equals(Xa.slideId)}Pql(Xa,Bb){this.nna.ZI(Bb.$w.shapeNode).Byd(Bb.presenceUser)}JHk(Xa,Bb){(Bb.$w.hq||Bb.$w.Mtd)&&(Xa=this.nna.dJ(Bb.$w.shapeNode))&&Xa.N1e()}KHk(Xa,Bb){(Xa=this.nna.dJ(Bb.$w.shapeNode))&&Xa.Qul()}DHk(Xa,Bb){(Xa=this.nna.dJ(Bb.$w.shapeNode))&&Xa.fea()}}Object(h.a)(Uc,"PresencePresenter",null,[]);class sc{constructor(Xa){this.ijc=Xa}pua(Xa){return this.ijc.pua(Xa)}i4(Xa){return this.ijc.i4(Xa)}}
Object(h.a)(sc,"PresenceUserInfoGetter",null,[1102,1075]);class lb{constructor(Xa=null){this.Ej=Xa}C$f(Xa){if(!Xa||!Xa.value)return null;Xa=Xa.value;let Bb=Xa.userName;if(!Bb&&this.Ej){let mc;({editor:mc}=this.Ej.jnb(Xa.clientId)).returnValue&&(Bb=mc.Name)}return Object.assign(new D.a,{clientId:Xa.clientId,chatThreadId:Xa.chatThreadId,chatThreadDiscoveryUri:Xa.chatThreadDiscoveryUri,inChat:Xa.inChat,email:Xa.email,capabilities:new ja.a(Xa.capabilities),userName:Bb})}}Object(h.a)(lb,"PresenceUtils",
null,[1139]);var Zb;(function(Xa){Xa[Xa.coauthHandlerResponse=0]="coauthHandlerResponse";Xa[Xa.popSessionResponse=1]="popSessionResponse";Xa[Xa.defaultFallback=2]="defaultFallback"})(Zb||(Zb={}));Object(h.b)("RtcDiscoverType",Zb);class Oc{constructor(Xa,Bb,mc,Qc,td,Md,Pd,Be,fe,Mf,Bd,Rc,Gf,Nf,Oa,cb){this.E3d=Xa;this.Rud=Bb;this.Qud=mc;this.Bwb=Qc;this.z$b=td;this.CZc=Md;this.nnb=Pd;this.Hxd=Be;this.$jb=fe;this.eQc=Mf;this.cQc=Bd;this.EPb=Rc;this.Ahb=Gf;this.dwb=Nf;this.EWf=Oa;this.a5d=cb}$ck(){return String.format("[DRL-{0},SEND-{1},SELE-{2},EELE-{3},IUI-{4},IULE-{5},TUI-{6},TULE-{7},RELI-{8},DTL-{9},DEL-{10}, STF-{11}, MLD-{12}, DTL-{13}, ETR-{14}, ETCL-{15}]",
this.E3d,this.Rud,this.Qud,this.Bwb,this.z$b,this.CZc,this.nnb,this.Hxd,this.$jb,this.eQc,this.cQc,this.EPb,this.Ahb,this.dwb,this.EWf,this.a5d)}}Object(h.a)(Oc,"RttLockSettings",null,[]);var md=d(348);class Ib{constructor(Xa,Bb,mc,Qc){this.Ehc=this.Dhc=null;this.Wkf=!1;this.Iqk=Xa;this.Ga=Bb;this.Gh=mc;this.lY=Qc;this.hHb=new Date;this.gIa=-1}get gb(){return this.Iqk}get w3c(){return this.Wkf}set w3c(Xa){this.Wkf=Xa}Z1i(){return 0<this.gIa&&Date.now()>=this.gIa}ixh(Xa){this.gIa=Xa}O8b(){return""}P8b(){return""}GLb(Xa){this.Dhc=
Xa?this.O8b():this.P8b();this.Ehc=new Date}GYd(){}IYd(){return!1}Gth(Xa,Bb){Xa=Xa||"";Bb=Bb||"";if(Xa.length!==Bb.length)return null;const mc=[];for(let Qc=0;Qc<Xa.length;Qc+=1)Xa.charAt(Qc)!==Bb.charAt(Qc)&&mc.push(Qc);return 0<mc.length?Db.a.eI("Length",Xa.length,"FirstDiffPos",mc[0],"DiffCount",mc.length):null}eUa(Xa){return I.a.replaceAll(Xa,"\u00a0"," ").trim()}}Object(h.a)(Ib,"ATextContentRecord",null,[]);var ud=d(36),od=d(43);class Ud extends Ib{constructor(Xa,Bb,mc,Qc){super(Xa,Bb,mc,Qc);
this.T1g=Xa.DB}get shapeNode(){return Object(sa.a)(4,this.gb)}Hpl(){this.T1g=this.shapeNode.DB}O8b(){const Xa=new m.a;var Bb=this.shapeNode.nz();for(const mc of Bb)(Bb=this.Gh.text(mc))&&0<Bb.length&&Xa.add(Bb);return Xa.toArray().join(" ")}P8b(){return this.Ga.i9(this.shapeNode)}GYd(){try{const Xa=this.O8b()||"",Bb=this.Dhc||"";if(Xa!==Bb){const mc=this.eUa(Xa)===this.eUa(Bb),Qc=this.T1g||this.shapeNode.DB;if(!mc&&!Qc&&!this.shapeNode.vd){const td=Db.a.eI("Shape",this.shapeNode.Kr,"Start",od.a.uf(this.hHb),
"LastSnapshotTime",od.a.uf(this.Ehc),"EverEdit",this.w3c,"Type",this.getShapeType());td.Expiration=-1<this.gIa?(+new Date(this.gIa)-+this.hHb).toString():null;const Md=Xa.length-Bb.length;Md?td.TextLengthDelta=Md:td.SameLengthDiffDetails=this.Gth(Xa,Bb);aa.a.J(25539747,814,15,ud.c(td))}}}catch(Xa){aa.a.J(25981901,814,10,"ShapeContentRecord:CheckTextContent failed. {0}",Xa)}}IYd(){try{const Xa=this.lY.t7b(this.shapeNode);if(Xa&&0<Xa.length)return!1;const Bb=this.P8b()||"",mc=this.Dhc||"";if(Bb!==mc&&
0>Bb.indexOf(mc)&&!(0<=this.eUa(Bb).indexOf(this.eUa(mc))||this.shapeNode.vd)){const Qc=Db.a.eI("Shape",this.shapeNode.Kr,"Start",od.a.uf(this.hHb),"LastSnapshotTime",od.a.uf(this.Ehc),"TextLengthDelta",Bb.length-mc.length,"Type",this.getShapeType());aa.a.J(25981903,814,15,ud.c(Qc))}}catch(Xa){aa.a.J(25981905,814,10,"ShapeContentRecord:CheckWetContentUpdate failed. {0}",Xa)}return!0}getShapeType(){return this.shapeNode.vd?"Table":this.shapeNode.Wf?"SmartArt":this.shapeNode.Hx?"TextBox":this.shapeNode.rl?
"PlaceHolder":this.shapeNode.Pla?"Shape":"Unknown"}}Object(h.a)(Ud,"ShapeContentRecord",Ib,[]);class Ad{constructor(Xa,Bb,mc,Qc,td,Md,Pd,Be,fe,Mf,Bd,Rc,Gf){this.Zgb=this.kHb=null;this.$O={};this.uJa={};this.pa=Be;this.CJ=fe;this.Mc=Xa;this.Us=Bb;this.eik=mc;this.Pr=Qc;this.ta=td;this.Rf=Md;this.lY=Pd;this.Ga=Mf;this.zc=Bd;this.QGe=Rc;this.Ns=Gf;this.pa.Fzf(Object(r.a)(this,this.aGk,"onPreSelectionChanged"));this.pa.fE(Object(r.a)(this,this.iJb,"onSetSelectionFinished"));this.CJ.Bii(Object(r.a)(this,
this.rIk,"onTableCellViewElementLocked"));this.Mc.Cfi(Object(r.a)(this,this.cpi,"beforeProcessInboundResponse"));this.Us.D_b(Object(r.a)(this,this.GHk,"onShapeViewElementOpenTextEditView"));this.Us.oJc(Object(r.a)(this,this.AHk,"onShapeViewElementCloseTextEditView"));this.Us.Qzf(Object(r.a)(this,this.FHk,"onShapeViewElementLocked"));this.eik.pTd(Object(r.a)(this,this.nIk,"onSuccessfulInbound"));this.Pr.fk(Object(r.a)(this,this.$g,"onPropertyChanged"));this.Rf.FI(Object(r.a)(this,this.YB,"onActiveSlideChanged"))}GHk(Xa,
Bb){Xa=Object(sa.a)(4,Object(sa.a)(md.a,Bb.$w).gb);Bb=this.QGe.z1d(Xa);this.$O[Xa.id.toString()]=Bb;Bb.GLb(!0)}AHk(Xa,Bb){Xa=Object(sa.a)(4,Object(sa.a)(md.a,Bb.$w).gb).id.toString();Xa in this.$O&&this.$O[Xa].ixh(Date.now()+this.Ns.Bwb)}FHk(Xa,Bb){Xa=Object(sa.a)(4,Object(sa.a)(md.a,Bb.$w).gb).id.toString();Xa in this.$O&&delete this.$O[Xa]}aGk(){this.kHb=this.TQf}iJb(){this.Zgb=this.TQf;if(!(!this.kHb&&!this.Zgb||this.kHb&&this.Zgb&&this.Zgb.id.equals(this.kHb.id))){if(this.kHb){var Xa=this.kHb.id.toString();
Xa in this.$O&&this.$O[Xa].ixh(Date.now()+this.Ns.Bwb)}this.Zgb&&(Xa=this.QGe.z1d(this.Zgb),this.$O[this.Zgb.id.toString()]=Xa,Xa.GLb(!0))}}get TQf(){var Xa=this.pa.Pa;if(!Xa||!Xa.mb||Xa.mb.Sl)return null;Xa=Xa.mb;return Xa.Va.node&&Xa.Va.node.isConnected?this.zc.gFa(Xa.Va.node):null}rIk(Xa,Bb){Xa=Bb.tableCellNode.id.toString();Xa in this.$O&&delete this.$O[Xa]}cpi(){this.Anh();for(const Xa of Object.keys(this.$O))this.$O[Xa].GLb(!0)}nIk(){this.Anh();for(const Xa of Object.keys(this.$O))this.$O[Xa].GYd();
for(const Xa of Object.keys(this.uJa))this.uJa[Xa].IYd()&&delete this.uJa[Xa]}$g(Xa,Bb){if(Bb&&Bb.node&&Bb.property.id===ma.a.tq.id){Xa=Object(sa.a)(5,Bb.node);Bb=!Bb.node.loading;const mc=this.zc.gFa(Xa);if(mc)this.s4g(mc,Bb),this.t4g(mc,Bb);else if(Xa=this.Ga.Tda(Xa))this.s4g(Xa,Bb),this.t4g(Xa,Bb)}}YB(){this.uJa={}}Anh(){for(const Xa of Object.keys(this.$O))this.$O[Xa].Z1i()&&delete this.$O[Xa]}s4g(Xa,Bb){Xa=Xa.id.toString();if(Xa in this.$O){Xa=this.$O[Xa];const mc=Object(sa.a)(Ud,Xa);mc&&mc.Hpl();
Xa.GLb(!0);Bb&&(Xa.w3c=!0)}}t4g(Xa,Bb){var mc=this.Ga.vn(Xa);mc&&this.ta.Ba&&this.ta.Ba.sid===mc.get_sid()&&this.ta.Ba.cid===mc.get_cid()&&(mc=Xa.id.toString(),Bb?mc in this.uJa&&delete this.uJa[mc]:(Bb=Object(ka.a)(130,Xa)?this.lY.h7b(Object(sa.a)(130,Xa)):this.lY.t7b(Object(sa.a)(4,Xa)))&&0<Bb.length&&(mc in this.uJa?this.uJa[mc].GLb(!1):(Xa=this.QGe.z1d(Xa),this.uJa[mc]=Xa,Xa.GLb(!1))))}}Object(h.a)(Ad,"TextContentMonitor",null,[]);class be extends Ib{constructor(Xa,Bb,mc,Qc,td){super(Xa,Bb,Qc,
td);this.zc=mc}get tableCellNode(){return Object(sa.a)(130,this.gb)}O8b(){const Xa=new m.a;this.zc.Zoc(this.tableCellNode,Bb=>{(Bb=this.Gh.text(Bb))&&0<Bb.length&&Xa.add(Bb)});return Xa.toArray().join(" ")}P8b(){const Xa=new m.a;this.zc.Zoc(this.tableCellNode,Bb=>{Bb.Ua(ma.a.tq)&&(Bb=Bb.eb(ma.a.tq))&&0<Bb.length&&Xa.add(Bb)});return Xa.toArray().join(" ")}GYd(){try{const Xa=this.O8b()||"",Bb=this.Dhc||"";if(Xa!==Bb&&this.eUa(Xa)!==this.eUa(Bb)){const mc=Db.a.eI("TableCellNode",this.rzh+"/"+this.tableCellNode.Kr,
"Start",od.a.uf(this.hHb),"LastSnapshotTime",od.a.uf(this.Ehc),"EverEdit",this.w3c);mc.Expiration=-1<this.gIa?(+new Date(this.gIa)-+this.hHb).toString():null;const Qc=Xa.length-Bb.length;Qc?mc.TextLengthDelta=Qc:mc.SameLengthDiffDetails=this.Gth(Xa,Bb);aa.a.J(37748808,814,15,ud.c(mc))}}catch(Xa){aa.a.J(37748810,814,10,"ShapeContentRecord:CheckTextContent failed. {0}",Xa)}}IYd(){try{const Xa=this.lY.h7b(this.tableCellNode);if(Xa&&0<Xa.length)return!1;const Bb=this.P8b()||"",mc=this.Dhc||"";if(Bb!==
mc&&0>Bb.indexOf(mc)&&!(0<=this.eUa(Bb).indexOf(this.eUa(mc)))){const Qc=Db.a.eI("TableCellNode",this.rzh+"/"+this.tableCellNode.Kr,"Start",od.a.uf(this.hHb),"LastSnapshotTime",od.a.uf(this.Ehc),"TextLengthDelta",Bb.length-mc.length);aa.a.J(37748812,814,15,ud.c(Qc))}}catch(Xa){aa.a.J(37748814,814,10,"ShapeContentRecord:CheckWetContentUpdate failed. {0}",Xa)}return!0}get rzh(){const Xa=this.Ga.vn(this.tableCellNode);return Xa?Xa.Kr:"UnknownShape"}}Object(h.a)(be,"TableCellContentRecord",Ib,[]);class uf{constructor(Xa,
Bb,mc,Qc){this.Ga=Xa;this.zc=Bb;this.Gh=mc;this.lY=Qc}z1d(Xa){return Object(ka.a)(4,Xa)?new Ud(Object(sa.a)(4,Xa),this.Ga,this.Gh,this.lY):Object(ka.a)(130,Xa)?new be(Object(sa.a)(130,Xa),this.Ga,this.zc,this.Gh,this.lY):null}}Object(h.a)(uf,"TextContentRecordFactory",null,[1101]);var sd=d(637);class Ze{constructor(Xa,Bb,mc,Qc,td){this.Gb=Xa;this.nna=Bb;this.pa=mc;this.CJ=Qc;this.Gy=td;this.C7c=!1}initialize(){this.pa.fE(Object(r.a)(this,this.iJb,"onSetSelectionFinished"));this.CJ.Jii(Object(r.a)(this,
this.lch,"onTypingLockStatusChanged"))}dispose(){this.pa.GVe(Object(r.a)(this,this.iJb,"onSetSelectionFinished"));this.CJ.o9k(Object(r.a)(this,this.lch,"onTypingLockStatusChanged"))}iJb(){var Xa=this.pa.Ev();let Bb=null;for(const mc of Xa)if(Xa=Object(sa.a)(ta.TableCellNode,mc))if(Xa=Object(sa.a)(1128,Xa.tg(this.Gb.Na)))if(Bb=Xa.Q4c)break;this.XOh(Bb)}lch(Xa,Bb){this.XOh(Bb.EQi)}XOh(Xa=null){this.pa.D9()?this.PCl(Xa):this.ycl()}PCl(Xa=null){if(this.Gb.editingView&&this.Gb.editingView.hm){const Bb=
this.R5f();Bb&&(this.nna.ZI(Bb.shapeNode).Byd(Xa),Xa&&(Bb.Mtd=!0,this.Gy.Kkh(new sd.a(Bb)),Bb.Mtd=!1));this.C7c||aa.a.J(37573824,828,50,"TypingLockHandler:SuspectEditingView - ContentEditableView is switching to cell-lock mode");this.Gb.editingView.disable(!1,14);this.C7c=!0}}ycl(){if(this.Gb.editingView&&this.Gb.editingView.hm){const Xa=this.R5f();Xa&&Xa.shapeNode.vd&&(this.nna.ZI(Xa.shapeNode).Byd(null),Xa.uge());this.C7c&&aa.a.J(37573826,828,50,"TypingLockHandler:ResumeEditingView - ContentEditableView is switching back to edit mode");
this.Gb.editingView.o2a();this.C7c=!1}}R5f(){let Xa=null;const Bb=this.pa.Xd();1===Bb.length&&(Xa=Object(sa.a)(119,Bb[0].qc(this.Gb.Na)));return Xa}}Object(h.a)(Ze,"TypingLockHandler",null,[1129,107]);var Ke=d(923);class hf{constructor(){this.h9c=this.jh=this.w5=this.r8c=this.LE=this.K=this.xH=null;this.Jec=0;this.bdd=null;this.wwe=!1;this.o5c=null;this.Eye=!1;this.g8c=!0;this.kjc=tb.a("PresencePackage.RefactorInit")}get name(){return"Presence"}PFi(){this.K.register(D.a,"Common.PresenceUser").as("Common.IPresenceUser").ma();
this.K.register(lb,"PowerpointPresence.PresenceUtils").as("Common.IPresenceConverter").ma().oa(()=>new lb(this.K.resolve("PowerPointWebEditor.ICoauthStateGetter")));this.wwe=!0}Yb(Xa){try{aa.a.J(509100485,814,50,"PresencePackage::configure");this.Jec=(new Date).getTime();this.K!==Xa&&(this.K=Xa,this.w5=this.K.resolve("PowerPointWebEditor.Core.IBundleMetricRecorder"),this.jh=this.w5.XEa(1,this.name),this.wwe=!1,this.Eye=this.K.resolve("PowerPointWebEditor.IApplicationSettings").pptUseEarlyPresenceRefactoring);
this.xH=this.K.resolve("Common.AFrameworkApplication");const Bb=this.K.resolve("PowerPointWebEditor.IApplicationSettings");this.g8c=!w.AFrameworkApplication.fa.ka("PPTODeprecateRtcFallback");this.wwe||this.PFi();const mc=Bb.Nyi&&Bb.pRb?!1:Bb.yg,Qc=this.dOi(this.K.resolve("PowerpointPresence.RtcParams"),this.K.resolve("Common.IPresenceUser"),mc,Bb["368"]);Qc?(this.K.register(1098,"Common.IRealtimeChannelBasic").ma().oa(()=>Qc),this.K.register(1099,"AppRealtimeChannel.IRealtimeChannel").ma().oa(()=>
Qc),this.MFi(Bb),this.kjc&&this.init()):aa.a.J(509100484,814,15,"PresencePackage::configure could not create rtc")}catch(Bb){aa.a.J(508929377,814,10,"PresencePackage::configure; Initializing Presence failed: {0}",Bb)}}MFi(Xa){this.K.register(Na,"PowerpointPresence.PPTRtcProvider").as("Common.Interface.IRtcBasicProvider").ma().oa(()=>new Na(this.K.resolve("Common.IRealtimeChannelBasic")));this.K.register(bb,"PowerpointPresence.EditorPresenceTracker").as("PowerpointPresence.IEditorPresenceTracker").ma().oa(()=>
new bb(this.K.resolve("PowerPointWebEditor.ICoauthStateGetter")));this.K.register(Za,"PowerpointPresence.PptRealtimeChannelMetrics").as("PowerpointPresence.IPptRealtimeChannelMetrics").ma().oa(()=>new Za(this.K.resolve("PowerpointPresence.RtcParams"),this.K.resolve("PowerPointWebEditor.ICoauthStateGetter"),this.K.resolve("PowerPointWebEditor.Core.INetworkHealthManager"),this.K.resolve("PowerPointWebEditor.Core.INetworkState"),T.a.getInstance(),Xa.rtcAllowCrossDomainAccessOrigins));this.K.register(mb,
"PowerpointPresence.PresenceManager").as("PowerpointPresence.IPresenceManager").as("Common.IPresenceSender").as("PowerpointPresence.IPresenceUserManager").as("Common.IPresenceRemover").ma().oa(()=>new mb(this.K.resolve("Common.IPresenceUser"),w.AFrameworkApplication.fa,this.K.resolve("AppRealtimeChannel.IRealtimeChannel"),this.K.resolve("PowerpointPresence.RtcParams"),this.xH.dT,this.K.resolve("PowerPointWebEditor.IPptSelectionManager"),this.K.resolve("PowerPointWebEditor.Graph.IGraphOperationEventSource"),
this.K.resolve("PowerPointWebEditor.ViewElements.IViewElementEventHandlers"),this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler"),this.K.resolve("PowerPointWebEditor.Graph.IGraphTopologyManager"),this.K.resolve("Common.IActionManagerExtended"),this.K.resolve("PowerpointPresence.IPresenceEventNotifier"),this.K.resolve("PowerPointWebEditor.ICoauthStateGetter"),this.K.resolve("PowerPointWebEditor.ICoauthStateSetter"),Xa,this.K.resolve("PowerPointWebEditor.Core.ICoreEventSource"),this.K.resolve("PowerpointPresence.IEditorPresenceTracker"),
this.K.resolve("PowerpointPresence.IPresenceColorProvider"),this.K.resolve("PowerpointPresence.IPresenceEmailConverter"),this.K.resolve("PowerpointPresence.IPptRealtimeChannelMetrics"),this.K.resolve("PowerPointWebEditor.Core.IUnifiedAppState"),this.K.resolve("PowerpointPresence.IPresencePerfLogger"),this.K.Ia("PowerPointWebEditor.PodsPops.IPodSeamlessFailoverManager"),this.K.resolve("PowerpointPresence.IPresencePrepCacheParser").JXc(),this.K.resolve("PowerPointWebEditor.Core.INetworkHealthManager"),
this.K.resolve("PowerPointWebEditor.IPopWebService"),this.K.resolve("PowerPointWebEditor.ISessionInfoOwner")));this.K.register(xb,"PowerpointPresence.PresenceCache").ma().oa(()=>new xb(this.K.resolve("PowerpointPresence.IPresenceManager")));this.K.register(Uc,"PowerpointPresence.PresencePresenter").ma().oa(()=>new Uc(this.K.resolve("PowerPointWebEditor.ViewElements.IViewElementEventHandlers"),this.K.resolve("PowerPointWebEditor.Graph.IGraphTopologyManager"),this.K.resolve("PowerpointPresence.IPresenceManager"),
this.K.resolve("Common.DragInputManager"),this.K.resolve("PowerpointPresence.ICoauthStateChangesHandler"),this.K.resolve("PowerPointWebEditor.ViewElements.IShapeComponentViewManager<PowerPointWebEditor.IShapePresenceView>"),this.K.resolve("PowerPointWebEditor.IPresentationReader"),this.K.resolve("Box4.IPageView").Na,this.K.resolve("PowerPointWebEditor.IThumbnailNavigationPaneView").Na,this.K.resolve("PowerpointPresence.IPresenceEventHandlers"),Xa.podsNewThumbnailVisibleRangeFetchExperience));this.K.register(Sc,
"PowerPointWebEditor.PptWetChangeHandler").as("PowerPointWebEditor.IWetChangeHandler").ma().oa(()=>new Sc(this.K.resolve("Common.IPresenceUser").clientId,Xa.hrl,this.K.resolve("PowerPointWebEditor.Graph.ITraverserFactory"),this.K.resolve("Box4.Graph.IGraphInstance").yd(10),this.K.resolve("PowerPointWebEditor.ViewElements.IViewElementEventHandlers")));const Bb=new Oc(Xa.IUi,Xa.Rud,Xa.Qud,Xa.Bwb,Xa.z$b,Xa.CZc,Xa.nnb,Xa.Hxd,Xa.$jb,Xa.eQc,Xa.cQc,Xa.EPb,Xa.Ahb,Xa.dwb,Xa.podsTableRTTEnabled,Xa.podsTableCellLockEnabled);
this.K.register(Ze,"PowerpointPresence.TypingLockHandler").as("PowerpointPresence.ITypingLockHandler").ma().oa(()=>new Ze(this.K.resolve("PowerPointWebEditor.View.IPPTPageView"),this.K.resolve("PowerPointWebEditor.ViewElements.IShapeComponentViewManager<PowerPointWebEditor.IShapePresenceView>"),this.K.resolve("PowerPointWebEditor.IPptSelectionManager"),this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler"),this.K.resolve("PowerPointWebEditor.ViewElements.IViewElementEventSource")));this.K.register(Ha,
"PowerpointPresence.CoauthStateChangesHandler").as("PowerpointPresence.ICoauthStateChangesHandler").ma().oa(()=>new Ha(da.App.Mh,this.K.resolve("PowerpointPresence.IPresenceManager"),this.K.resolve("Common.IPresenceUser").clientId,this.K.resolve("AppRealtimeChannel.IRealtimeChannel"),this.K.resolve("PowerPointWebEditor.IPPTWorkspace"),this.K.resolve("Common.ITaskManager"),this.K.resolve("PowerPointWebEditor.IPptSelectionManager"),this.K.resolve("Box4.ContentEditableViewEventSource"),this.K.resolve("PowerPointWebEditor.IViewElementHelper"),
this.K.resolve("PowerPointWebEditor.IShapeReader"),this.K.resolve("PowerPointWebEditor.Graph.ITableReader"),this.K.resolve("Box4.Graph.IGraphInstance").yd(12),Xa,Bb,this.K.resolve("PowerPointWebEditor.IWetChangeHandler"),this.K.resolve("PowerPointWebEditor.Graph.IGraphTopologyManager"),this.K.resolve("PowerPointWebEditor.ViewElements.IShapeComponentViewManager<PowerPointWebEditor.IShapePresenceView>"),this.K.resolve("PowerPointWebEditor.ViewElements.IViewElementEventHandlers"),this.K.resolve("PowerpointPresence.ITypingLockHandler"),
this.K.resolve("PowerPointWebEditor.View.IPPTPageView").Na,this.K.resolve("Box4.Graph.IGraphInstance").yd(16),J.a.Lt(G.a.instance.Ia("Common.ISystemInitiatedFeedback"))));this.K.register(1100,"PowerpointPresence.IPresencePawnFactory").ma().oa(()=>new Hc);this.K.register(1101,"PowerpointPresence.ITextContentRecordFactory").ma().oa(()=>new uf(this.K.resolve("PowerPointWebEditor.IShapeReader"),this.K.resolve("PowerPointWebEditor.Graph.ITableReader"),this.K.resolve("Box4.IParagraphReader"),this.K.resolve("PowerPointWebEditor.IWetChangeHandler")));
this.K.register(Ad,"PowerpointPresence.TextContentMonitor").ma().oa(()=>new Ad(this.K.resolve("PowerPointWebEditor.Core.ICoreEventHandler"),this.K.resolve("PowerPointWebEditor.ViewElements.IViewElementEventHandlers"),Z.a.instance,this.K.resolve("Box4.Graph.IGraphInstance").yd(12),this.K.resolve("PowerPointWebEditor.Graph.IGraphTopologyManager"),this.K.resolve("PowerPointWebEditor.Graph.IGraphOperationEventHandlers"),this.K.resolve("PowerPointWebEditor.IWetChangeHandler"),this.K.resolve("PowerPointWebEditor.IPptSelectionManager"),
this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler"),this.K.resolve("PowerPointWebEditor.IShapeReader"),this.K.resolve("PowerPointWebEditor.Graph.ITableReader"),this.K.resolve("PowerpointPresence.ITextContentRecordFactory"),Bb));this.K.register(B,"Common.App.Presence.AwayManager").ma().oa(()=>this.OJi(this.K.resolve("Common.IPresenceUser"),this.K.resolve("Common.IRealtimeChannelBasic"),this.K.resolve("Common.IPresenceRemover"),this.K.resolve("Common.IPresenceConverter"),Xa.ka("PeoplesWellExtraButtonInfoIsEnabled")));
this.K.register(1102,"PowerPointWebEditor.IDelayedPresenceUserInfoGetter").ma().oa(()=>new sc(this.K.resolve("AppRealtimeChannel.IRealtimeChannel")));aa.a.J(509100483,814,50,"PresencePackage::configurePostRTC; Setting Rtc configured");this.xRc().dlb("RTCConfigured")}Soj(Xa){let Bb;var mc=Xa;Bb=0;if(Xa=this.K.resolve("PowerpointPresence.IPresencePrepCacheParser").hqj())return mc=this.K.resolve("PowerpointPresence.IPresencePrepCacheParser").Atd(),{CXe:Xa,AXe:Bb,v6d:mc};Bb=1;if(Xa=this.K.resolve("PowerPointWebEditor.ICoauthStateSetter").Ish)return mc=
this.K.resolve("PowerPointWebEditor.ICoauthStateSetter").Atd,{CXe:Xa,AXe:Bb,v6d:mc};if(this.g8c)return{CXe:mc,AXe:2,v6d:!0}}cOi(){const Xa=1E3*this.K.resolve("PowerPointWebEditor.IApplicationSettings").rtcDiscoveryTimeoutSeconds;0<Xa&&(this.bdd=new z.a(2,1,Xa,()=>{this.g8c?this.K.resolve("PowerPointWebEditor.ICoauthStateSetter").WZf=!0:this.K.qb("AppRealtimeChannel.IRealtimeChannel")||aa.a.J(509670485,828,10,"PresencePackage::createRtcDiscoveryTimeoutTask RTC Discovery Timed Out after {0} ms and attempted to fallback",
Xa);this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler").$oh(Object(r.a)(this,this.JMe,"onPopsRtcEndpointUrlReady"));this.K.qb("AppRealtimeChannel.IRealtimeChannel")||(this.Yb(G.a.instance),this.kjc||this.init())},90,"111"),this.K.resolve("Common.ITaskManager").Hb(this.bdd))}dOi(Xa,Bb,mc,Qc){aa.a.J(512360602,828,50,"PresencePackage::CreateRtcInstance; isPodsEnabled:{0}",mc);Bb.clientId=Xa.clientId;var td=null;Bb=null;const Md=T.a.getInstance();if(mc){Bb=Qc+"rtc2";({CXe:Bb,AXe:mc,v6d:Qc}=
this.Soj(Bb));td=!this.K.resolve("PowerPointWebEditor.ICoauthStateGetter").amIAlone;const Pd=this.g8c&&this.K.resolve("PowerPointWebEditor.ICoauthStateSetter").WZf,Be=this.K.resolve("PowerPointWebEditor.ICoauthStateSetter").Jqg;aa.a.J(512360601,828,15,"PresencePackage::CreateRtcInstance; Discovering RTC enabled; RtcDiscoverType:{0} fCoauthoring:{1} fDefaultConnectToRtc:{2} fUseFallback:{3} fPopsRtcConfigured:{4}",Zb[mc],td,Qc,Pd,Be);if(2===mc&&!Pd)return this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler").Bhi(Object(r.a)(this,
this.JMe,"onPopsRtcEndpointUrlReady")),this.cOi(),null;if(!Qc&&!td)return this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler").WSd(Object(r.a)(this,this.OIb,"onCoauthStatusChanged")),null;td=this.IJi(Xa,Bb,this.K.resolve("PowerPointWebEditor.IApplicationSettings"),Md)}return M.RealtimeChannel.createInstance(Xa.clientId,Xa.userSessionId,Xa.wqd,Xa.ada,Xa.Kvh,3,Xa.ex,Bb,td,Md)}OJi(Xa,Bb,mc,Qc,td){const Md=new C.a;Md.Og(mc);mc=new C.a;mc.Og(Bb);return new B(Xa,mc.task,Md.task,Qc,this.K.resolve("Common.ITaskManager"),
this.xH.dT.rd.XVd?6E4:this.xH.dT.rd.awayCoauthorThresholdMs,Object(r.a)(this.xH.dT.gH(),this.xH.dT.gH().processAction,"processAction"),fa.App.k7a.notificationBar,td)}init(){aa.a.J(509100482,814,50,"PresencePackage::init; initing presence");const Xa=this.K.resolve("PowerpointPresence.IPresencePerfLogger");Xa.ji(21,hf.ljc);Xa.ji(22,this.Jec);Xa.ji(24,(new Date).getTime());this.K.resolve("PowerPointWebEditor.PresentationContext").isValid?(aa.a.J(509100481,814,50,"PresencePackage::init; Setting Presentation Id ready"),
this.xRc().dlb("PresentationId")):this.K.resolve("PowerPointWebEditor.Core.IPodsPopsEventHandler").Dzf(Object(r.a)(this,this.Tmc,"onPresentationIdReady"));this.K.resolve("PowerPointWebEditor.IAppBootCompletedListener").tAb(()=>{aa.a.J(509100480,814,50,"PresencePackage::init; Setting B2I Finished");this.xRc().dlb("B2IFinished")})}Tmc(){aa.a.J(509100451,814,50,"PresencePackage::onPresentationIdReady; Setting Presentation Id ready");this.xRc().dlb("PresentationId");this.K.resolve("PowerPointWebEditor.Core.IPodsPopsEventHandler").aph(Object(r.a)(this,
this.Tmc,"onPresentationIdReady"))}JMe(){this.bdd&&this.K.resolve("Common.ITaskManager").Lg(this.bdd);this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler").$oh(Object(r.a)(this,this.JMe,"onPopsRtcEndpointUrlReady"));this.K.qb("AppRealtimeChannel.IRealtimeChannel")||(this.Yb(G.a.instance),this.kjc||this.init())}OIb(Xa,Bb){2!==Bb.D5g||this.K.qb("AppRealtimeChannel.IRealtimeChannel")||(this.Yb(G.a.instance),this.kjc||this.init());this.K.qb("AppRealtimeChannel.IRealtimeChannel")&&this.K.resolve("PowerPointWebEditor.CoreExt.ICoauthEventHandler").qVe(Object(r.a)(this,
this.OIb,"onCoauthStatusChanged"))}xRc(){this.h9c||(this.h9c=new Ke.a(Object(r.a)(this,this.aAb,"initInternal"),["PresentationId","B2IFinished","RTCConfigured"]));return this.h9c}aAb(){this.K.resolve("PowerpointPresence.IPresencePerfLogger").ji(4,this.K.resolve("PowerPointWebEditor.Core.IPodsPopsEventSource").tTe);this.K.resolve("PowerpointPresence.IPresencePerfLogger").ji(23,(new Date).getTime());this.LNj();this.EOj();this.h9c=null}EOj(){try{let Xa="";this.K.resolve("PowerPointWebEditor.IDelayedPresenceUserInfoGetter");
Xa=this.jh.Zt("presencemanager");this.FOj();this.jh.fu(Xa);this.K.resolve("PowerPointWebEditor.ICoauthStateSetter").y2c=!0;aa.a.J(8958608,814,50,"PresencePackage::Init; Presence downloaded");da.App.E_d&&(Xa=this.jh.Zt("contentnotification"),wb.init(),this.jh.fu(Xa));Xa=this.jh.Zt("resolve");this.K.resolve("PowerpointPresence.IPresencePerfLogger").s_i();this.LE=this.K.resolve("PowerpointPresence.IPresenceManager");this.K.resolve("Common.IPresenceConverter");this.K.resolve("Common.IRealtimeChannelBasic");
this.xH.dT.rd.c1i&&(aa.a.J(512360600,814,50,"PresencePackage::Init; Refresh Peoples well after Rtc ready"),this.xH.dT.gH().processAction(v.a.G8a,2));this.K.resolve("PowerPointWebEditor.IWetChangeHandler");this.K.resolve("Common.Interface.IRtcBasicProvider");this.K.resolve("PowerpointPresence.ICoauthStateChangesHandler");this.K.resolve("PowerpointPresence.PresencePresenter");this.K.resolve("PowerpointPresence.IPresencePawnFactory");this.K.resolve("Common.App.Presence.AwayManager");this.xH.dT.rd.hermesMonitorShapeContentChangeEnabled&&
this.K.resolve("PowerpointPresence.TextContentMonitor");this.jh.fu(Xa);this.K.resolve("PowerpointPresence.IPresencePerfLogger").d_i();this.K.resolve("PowerpointPresence.IPresencePrepCacheParser").qck()}catch(Xa){aa.a.J(512360599,814,10,"PresencePackage::Init; Loading presence and peoples well failed: {0}",Xa)}}dispose(){this.LE?this.LE.disconnect():aa.a.J(512360598,814,10,"PresencePackage::Dispose; m_presenceManager is null.");this.K.resolve("PowerpointPresence.IPresencePerfLogger").dispose()}FOj(){this.K.resolve("PowerpointPresence.PresenceManager").vb();
aa.a.J(512360597,814,50,"PresencePackage::InitializePresenceManager; Presence Manager loaded and initialized")}IJi(Xa,Bb,mc,Qc){let td=Bb;td=td.endsWith("/")?td+"findsession":td+"/findsession";aa.a.J(512360596,814,50,"PresencePackage::CreateAssignRtcMachineStrategy; Using rtc path: {0}; WacClusterId: {1} ",td,Xa.ada.uha);Bb=()=>S.FindSessionStrategy.RLi(Xa.userSessionId,Xa.ada,td,Xa.ex,w.AFrameworkApplication.buildVersion,Xa.clientId,hf.q9i(w.AFrameworkApplication.buildVersion),Qc,Xa.Kvh,()=>{if(w.AFrameworkApplication.gh)return w.AFrameworkApplication.gh;
const Pd=this.K.resolve("PowerPointWebEditor.PresentationContext").presentationId.string;Pd||aa.a.J(512360595,814,15,"CreateAssignRtcMachineStrategy - returning a null query string");return Pd},this.K.resolve("PowerpointPresence.IPresencePrepCacheParser").fqj());const Md=!!this.r8c;return this.Eye||Md?this.o5c=new Wa(this.r8c,Bb,mc,Qc,this.K.resolve("PowerpointPresence.IPresencePerfLogger")):Bb()}LNj(){var Xa;if(Xa=this.K.resolve("PowerPointWebEditor.IApplicationSettings").presenceEarlyFindSessionEnabled?
this.K.resolve("PowerpointPresence.IPresencePrepCacheParser").getFindSessionResponse():this.K.resolve("PowerPointWebEditor.Core.IFindRtcSessionSimpleStrategy").G7d)Xa=ca.RtcUtils.deserialize(Xa,"PresencePackage","Deserialize existing FindSession response",!0),this.Rkd(Xa)}Rkd(Xa){if(Xa)try{this.r8c=Object.assign(new O.a,{$bc:Xa[L.a.sBb],errorMessage:Xa[L.a.errorMessage],D2b:Xa[L.a.I2e],o6:Xa[L.a.o6],rB:Xa[L.a.rB],VXc:Xa[L.a.zee],Xfd:Xa[L.a.Bhb],Yfd:Xa[L.a.QMa],agd:Xa[L.a.Dhb]}),this.Eye&&this.o5c&&
(this.o5c.findSessionResponse=this.r8c)}catch(Bb){aa.a.J(512360594,828,10,"Exception caught while creating FindSessionResponse: {0}",Bb)}}static main(){hf.ljc=(new Date).getTime();const Xa=new hf;w.AFrameworkApplication.fa&&w.AFrameworkApplication.fa.ka("IsSyncConfigPresenceEnabled")?(Xa.Yb(G.a.instance),Xa.K.qb("AppRealtimeChannel.IRealtimeChannel")&&!Xa.kjc&&Xa.init()):N.a.instance.Ac(Xa)}static q9i(Xa){return String.format("{0}, {1}, {2}",hf.GIf(R.a[3]),hf.GIf("browser"),Xa)}static GIf(Xa){return Xa?
Xa.charAt(0).toLocaleUpperCase()+Xa.substring(1,Xa.length):Xa}}hf.ljc=0;Object(h.a)(hf,"PresencePackage",null,[2,3]);Type.registerNamespace("PowerPointWebEditor");Type.registerNamespace("PowerpointPresence");window.g_hermesPresence1JS=new Date;Type.registerNamespace("Common.App.Presence");Type.registerNamespace("AppRealtimeChannel");hf.main()},195:function(K,U,d){d.r(U);d.d(U,"RtcUtils",function(){return m});K=d(0);var h=d(392),e=d(346),r=d(36);class m{static xYd(n,z=e.RealtimeChannel.pIe){let v;
try{v=r.c(n)}catch(x){throw n=String.format("Failed to JSON-serialize payload : {0}",x),h.ULS.sendTraceTag(18637072,500,10,n),Error.argument("payload",n);}if(v.length>z)throw n=String.format("Payload exceeds maximum length: {0} > {1}.",v.length,z),h.ULS.sendTraceTag(18637074,500,10,n),Error.argument("payload",n);return v}static deserialize(n,z,v){if(!n)return null;if(Object.getType(n)!==String){var x=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",
z,Object.getType(n).getName(),v);h.ULS.sendTraceTag(18637075,500,10,x);return null}x=null;try{x=r.a(n)}catch(B){n=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",z,B,v),h.ULS.sendTraceTag(18637077,500,10,n)}return x}static FIb(n){if(!n)return"";if("string"===typeof n)return n.toString();try{return r.c(n)}catch(z){return n.toString()}}static qZf(n){let z,v,x;z=0;x=v=null;if(!n)return{Tge:z,Uge:v,ej:x};try{const B=n.source;B&&Object.getType(B)===
String&&(x=B);const D=n.context;D&&(n=D,z=n.status?n.status:0,v=n.statusText?n.statusText:null)}catch(B){}return{Tge:z,Uge:v,ej:x}}}Object(K.a)(m,"RtcUtils",null,[])},308:function(K,U,d){d.r(U);K=d(0);var h=d(392),e=d(7),r=d(105),m;(function(x){x[x.SendNotification=0]="SendNotification";x[x.SendPersistentState=1]="SendPersistentState";x[x.FindSession=2]="FindSession";x[x.Last=3]="Last"})(m||(m={}));Object(K.b)("ApiType",m);var n;(function(x){x[x.AttemptCount=0]="AttemptCount";x[x.SuccessCount=1]=
"SuccessCount";x[x.DropCount=2]="DropCount";x[x.FailedCount=3]="FailedCount";x[x.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";x[x.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";x[x.ThrottledCount=6]="ThrottledCount";x[x.Last=7]="Last"})(n||(n={}));Object(K.b)("EventCountType",n);var z=d(711);d.d(U,"FrequentLoggingMetrics",function(){return v});class v{constructor(x){this.IMf=this.s0f=null;this.l3g=this.N2f=0;this.Rt=null;this.Omf=this.CJd=0;this.hi=x;this.rOj();this.yEd=this.Agf=
this.UJd=!1;this.wJd=0}get e1i(){return this.yEd}OAl(x){this.Omf=x;window.setInterval(Object(e.a)(this,this.wse,"logMetricsBatchAndReset"),x);this.CJd=(new Date).getTime()}qH(x,B){this.trl(x)&&!this.Agf||this.e1i||!window.navigator.onLine||this.hi.eGa||(this.Rt[x][B]++,this.UJd=!0)}rOj(){this.Rt=Array(3);for(let x=0;3>x;x++){this.Rt[x]=Array(7);for(let B=0;7>B;B++)this.Rt[x][B]=0}}lsi(){const x={};for(let B=0;3>B;B++)for(let D=0;7>D;D++)this.N5j(B,D)&&(x[m[B]+n[D]]=this.Rt[B][D]);x.FSDomain=this.s0f;
x.ConnectionDomain=this.IMf;x.FSRetryInterval=this.N2f;x.MaxPayloadSize=this.l3g;x.LogNumber=this.wJd;1===this.wJd&&(x.FSLatencies=z.a.instance.ihj(),x.ConLatencies=z.a.instance.ndj());return x}N5j(x,B){return 2===x&&3!==B&&0!==B?!1:!0}trl(x){return 2===x?!1:!0}wse(){if(this.UJd){this.wJd++;if((new Date).getTime()-this.CJd<5E3+this.Omf){var x=r.a.toJSON(this.lsi());h.ULS.sendTraceTag(50644352,500,15,x)}this.CJd=(new Date).getTime();for(x=0;3>x;x++)for(let B=0;7>B;B++)this.Rt[x][B]=0;this.UJd=!1}}auk(){this.Agf=
!0}static get instance(){return v.La}static create(x){v.instance||(v.La=new v(x));return v.instance}}v.La=null;Object(K.a)(v,"FrequentLoggingMetrics",null,[1167])},346:function(K,U,d){d.r(U);K=d(0);var h=d(392),e=d(7),r=d(1095),m=d(1014),n=d(72),z=d(27);class v{constructor(Qa,qa){this.status=Qa;this.nCb=qa}}Object(K.a)(v,"UserStatusInfo",null,[]);var x=d(81),B=d(711);class D{constructor(Qa,qa){this.data=Qa;this.timeStamp=qa}}Object(K.a)(D,"PresenceData",null,[]);class w{constructor(Qa){this.Hra=!1;
this.esb=0;this.JCd=!1;this.setTimeout=w.H2d;this.clearTimeout=w.x2d;this.zdk=Object(e.a)(this,this.Lck,"logRtcConnectingUsageStatement");this.hs=Qa}RBk(){this.Hra||(this.esb=this.setTimeout(()=>{this.Hra=!1;this.Dwg()},8E3),this.Hra=!0,this.JCd=!1)}ACk(){this.HN()}mIk(){this.Dwg()}Dwg(){this.HN();this.JCd||(this.JCd=!0,this.zdk())}Lck(){h.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.hs)}HN(){this.Hra&&this.clearTimeout(this.esb);this.esb=0;this.Hra=
!1}static H2d(Qa,qa){return window.setTimeout(Qa,qa)}static x2d(Qa){window.clearTimeout(Qa)}}Object(K.a)(w,"ConnectedUsageKpiLogger",null,[1186]);class J{constructor(){this.pod=this.RTe;this.UTe=this.VTe;this.qod=this.TTe;this.xqc=this.XTe;this.Jlh=this.WTe;this.dUe=this.eUe;this.aUe=this.bUe;this.Ljb=this.ZTe;this.zqc=this.$Te;this.Elh=this.STe;this.pIb=this.FJe;this.Ulc=this.GJe}RTe(){}VTe(){}TTe(){}XTe(){}WTe(){}bUe(){}$Te(){}ZTe(){}eUe(){}STe(){}FJe(){}GJe(){}}Object(K.a)(J,"NoopRealtimeChannelMetrics",
null,[1179,302]);class G{}G.W2a="presenceUpdated";G.updateNotification="updateNotification";G.wfh="persistentStateCleared";G.updatePersistentState="persistentStateUpdated";Object(K.a)(G,"RtcClientMethodNames",null,[]);class M{}M.HJj="realtimeChannelHub";M.W2a="UpdatePresence";M.Xaa="SendUpdateNotification";M.$9d="GetCompletePersistentStateWithMetadata";M.updatePersistentState="UpdatePersistentState";M.qnb="UpdateClientInfo";Object(K.a)(M,"RtcHubMethodNames",null,[]);class N{constructor(Qa){this.Yz=
Qa}l4k(Qa){this.Yz.on(G.W2a,Qa)}N4k(Qa){this.Yz.on(G.updateNotification,Qa)}i4k(Qa){this.Yz.on(G.updatePersistentState,Qa)}h4k(Qa){this.Yz.on(G.wfh,Qa)}nMl(Qa){this.Yz.off(G.W2a,Qa)}sMl(Qa){this.Yz.off(G.updateNotification,Qa)}mMl(Qa){this.Yz.off(G.updatePersistentState,Qa)}lMl(Qa){this.Yz.off(G.wfh,Qa)}W2a(Qa){return this.Yz.invoke(M.W2a,Qa)}qnb(Qa){return this.Yz.invoke(M.qnb,Qa)}Xaa(Qa,qa){return this.Yz.invoke(M.Xaa,Qa,qa)}$9d(Qa){return this.Yz.invoke(M.$9d,Qa)}updatePersistentState(Qa,qa){return this.Yz.invoke(M.updatePersistentState,
Qa,qa)}}Object(K.a)(N,"RealtimeChannelProxy",null,[1183,1184,1185]);class R{constructor(){this.pBd=this.Nbf=!1;this.nBd=0;this.tCd=this.wOd=this.vOd=this.QAd=!1;this.MEd=0;this.Urf=!1;this.Trf=this.Srf=0;this.xNd=!1;this.BNd=this.zNd=this.CNd=this.yNd=0;this.ANd=!1}get XVd(){return this.pBd}get awayCoauthorThresholdMs(){return this.nBd}get xki(){return this.QAd}get Hsl(){return this.vOd}get Isl(){return this.wOd}get GBi(){return this.tCd}get h6b(){return this.MEd}get vdl(){return this.Urf}get Jsh(){return this.Srf}get udl(){return this.Trf}get pdl(){return this.xNd}get qdl(){return this.yNd}get Nsh(){return this.CNd}get Ksh(){return this.zNd}get Msh(){return this.BNd}get Lsh(){return this.ANd}static createInstance(Qa){const {RealtimeChannel:qa}=
d(346);return Qa?Object.assign(new R,{Nbf:Qa.ka("AwayStatusManagerIsEnabled"),pBd:Qa.ka("AwayStatusOneMinuteTimeoutIsEnabled"),nBd:Qa.wc("AwayCoauthorThresholdMs",9E5),QAd:Qa.ka("RtcAllowCrossDomainAccessEnabled"),vOd:Qa.ka("ShouldLogOnContentNotification"),wOd:Qa.ka("ShouldLogOnHostSubscriptionNotification"),tCd:Qa.ka("RtcClientMetricsEnabled"),MEd:Qa.wc("RtcFindSessionRequestTimeoutInMS",6E4),Urf:Qa.ka("RtcJsClientFrequentlyLogsMetrics"),Srf:Qa.wc("RtcJsClientFrequentMetricsLatencyThresholdInMS",
1E3),Trf:Qa.wc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),xNd:Qa.ka("RtcClientMessageTelemetryEnabled"),yNd:Qa.wc("RtcClientMessageTelemetrySampleSize",5),CNd:Qa.wc("RtcSendTelemetryMessageIntervalInMS",3E5),zNd:Qa.wc("RtcLogClientMessageMetricsTimeOutInMs",2E4),BNd:Qa.wc("RtcMaxPayloadSizeInCharactersOverride",qa.pIe),ANd:Qa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new R,{Nbf:!1,pBd:!1,nBd:9E5,QAd:!1,vOd:!1,wOd:!0,tCd:!1,MEd:9E4,
xNd:!1,yNd:5,CNd:3E5,zNd:2E4,BNd:qa.pIe,ANd:!1})}}Object(K.a)(R,"RealtimeChannelSettings",null,[1182]);var C=d(715),O=d(1244),S=d(151);class T{constructor(Qa){this.oZb=null;this.Oya=0;this.V9a=!1;this.Fl=Qa;this.Fl.v7a(Object(e.a)(this,this.goa,"onConnectionStateChanged"))}goa(Qa,qa){this.Oya=qa.newState}DIk(){h.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Fl.bod()}hNj(Qa){this.oZb.init(Qa)}}Object(K.a)(T,"ARtcMessageHandler",null,[]);var ca=d(718);
class L{constructor(){this.Presence=null;this.TimeStamp=0}}Object(K.a)(L,"PresenceDataEntryForClients",null,[]);var da=d(105);class Z{constructor(Qa,qa=""){this.G6h=Qa;this.pBa=qa}send(){return this.G6h()}get messageId(){return this.pBa}}Object(K.a)(Z,"MessageHandler",null,[1210]);var fa=d(743);class aa extends Sys.EventArgs{constructor(Qa,qa,Wa,Hb){super();this.jWe=Qa;this.reconnectDelay=qa;this.reason=Wa;this.RYe=Hb}}Object(K.a)(aa,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var ja=d(1018);
class I{constructor(){this.gPd=this.Kj=null}get dr(){return this.Kj?this.gPd?this.gPd.getTime()-this.Kj.getTime():(new Date).getTime()-this.Kj.getTime():0}start(){this.Kj=new Date}stop(){this.gPd=new Date}}Object(K.a)(I,"SimpleStopwatch",null,[]);var sa=d(1019),ka;(function(Qa){Qa[Qa.contentUpdate=0]="contentUpdate";Qa[Qa.editorsTableUpdate=1]="editorsTableUpdate";Qa[Qa.fileNameUpdate=2]="fileNameUpdate";Qa[Qa.wetContentUpdate=3]="wetContentUpdate";Qa[Qa.persistedContentUpdate=4]="persistedContentUpdate";
Qa[Qa.clientRtcReconnectRequest=5]="clientRtcReconnectRequest";Qa[Qa.replicationTelemetry=6]="replicationTelemetry";Qa[Qa.lockUpdate=7]="lockUpdate";Qa[Qa.collabServiceContentUpdate=8]="collabServiceContentUpdate";Qa[Qa.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";Qa[Qa.saveTargetUpdate=10]="saveTargetUpdate";Qa[Qa.uploadToOcsUpdate=11]="uploadToOcsUpdate";Qa[Qa.labelUpdate=12]="labelUpdate";Qa[Qa.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";Qa[Qa.subscribeOrExtend=
14]="subscribeOrExtend";Qa[Qa.elapsedBootTelemetry=15]="elapsedBootTelemetry";Qa[Qa.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";Qa[Qa.clientToClientResponseMessage=17]="clientToClientResponseMessage";Qa[Qa.verifyNotificationPipeline=18]="verifyNotificationPipeline";Qa[Qa.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";Qa[Qa.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";Qa[Qa.last=21]="last"})(ka||(ka={}));Object(K.b)("UpdateNotificationType",ka);var Ma=d(579),
Ea=d(787),ma=d(788);class va extends T{constructor(Qa,qa,Wa,Hb,jc,gc,$b,wb,Db,Xb){super($b);this.Yz=null;this.Hmf=!1;this.pBa=0;this.WLd=new S.a;this.q1h=va.Adj();this.zLd=z.AFrameworkApplication.fa.Ha("OwningFeatureCrewForRtcNotificationKpis");this.Yc=Qa;this.oof=this.nof=0;this.oZb=qa;this.oZb.rJc(Object(e.a)(this,this.DIk,"onTooManyUndeliveredMessages"));this._clientId=Wa;this.j5h=jc;this.Fl.Mhi(Object(e.a)(this,this.zGk,"onRefreshProxyRequired"));this.Fl.Khi(Object(e.a)(this,this.xGk,"onRefreshAllPersistentStateRequest"));
this.Fl.Yhi(Object(e.a)(this,this.Xaa,"sendUpdateNotification"));this.Fl.Hfi(Object(e.a)(this,this.oEk,"onInternalPresenceUpdated"));this.Fl.Ifi(Object(e.a)(this,this.pEk,"onInternalUpdateNotificationReceived"));this.Fl.Gfi(Object(e.a)(this,this.nEk,"onInternalPersistentStateUpdated"));this.Fl.Ffi(Object(e.a)(this,this.mEk,"onInternalPersistentStateCleared"));this.Fl.Xhi(Object(e.a)(this,this.aZe,"sendPersistentState"));this.Fl.Pii(Object(e.a)(this,this.qnb,"updateClientInfo"));this.ii=gc;this.hs=
Hb;this.Rt=wb;this.xN=Db;this.CWb=Xb;this.GNa=Object(O.a)(String,z.AFrameworkApplication.Od.Application)||""}zGk(Qa,qa){this.Yz=this.j5h(qa.hubConnection);this.oZb.reset();this.Yz.l4k(Object(e.a)(this,this.Smc,"onPresenceUpdated"));this.Yz.i4k(Object(e.a)(this,this.wjd,"onPersistentStateUpdated"));this.Yz.h4k(Object(e.a)(this,this.HMe,"onPersistentStateCleared"));this.Yz.N4k(Object(e.a)(this,this.onc,"onUpdateNotificationReceived"))}goa(Qa,qa){this.Oya=qa.newState;2===qa.newState&&this.Dhl()}Dhl(){for(let Qa of this.WLd)this.Xaa(null,
new ja.a(Qa.key,Qa.value,!1,new r.a));this.WLd=new S.a}xGk(Qa,qa){qa.SYd();for(Qa=0;3>Qa;++Qa)this.nhl(Qa,qa)}nhl(Qa,qa){try{this.Yz.$9d(Qa).done(Wa=>{qa.uRb(qa.m_d,"GetCompletePresenceSuccess")&&(qa.uGi.mIk(),h.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.hs),this.Fl.ZYk(),this.SFk(Qa,Wa),this.Fl.$Xk(Wa),qa.UYf.Fb(Qa)&&this.Fl.Dkh(Qa,qa.UYf.ga(Qa),new r.a))}).fail(Wa=>{const {RtcUtils:Hb}=d(195);qa.uRb(qa.m_d,"GetCompletePresenceFail")&&(h.ULS.sendTraceTag(3249541,
500,15,"Failed to retrieve complete session state : {0} for [{1}]",Hb.FIb(Wa),this.hs),this.Fl.bod())}).always(()=>{qa.Vy&&qa.Vy.stop()})}catch(Wa){h.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",qa.m_d,Wa.message)}}aZe(Qa,qa){var {RtcUtils:Wa}=d(195);Qa=qa.presence;let Hb;const jc=qa.FMa;this.xN.qH(1,0);try{Hb=Wa.xYd(Qa,this.CWb)}catch($b){this.xN.qH(1,
3);h.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",$b.message);jc.setException($b);return}Wa=new n.a;Wa.$(this._clientId,Object.assign(new L,{Presence:Qa,TimeStamp:(new Date).getTime()}));this.Fl.$kh(qa.type,Wa);if(2!==this.Oya)this.Rt.Ljb(),this.xN.qH(1,2),jc.Og(null);else{var gc=this.pBa.toString();++this.pBa;Qa=new Z(()=>this.Fhl(qa.type,Hb,gc),gc);Qa=this.CIh(0,qa.type).add(Qa);Qa.ejd($b=>{2===$b&&this.xN.qH(1,6);jc.Og(null)});
Qa.djd(()=>{})}}Fhl(Qa,qa,Wa){let Hb=null;const jc=new I,gc=new fa.a;h.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.hs);if(2!==this.Oya)return this.Rt.Ljb(),this.xN.qH(1,2),h.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.hs),gc.fIe(),gc;this.ii&&20>this.nof&&(Hb=this.ii.Ii("WebServiceCall","Send Presence Message"),this.nof++);jc.start();gc.clc(1);try{this.Yz.updatePersistentState(Qa,qa).done(()=>{this.Rt.aUe();this.xN.qH(1,
1);h.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Wa,this.hs);gc.LZa(1);jc&&(jc.stop(),jc.dr>this.Yc.Jsh?this.xN.qH(1,4):this.xN.qH(1,5))}).fail($b=>{const {RtcUtils:wb}=d(195);this.V9a||(this.Rt.Ljb(),this.xN.qH(1,3),h.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Wa,wb.FIb($b),this.hs));gc.LZa(2)}).always(()=>{Hb&&Hb.stop()})}catch($b){h.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
$b.message),this.xN.qH(1,3),gc.LZa(2)}return gc}qnb(Qa,qa){({RtcUtils:Qa}=d(195));const Wa=qa.FBi,Hb=qa.FMa;let jc;try{jc=Qa.xYd(Wa,this.CWb)}catch(gc){h.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",gc.message);Hb.setException(gc);return}try{this.Yz.qnb(jc).done(()=>{h.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(gc=>{const {RtcUtils:$b}=d(195);this.V9a||h.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",
$b.FIb(gc));Hb.Og(null)})}catch(gc){h.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",gc.message),Hb.Og(null)}}Xaa(Qa,qa){({RtcUtils:Qa}=d(195));const Wa=qa.type,Hb=qa.jAa,jc=qa.ISi,gc=qa.FMa;let $b;this.xN.qH(0,0);try{$b=Qa.xYd(Hb,this.CWb)}catch(Db){this.xN.qH(0,3);h.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Db.message);gc.setException(Db);return}if(2!==this.Oya)jc?this.WLd.$(Wa,
Hb):(this.Rt.Ljb(),this.xN.qH(0,2)),gc.Og(null);else{var wb=this.pBa.toString();++this.pBa;qa=new Z(()=>this.bil(Wa,$b,wb),wb);qa=this.CIh(1,Wa).add(qa);qa.ejd(Db=>{2===Db&&this.xN.qH(0,6);gc.Og(null)});qa.djd(()=>{})}}bil(Qa,qa,Wa){let Hb=null;const jc=new I,gc=new fa.a;h.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.hs);if(2!==this.Oya)return this.Rt.Ljb(),this.xN.qH(0,2),h.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",
this.hs),gc.fIe(),gc;this.ii&&3===Qa&&20>this.oof&&(Hb=this.ii.Ii("WebServiceCall","Send WetContent Update"),this.oof++);jc.start();gc.clc(1);this.Yz.Xaa(Qa,qa).done(()=>{this.Rt.aUe();this.xN.qH(0,1);h.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Wa,this.hs);gc.LZa(1);jc&&(jc.stop(),jc.dr>this.Yc.Jsh?this.xN.qH(0,4):this.xN.qH(0,5))}).fail($b=>{const {RtcUtils:wb}=d(195);this.V9a||(this.Rt.Ljb(),this.xN.qH(0,3),h.ULS.sendTraceTag(3249507,500,
15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Wa,wb.FIb($b),this.hs));gc.LZa(2)}).always(()=>{Hb&&Hb.stop()});return gc}iAa(){this.Yz.nMl(Object(e.a)(this,this.Smc,"onPresenceUpdated"));this.Yz.mMl(Object(e.a)(this,this.wjd,"onPersistentStateUpdated"));this.Yz.lMl(Object(e.a)(this,this.HMe,"onPersistentStateCleared"));this.Yz.sMl(Object(e.a)(this,this.onc,"onUpdateNotificationReceived"))}oEk(Qa,qa){this.Smc(qa.iRb,qa.eUf)}Smc(Qa){this.Rt.zqc();this.wjd(0,Qa)}nEk(Qa,
qa){this.wjd(qa.type,qa.iRb)}SFk(Qa,qa){const Wa={};for(let Hb in qa)Wa[Hb]=qa[Hb].Presence;this.cah(Qa,Wa,qa)}wjd(Qa,qa){this.Rt.zqc();this.cah(Qa,qa)}cah(Qa,qa,Wa=null){var {RtcUtils:Hb}=d(195);if(h.ULS.pza(500,100))for(var jc in qa);delete qa[this._clientId];if(!da.a.isEmpty(qa)){for(var gc in qa)jc=gc,qa[jc]=Hb.deserialize(qa[gc],"Presence",jc,!1,this.CWb);Hb=new n.a;gc=(new Date).getTime();for(let $b in qa){jc=qa[$b];let wb=$b,Db;Wa?(Db=Wa[wb],Db.Presence=jc):Db=Object.assign(new L,{Presence:jc,
TimeStamp:gc});Hb.$(wb,Db)}this.Fl.$kh(Qa,Hb);switch(Qa){case 0:this.Hmf||(h.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.hs),this.Hmf=!0,z.AFrameworkApplication.Rg&&z.AFrameworkApplication.Rg.Xtk());this.Fl.skh(qa,[]);break;default:this.Fl.LYk(Qa,qa)}}}mEk(Qa,qa){this.HMe(qa.lZd)}HMe(Qa){this.Rt.zqc();if(h.ULS.pza(500,100))for(let qa=0;qa<Qa.length;++qa);Qa.length&&(this.Fl.a_k(Qa),this.Fl.KYk(Qa),this.Fl.skh({},Qa))}pEk(Qa,qa){this.onc(qa.type,qa.jAa)}onc(Qa,
qa=null){this.Yc.Hsl&&0===Qa&&h.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===Qa&&this.zLd&&0<this.zLd.length){var Wa=Object.assign(new Ma.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.zLd,vetoPillar:"RealTimeCoauth"});(Wa=ca.a.getInstance(Wa))&&Wa.logKpiUsage(this.q1h)}this.Yc.Isl&&13===Qa&&h.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
qa||"<none>"));this.Rt.zqc();5===Qa?(qa=(Qa=this.NMk(qa))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",Qa.reason,Qa.reconnectDelay):"Received client reconnection request from the server without params.",h.ULS.sendTraceTag(18637071,500,50,qa),this.Fl.bod(Qa)):(qa=d(195).RtcUtils.deserialize(qa,String.format("UpdateNotification-{0}",ka[Qa]),null,!1,this.CWb),this.Fl.$Zk(Qa,qa))}NMk(Qa){try{if(!Qa||""===Qa)return null;const qa=JSON.parse(Qa);return new aa(qa[sa.a.DXe],
qa[sa.a.odl],qa[sa.a.sdl],qa[sa.a.RYe])}catch(qa){return h.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",qa.message),null}}CIh(Qa,qa){return this.oZb.gvj(this.hvj(Qa,qa))}hvj(Qa,qa){return Qa+","+qa}static Adj(){var Qa=new Map;Qa.set("SkipAria","True");Qa=Object.assign(new Ea.a,{extendedProperties:Qa});return Object.assign(new ma.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:Qa,blockFutureEmissionDurationInMs:3E5})}}Object(K.a)(va,"RtcMessageHandler",
T,[]);class Ca{zPf(Qa,qa=""){const {MaxOutstandingThrottler:Wa}=d(1015);return Wa.createInstance(Qa,qa)}qMi(Qa,qa=""){const {MaxRateThrottler:Wa}=d(1017);return Wa.createInstance(Qa,qa)}}Object(K.a)(Ca,"ThrottlerFactory",null,[1181]);var oa=d(77),Da=d(712);class ta{constructor(Qa){this.Yc=null;this.SP=!1;this.Ma=new oa.a;this.PJd=new n.a;this.NJd=new n.a;this.eQd=Qa;this.Dpb=this.eQd.zPf(qa=>qa.send(),"GlobalMaxOustandingThrottler");this.Dpb.rJc(()=>{this.Ma.raiseEvent("TMUDM")})}init(Qa){this.SP||
(this.Yc=Qa,this.Dpb.init(this.Yc.QMa,this.Yc.ayj),this.SP=!0)}gvj(Qa){var {MaxRateThrottler:qa}=d(1017),{MaxOutstandingThrottler:Wa}=d(1015);this.SP||this.init(new Da.a(qa.ERf,Wa.VRf,Wa.KRf,ta.dvk));({value:qa}=this.PJd.wg(Qa)).returnValue||(({value:qa}=this.NJd.wg(Qa)).returnValue||(qa="MaxOutstandingThrottler-"+Qa,qa=this.eQd.zPf(Object(e.a)(this.Dpb,this.Dpb.add,"add"),qa),qa.init(this.Yc.QMa,this.Yc.cvk),qa.rJc(()=>{this.Ma.raiseEvent("TMUDM")}),this.NJd.add(Qa,qa)),Wa="MaxRateThrottler-"+Qa,
qa=this.eQd.qMi(Object(e.a)(qa,qa.add,"add"),Wa),qa.init(this.Yc.Yvk),this.PJd.add(Qa,qa));return qa}reset(){for(let Qa of this.PJd)Qa.value.cUe();for(let Qa of this.NJd)Qa.value.cUe(),Qa.value.reset();this.Dpb.cUe();this.Dpb.reset()}rJc(Qa){this.Ma.addHandler("TMUDM",Qa)}}ta.dvk=1E3;Object(K.a)(ta,"ThrottlerManager",null,[1180]);var ha=d(1178);const Ha=(Qa,qa,Wa,Hb,jc,gc,$b,wb,Db=null,Xb=null,ab=null,Ab=null)=>{const rc=R.createInstance(z.AFrameworkApplication.fa),tb=z.AFrameworkApplication.buildVersion?
z.AFrameworkApplication.buildVersion:"1.0",Za=bb(Qa,qa,$b,tb),fb=rc.GBi?d(1176).RealtimeChannelMetrics.createInstance(Za):new J;var ac=d(308).FrequentLoggingMetrics.create(jc);rc.vdl&&ac.OAl(rc.udl);var Dc="";Dc=Db&&""!==Db?Db:"/rtc2/";ac.s0f=x.a.wB(Dc);const Sc=Dc+"signalr";Db=Dc+"findsession";const xb=M.HJj;Dc=new Ca;ab=ab||C.a.getInstance();h.ULS.shipAssertTag(556867617,500,rc.Msh<=d(346).RealtimeChannel.m3g,"Client attempting to override max payload size beyond absolute limit");const Ta=Math.min(rc.Msh,
d(346).RealtimeChannel.m3g);ac.l3g=Ta;ac=new va(rc,new ta(Dc),Qa,Za,ib=>new N(ib.createHubProxy(xb)),wb,ab,fb,ac,Ta);Xb||(Xb=d(717).FindSessionStrategy.createInstance(qa,jc,Db,wb,tb,$b,Qa,Za,ab,gc,Hb,Ab));Xb.h6b=rc.h6b;qa=new w(Za);Wa=Wa?Wa.split(","):null;Qa=new (d(346).RealtimeChannel)(Qa,Wa,Za,wb,()=>$.hubConnection(Sc),Xb,ac,qa,ab,fb,rc,jc);Qa.init();return Qa},bb=(Qa,qa,Wa)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",Qa,Na(ha.a[Wa]),Na("browser"),qa),Na=Qa=>Qa?Qa.charAt(0).toLocaleUpperCase()+
Qa.substring(1,Qa.length):Qa;d.d(U,"RealtimeChannel",function(){return Ia});class Ia{constructor(Qa,qa,Wa,Hb,jc,gc,$b,wb,Db,Xb,ab,Ab){this.ePd=!1;this.AZ=null;this.IS=new n.a;this.XSb=1;this.C2=null;this.LK=!1;this.JId=(new Date(0)).getTime();this.ptf=0;this._clientId=Qa;this.xHc=qa;this.BZ=0;this.ii=Hb;this.ICd=wb;this.r6h=$b;this.oTh=Db;this.$Vh=jc;this.KNa=gc;this.hs=Wa;this.Rt=Xb;this.Yc=ab;this.hi=Ab;this.J7h=1>100*Math.random()}get Rna(){return this.KNa.Rna}set Rna(Qa){this.KNa.Rna=Qa}get S0a(){return this.r6h}get Fl(){return this.oTh}init(){this.Fl.Lhi(Object(e.a)(this,
this.fQc,"disconnectAndCreateNewConnection"));this.Fl.Rii(Object(e.a)(this,this.SIk,"onUpdatePersistentStateRequestReceivedInternal"));this.Fl.Qii(Object(e.a)(this,this.RIk,"onUpdatePersistentStateClearedRequestReceived"));this.hi.JIc(this.Rt);z.AFrameworkApplication.Wga(()=>{const {FrequentLoggingMetrics:Qa}=d(308);this.Rt.dUe();Qa.instance&&Qa.instance.wse()});this.GPf();this.HUi();this.Fl.Nzf(Object(e.a)(this,this.DNl,"updateConnectionQueryString"))}HUi(){try{const Wa=$.signalR;if(!Wa)throw Error.invalidOperation("Failed to retrieve Signalr object");
const Hb=Wa.version;if(!Hb)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===Hb){var Qa=Wa.transports;if(!Qa)throw Error.invalidOperation("Failed to retrieve transports object");var qa=Qa.longPolling;if(!qa)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!qa.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");qa.supportsKeepAlive=this.zOi()}}catch(Wa){h.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Wa.message)}}zOi(){return()=>!1}GPf(){const Qa=++this.XSb;this.JId=(new Date(0)).getTime();this.C2=this.$Vh();this.Fl.VYk(this.C2);this.C2.stateChanged(qa=>{this.VBk(qa,Qa)});this.C2.connectionSlow(Object(e.a)(this,this.eIk,"onSlowConnection"));this.C2.error(Object(e.a)(this,this.QHk,"onSignalRError"));this.C2.log=Object(e.a)(this,this.RHk,"onSignalRLog")}uRb(Qa,qa){return Qa!==this.XSb?(h.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
qa),!1):!0}connect(){2!==this.BZ&&1!==this.BZ&&(h.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.hs),this.ICd.RBk(),B.a.instance.PAl(),this.goa(1,this.BZ),this.HEh())}HEh(){const Qa=this.XSb;this.ePd=!1;this.Rt.pod();this.KNa.yce(Object(e.a)(this,this.tGi,"connectSignalrConnection"),Object(e.a)(this,this.m9g,"onFailureToConnect"),Object(e.a)(this.S0a,this.S0a.hNj,"initThrottlerManager"),Object(e.a)(this,this.uRb,"verifyConnectionToken"),Qa)}m9g(Qa=null){this.Rt.qod();
let qa=null;!Qa||"documentsessiondeleted"!==(qa=Qa.toLowerCase())&&"documentsessionexpired"!==qa?this.fQc():(h.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.hs,Qa),this.disconnect())}fQc(Qa,qa=null){h.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.AZ);Qa=(Qa=2===this.BZ||1===this.BZ)&&!this.S0a.V9a;let Wa=!0,Hb=0;qa&&Object.getType(qa)!==Object.getType(Sys.EventArgs.Empty)&&
qa.jWe&&""!==qa.jWe&&(Qa=!0,this.KNa.B_e(qa.jWe),Wa=qa.RYe,Hb=qa.reconnectDelay);Qa&&this.goa(1,this.BZ);++this.XSb;this.S0a.iAa();this.CBl(Wa);this.KNa.X3d();this.GPf();Qa&&window.setTimeout(Object(e.a)(this,this.HEh,"startConnecting"),Math.min(Hb,3E4))}DNl(){let Qa=null;const qa=({correlationId:Qa}=this.KNa.rVc()).returnValue;this.C2.qs=qa;h.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.hs,Qa)}tGi(Qa){const {FrequentLoggingMetrics:qa}=
d(308);this.JId=(new Date).getTime();let Wa=null;this.C2.qs=({correlationId:Wa}=this.KNa.rVc()).returnValue;this.Yc.xki&&(this.C2.url=Qa,qa.instance&&(qa.instance.IMf=x.a.wB(Qa)));let Hb=null;this.ii&&(Hb=this.ii.Ii("WebServiceCall","ConnectToServer"));h.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.hs);Qa={};this.xHc&&(Qa.transport=1===this.xHc.length?this.xHc[0]:this.xHc);Qa.pingInterval=null;B.a.instance.yqc(1,0);Qa.waitForPageLoad=!1;this.C2.start(Qa,null).done(jc=>
{this.Rt.UTe();B.a.instance.yqc(1,1,!0);h.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",jc.id,Wa)}).fail(jc=>{h.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.KNa.rB,Wa,this.hs);this.m9g();this.Rt.Elh(jc);B.a.instance.yqc(1,1,!1);this.Fl.Akh(0,{["CorrelationId"]:Wa,["ErrorDetails"]:jc,["ConnectionState"]:m.a[this.BZ]})}).always(()=>{const {FrequentLoggingMetrics:jc}=
d(308);Hb&&Hb.stop();jc.instance&&(jc.instance.yEd=!1)})}disconnect(){const {FrequentLoggingMetrics:Qa}=d(308);0===this.BZ?h.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.hs):(this.Rt.Jlh(),Qa.instance&&(Qa.instance.yEd=!0),h.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.hs),this.S0a.V9a=!0,this.ICd.ACk(),this.goa(0,this.BZ),this.fQc(),this.S0a.V9a=!1)}CBl(Qa){const qa=this.kwi(),Wa=this.C2,Hb=this.AZ,
jc=()=>{if(this.ePd)h.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.ePd=!0,Wa.stop(!0,Qa)}catch(gc){h.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",gc.message)}};0<qa?(h.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",Hb,qa),window.setTimeout(jc,qa)):(h.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",Hb),jc())}kwi(){let Qa=0;0===this.C2.state&&(Qa=this.JId+Ia.jUl-
(new Date).getTime(),0>Qa&&(Qa=0));return Qa}get connectionState(){return this.BZ}v7a(Qa){this.Fl.v7a(Qa)}bZe(Qa){return this.aZe(0,Qa)}aZe(Qa,qa){const Wa=new r.a;this.Fl.Dkh(Qa,qa,Wa);return Wa.task}mJc(Qa){this.Fl.mJc(Qa)}pua(Qa){return this.pwj(Qa)}ZTc(){return this.caj()}caj(){const Qa={};for(let qa of this.IS)qa.value.Fb(0)&&(Qa[qa.key]=qa.value.ga(0).data);return Qa}pwj(Qa){return this.IS.Fb(Qa)&&this.IS.ga(Qa).Fb(0)?this.IS.ga(Qa).ga(0).data:null}SIk(Qa,qa){for(let Wa of qa.nRl)this.IS.Fb(Wa.key)||
this.IS.$(Wa.key,new S.a),Qa=Wa.value,this.IS.ga(Wa.key).$(qa.type,new D(Qa.Presence,new Date(Qa.TimeStamp))),Wa.key===this._clientId&&0===qa.type&&this.Fl.tYk(Qa.Presence)}RIk(Qa,qa){for(const Wa of qa.lZd)this.IS.remove(Wa)}baj(){const Qa=new S.a;if(!this.IS.Fb(this._clientId))return Qa;for(let qa of this.IS.ga(this._clientId))Qa.$(qa.key,qa.value.data);return Qa}Xaa(Qa,qa=null,Wa=!1){const Hb=new r.a;this.Fl.wTe(Qa,qa,Wa,Hb);return Hb.task}ECa(Qa){this.Fl.ECa(Qa)}Tlj(){return this.i4(this._clientId)}i4(Qa){let qa,
Wa;return({value:qa}=this.IS.wg(Qa)).returnValue&&({value:Wa}=qa.wg(0)).returnValue?new v(this.twj(Wa),Wa.timeStamp):null}kaj(){const Qa={};for(let qa of this.IS)qa.value.wg(0).returnValue&&(Qa[qa.key]=this.i4(qa.key));return Qa}qnb(Qa){const qa=new r.a;this.Fl.ZZk(Qa,qa);return qa.task}get clientId(){return this._clientId}get Rxl(){return this.J7h}dispose(){const {FrequentLoggingMetrics:Qa}=d(308);this.LK||(this.S0a.iAa(),this.hi.Rod(this.Rt),this.Rt.dUe(),Qa.instance&&Qa.instance.wse(),this.LK=
!0)}VBk(Qa,qa){this.uRb(qa,"StateChangedSignalR")&&this.goa(this.FNf(Qa.newState),this.FNf(Qa.oldState))}goa(Qa,qa){var {FrequentLoggingMetrics:Wa}=d(308),{ClientToClientMessageTelemetry:Hb}=d(1066);if((1!==this.BZ||0!==qa||1!==Qa)&&this.BZ!==qa){const jc=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.BZ,qa,Qa]));h.ULS.sendTraceTag(3290053,500,10,jc)}if(this.BZ!==Qa){switch(Qa){case 2:Wa.instance&&
Wa.instance.auk();this.AZ=this.C2.id;h.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.AZ,this.hs);this.odk(this.C2);h.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Wa=null;this.ii&&(Wa=this.ii.Ii("WebServiceCall","Receive First Presence"));Hb=this.XSb;this.Fl.UYk(Object(e.a)(this,this.uRb,"verifyConnectionToken"),Hb,this.ICd,Object(e.a)(this,this.SYd,"clearExistingPersistentState"),this.baj(),Wa);this.Yc.pdl&&(Wa=100*Math.random()<=this.Yc.qdl,
d(1066).ClientToClientMessageTelemetry.Smj(this.Fl,this.Yc,Wa).start());break;case 1:2===qa&&h.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.AZ);break;case 0:if(Hb.instance&&Hb.instance.stop(),this.S0a.V9a)h.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.AZ);else{1===qa&&(h.ULS.sendTraceTag(7672737,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",
this.AZ),this.Rt.xqc());2===qa&&h.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.AZ);this.fQc();return}}this.BZ=Qa;this.Fl.DXk(Qa,qa)}}odk(Qa){if(Qa&&Qa.transport&&Qa.transport.name){Qa=Qa.transport.name;var qa=Qa.toLowerCase();"websockets"===qa?h.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",Qa,this.hs):"serversentevents"===qa?h.ULS.sendTraceTag(4290752,
500,50,"Transport name - {0} for [{1}]",Qa,this.hs):"foreverframe"===qa?h.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",Qa,this.hs):"longpolling"===qa?h.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",Qa,this.hs):"mocktransport"!==qa&&h.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",Qa)}else h.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}eIk(){if(this.Yc.Lsh){const Qa=x.a.JT(this.Rna,"mid");h.ULS.sendTraceTag(3249544,
500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.AZ,Qa)}else h.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.AZ)}QHk(){h.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.AZ)}RHk(Qa){Qa=d(195).RtcUtils.FIb(Qa);if(this.Yc.Lsh&&Qa.startsWith("Keep alive timed out.")){const qa=x.a.JT(this.Rna,"mid");h.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",Qa,qa)}else this.Rxl&&2E3>this.ptf&&
!Qa.startsWith("Invok")&&!Qa.startsWith("Trigger")&&(h.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",Qa),this.ptf++)}SYd(){let Qa;const qa=[];({value:Qa}=this.IS.wg(this._clientId)).returnValue&&this.IS.remove(this._clientId);for(let Wa of this.IS.keys)Array.add(qa,Wa);for(const Wa of qa)this.IS.remove(Wa);Qa&&this.IS.$(this._clientId,Qa);this.Fl.iYk(qa)}FNf(Qa){switch(Qa){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",Qa,"Unknown SignalR state");
}}twj(Qa){return Qa&&Qa.timeStamp?(new Date).getTime()-Qa.timeStamp.getTime()>(this.Yc.XVd?6E4:this.Yc.awayCoauthorThresholdMs)?2:1:1}static createInstance(Qa,qa,Wa,Hb,jc,gc,$b,wb=null,Db=null,Xb=null,ab=null,Ab=null,rc=null){return Ha(Qa,qa,Wa,rc,Hb,jc,gc,$b,wb,Db,Xb,Ab,ab)}}Ia.m3g=31E3;Ia.pIe=8E3;Ia.jUl=15E3;Object(K.a)(Ia,"RealtimeChannel",null,[1099,1098])},711:function(K,U,d){d.d(U,"a",function(){return h});K=d(0);class h{constructor(){this.Ttf=!1;this.qMd=null;this.Hdf=0;this.LEd=this.zQf();
this.pzc=this.zQf();this.T3a=this.Apb=0;this.RF=()=>new Date}get rCl(){return this.Ttf}zQf(){const e=Array(6);for(let r=0;r<e.length;r++)e[r]=0;return e}ihj(){return this.LEd.toString()}ndj(){return this.pzc.toString()}PAl(){this.qMd=this.RF()}yqc(e,r,m=!1){this.rCl||(m&&(this.Ttf=!0),m=this.RF(),0===e&&5<this.Apb||1===e&&5<this.T3a||(this.Hdf<e?(1===this.Apb%2&&(this.LEd[this.Apb]=-1,this.Apb++),this.Hdf=e,1===r&&(this.pzc[this.T3a]=-1,this.T3a++),this.pzc[this.T3a]=this.T3e(m),this.T3a++):0===e?
(this.LEd[this.Apb]=this.T3e(m),this.Apb++):(this.pzc[this.T3a]=this.T3e(m),this.T3a++)))}T3e(e){const r=e.getTime()-this.qMd.getTime();this.qMd=e;return r}static get instance(){h.La||(h.La=new h);return h.La}static set instance(e){h.La=e}}h.La=null;Object(K.a)(h,"LatencyMetrics",null,[])},712:function(K,U,d){d.d(U,"a",function(){return h});K=d(0);class h{constructor(e,r,m,n){this.Yvk=e;this.QMa=r;this.cvk=m;this.ayj=n}}Object(K.a)(h,"ThrottlerManagerSettings",null,[])},715:function(K,U,d){K=d(0);
class h extends Sys.EventArgs{constructor(S,T){super();this.newState=S;this.oldState=T}}Object(K.a)(h,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(S,T){super();this.FBi=S;this.FMa=T}}Object(K.a)(e,"ClientInfoEventArgs",Sys.EventArgs,[]);class r extends Sys.EventArgs{constructor(S){super();this.presence=S}}Object(K.a)(r,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);class m extends Sys.EventArgs{constructor(S){super();this.lZd=S}}Object(K.a)(m,"PersistentStateClearedEventArgs",
Sys.EventArgs,[]);class n extends Sys.EventArgs{constructor(S,T){super();this.type=S;this.iRb=T}}Object(K.a)(n,"PersistentStateUpdateEventArgs",Sys.EventArgs,[]);var z=d(1177);class v extends Sys.EventArgs{constructor(S,T=null){super();this.VG=S;this.$9h=T}get type(){return this.VG}get jAa(){return this.$9h}}Object(K.a)(v,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class x extends Sys.EventArgs{constructor(S){super();this.USk=S}}Object(K.a)(x,"GotCompletePersistentStateWithMetadataEventArgs",
Sys.EventArgs,[]);class B extends Sys.EventArgs{constructor(S,T,ca,L,da,Z){super();this.uRb=S;this.m_d=T;this.uGi=ca;this.UYf=da;this.SYd=L;this.Vy=Z}}Object(K.a)(B,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class D extends Sys.EventArgs{constructor(S){super();this.hubConnection=S}}Object(K.a)(D,"RefreshProxyEventArgs",Sys.EventArgs,[]);class w extends Sys.EventArgs{constructor(S,T){super();this.T2i=S;this.errorMessage=T}}Object(K.a)(w,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class J extends Sys.EventArgs{constructor(S,
T,ca){super();this.type=S;this.presence=T;this.FMa=ca}}Object(K.a)(J,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var G=d(1018);class M extends Sys.EventArgs{constructor(){super()}}Object(K.a)(M,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class N extends Sys.EventArgs{constructor(S){super();this.lZd=S}}Object(K.a)(N,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class R extends Sys.EventArgs{constructor(S,T){super();this.type=S;this.nRl=T}}Object(K.a)(R,"UpdatePersistentStateRequestEventArgs",
Sys.EventArgs,[]);var C=d(77);d.d(U,"a",function(){return O});class O{constructor(){this.Ma=new C.a}DXk(S,T){this.Ma.raiseEvent("CSC",new h(S,T))}VYk(S){this.Ma.raiseEvent("RP",new D(S))}bod(S){this.Ma.raiseEvent("RC",S)}ZYk(){this.Ma.raiseEvent("RMID")}UYk(S,T,ca,L,da,Z){this.Ma.raiseEvent("RPS",new B(S,T,ca,L,da,Z))}$kh(S,T){this.Ma.raiseEvent("UPSR",new R(S,T))}skh(S,T){this.Ma.raiseEvent("PU",new z.a(S,T))}tYk(S){this.Ma.raiseEvent("MPU",new r(S))}wTe(S,T,ca,L){this.Ma.raiseEvent("SUN",new G.a(S,
T,ca,L))}$Zk(S,T){this.Ma.raiseEvent("UNR",new v(S,T))}Dkh(S,T,ca){this.Ma.raiseEvent("SP",new J(S,T,ca))}LYk(S,T){this.Ma.raiseEvent("PSU",new n(S,T))}KYk(S){this.Ma.raiseEvent("PSC",new m(S))}iYk(S){this.Ma.raiseEvent("IPSC",new m(S))}a_k(S){this.Ma.raiseEvent("UPSC",new N(S))}hZk(S,T){this.Ma.raiseEvent("SPC",new M(S,T))}Akh(S,T){this.Ma.raiseEvent("RCF",new w(S,T))}$Xk(S){this.Ma.raiseEvent("CPSWM",new x(S))}ZZk(S,T){this.Ma.raiseEvent("UCI",new e(S,T))}v7a(S){this.Ma.addHandler("CSC",S)}Mhi(S){this.Ma.addHandler("RP",
S)}Lhi(S){this.Ma.addHandler("RC",S)}Rhi(S){this.Ma.addHandler("RMID",S)}Khi(S){this.Ma.addHandler("RPS",S)}Rii(S){this.Ma.addHandler("UPSR",S)}mJc(S){this.Ma.addHandler("PU",S)}Hfi(S){this.Ma.addHandler("IPU",S)}Pii(S){this.Ma.addHandler("UCI",S)}Yhi(S){this.Ma.addHandler("SUN",S)}Ifi(S){this.Ma.addHandler("IUNR",S)}ECa(S){this.Ma.addHandler("UNR",S)}Gfi(S){this.Ma.addHandler("IPSU",S)}Ffi(S){this.Ma.addHandler("IPSC",S)}Qii(S){this.Ma.addHandler("UPSC",S)}Xhi(S){this.Ma.addHandler("SP",S)}Nzf(S){this.Ma.addHandler("SPC",
S)}Vhi(S){this.Ma.addHandler("RCF",S)}Afi(S){this.Ma.addHandler("CPSWM",S)}v7k(S){this.Ma.removeHandler("CPSWM",S)}static getInstance(){return O.La||(O.La=new O)}}O.La=null;Object(K.a)(O,"RtcEventHub",null,[1151])},717:function(K,U,d){d.r(U);K=d(0);var h=d(392),e=d(7),r=d(18),m=d(1014),n=d(1020),z=d(27),v=d(81),x=d(65),B=d(456),D=d(505),w=d(105),J=d(47),G=d(106),M=d(1021);class N{}N.clientId="ClientId";N.RRl="UserApp";N.userSessionId="usid";N.userType="UserType";N.fSl="UserVersion";N.cqc="qs";N.IBi=
"clientProtocol";N.ayk="NoAuth";Object(K.a)(N,"RtcFindSessionInputQueryParamConstants",null,[]);class R{constructor(aa,ja,I,sa,ka,Ma){this.X5a=null;const {FindSessionStrategy:Ea}=d(717);this.n5h=aa;aa=String.format("{0}={1}",N.clientId,J.a.Qe(sa));aa=String.format("{0}&{1}={2}",aa,N.userSessionId,J.a.Qe(ka));aa=String.format("{0}&{1}={2}",aa,N.RRl,J.a.Qe(I.toString()));aa=String.format("{0}&{1}={2}",aa,N.userType,J.a.Qe("1"));aa=String.format("{0}&{1}={2}",aa,N.fSl,J.a.Qe(ja));aa=String.format("{0}&{1}={2}",
aa,N.IBi,J.a.Qe(Ea.HBi));(ja=R.Maj(I,Ma))&&(aa=String.format("{0}&{1}",aa,ja));this.bWh=aa}rmh(){this.X5a=this.n5h()}g9i(){this.X5a&&""!==this.X5a||(this.rmh(),h.ULS.sendTraceTag(575784194,500,this.X5a&&""!==this.X5a?50:15,"Query signature delegate called for refresh returned: {0} ",this.X5a));const aa=String.format("{0}={1}",N.cqc,J.a.Qe(this.X5a));return String.format("{0}&{1}",aa,this.bWh)}static Maj(aa,ja){return 4===aa?String.format("{0}={1}",N.ayk,"1"):ja?ja.xwj():null}}Object(K.a)(R,"FindSessionQueryStringGenerator",
null,[]);var C=d(308),O=d(711),S=d(195),T=d(712);class ca{}ca.k5i="FSType";Object(K.a)(ca,"RtcFindSessionRequestHeaders",null,[]);class L{}L.V_k="polling";Object(K.a)(L,"RtcFindSessionTypes",null,[]);var da=d(1019);class Z{}Z.cTl="RTC-TokenProofkey";Z.g6j="RTC-IsWacJsBootFsRequest";Object(K.a)(Z,"RtcRequestHeaders",null,[]);d.d(U,"FindSessionStrategy",function(){return fa});class fa{constructor(aa,ja,I,sa,ka,Ma,Ea,ma,va,Ca,oa,Da,ta=null){this.Dlf=(new Date(0)).getTime();this.Smf=0;this.tDc=!1;this.Ksf=
null;this.mUe=36E5;this.Rob=fa.Gjg;this.aUb=0;this.skb=null;this.Oya=0;this.HMb=this.JMf=null;this.U5h=[n.a.sBb,n.a.errorMessage,n.a.I2e,n.a.rB,n.a.o6,n.a.zee,n.a.Bhb,n.a.QMa,n.a.Dhb];this.T5h=[n.a.sBb,n.a.errorMessage];this.rB=this.Rna=null;this.ugf=new R(oa?oa:()=>z.AFrameworkApplication.gh,ka,Ma,Ea,aa,ja);this.FSb=Da;this.ii=sa;this.hi=ja;this.BYh=I;this.hs=ma;this.Fl=va;this.lUb=ta;this.vgf=!1;this.h6b=9E4;Ca&&Ca.execute(ha=>{ha.jJc(()=>{h.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",
this.hs);this.ugf.rmh()})});2>=100*Math.random()&&(this.mUe=3E5);C.FrequentLoggingMetrics.instance&&(C.FrequentLoggingMetrics.instance.N2f=this.mUe)}B_e(aa){this.HMb=aa}init(){this.Fl.Rhi(Object(e.a)(this,this.Ral,"resetGetMachineIdDelay"));this.Fl.v7a(Object(e.a)(this,this.goa,"onConnectionStateChanged"))}goa(aa,ja){this.Oya=ja.newState;2===ja.newState&&(this.aUb=0)}rVc(){let aa;aa=this.skb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.skb.o6,fa.g0d,J.a.Qe(aa)),correlationId:aa}}yce(aa,
ja,I,sa,ka){this.mhl(()=>{sa(ka,"GetMachineIdSuccess")&&(h.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.rB,this.hs),aa(this.Ksf),I(this.ivj()))},Ma=>{sa(ka,"GetMachineIdFailure")&&(h.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.hs),ja(Ma))},sa,ka)}X3d(){this.vKf();this.JLj()}mhl(aa,ja,I,sa){h.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",
this.rB);this.rB?aa():window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(aa,ja,I,sa)},this.Rvi())}sendFindSessionRequestToServerInternal(aa,ja,I,sa){I(sa,"RequestMachineId")&&(this.Dlf=(new Date).getTime(),I=x.a.vj(),this.V6f(ka=>{const Ma=x.a.vj();this.Rkd(ka);this.j_e();aa();ka=x.a.vj()-Ma;h.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ka)},ka=>{const Ma=x.a.vj();this.vKf();C.FrequentLoggingMetrics.instance&&C.FrequentLoggingMetrics.instance.qH(2,3);ja(ka);
ka=x.a.vj()-Ma;h.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ka)},!1),I=x.a.vj()-I,h.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",I))}JLj(){this.Rob+=fa.Skj;this.Rob=Math.min(this.Rob,fa.Xuk)}Rvi(){let aa=this.Dlf+this.Rob-(new Date).getTime();0>aa&&(aa=0);return aa}Rkd(aa){try{this.skb=aa,this.Rna=aa.rMf,this.rB=aa.rB,this.JMf=aa.o6,this.Ksf=aa.D2b}catch(ja){h.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
ja.toString())}}vKf(){this.rB=null;this.wKf()}j_e(){this.wKf();this.tDc=!0;this.Smf=window.setTimeout(Object(e.a)(this,this.c2k,"refreshMachineId"),this.mUe)}wKf(){this.tDc&&(window.clearTimeout(this.Smf),this.tDc=!1)}c2k(){this.tDc=!1;this.V6f(aa=>{const ja=this.JMf!==aa.o6,I=this.rB!==aa.rB,sa=this.rB;this.Rkd(aa);0!==this.Oya&&(I?(h.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",sa||"null",aa.rB),this.Fl.bod()):(this.Fl.hZk(ja,I),this.j_e()))},
()=>{C.FrequentLoggingMetrics.instance&&C.FrequentLoggingMetrics.instance.qH(2,3);this.j_e()},!0)}Ral(){this.Rob=fa.Gjg}ivj(){return new T.a(this.skb.agd,this.skb.Yfd,this.skb.Xfd,this.skb.VXc)}bIl(aa){if(Object.getType(aa)!==Object)return null;for(let ja in aa);return this.aLi(aa)}aLi(aa){if(!(n.a.sBb in aa))return null;const ja=aa[n.a.sBb];var I=ja?this.U5h:this.T5h;for(const sa of I)if(!(sa in aa))return null;I=Object.assign(new M.a,{$bc:aa[n.a.sBb],errorMessage:aa[n.a.errorMessage],correlationId:G.a.create().toString()});
ja&&(I.D2b=aa[n.a.I2e],I.o6=aa[n.a.o6],I.rB=aa[n.a.rB],I.VXc=aa[n.a.zee],I.Xfd=aa[n.a.Bhb],I.Yfd=aa[n.a.QMa],I.agd=aa[n.a.Dhb]);return I}jhj(aa,ja){h.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.lUb.i5i.continueWith(()=>{this.lUb.i5i.result?(h.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),aa(this.lUb.j5i)):(h.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ja(this.lUb.j5i))})}Rqh(aa,
ja,I,sa,ka=!1){return Ma=>{O.a.instance.yqc(0,1);aa&&aa.stop();this.FSb=this.HMb=null;this.zwg(Ma.data,!0,ja);var Ea=S.RtcUtils.deserialize(Ma.data.ee,"FindSession",null);if(Ea)if(Ea=this.bIl(Ea)){if(Ea.$bc&&Ea.o6&&Ea.rB){h.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.hs);this.Oak(Ma.data);I(Ea);return}ja.FindSessionFailureReason="FindSessionInvalidResponse";ja.IsRtcEnabled=Ea.$bc;ja.IsQueryStringEmpty=!Ea.o6;ja.IsConnectionStringEmpty=!Ea.rB;h.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.hs,Ea.$bc,!Ea.o6,!Ea.rB)}else ja.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",h.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.hs);else ja.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",h.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.hs);this.Bkh(ja,ka);sa(null)}}Jqh(aa,ja,I,sa=!1){return ka=>{O.a.instance.yqc(0,1);aa&&aa.stop();this.FSb=this.HMb=null;this.zwg(ka.data,!1,ja);let Ma=null;var Ea="unknown";let ma="unknown";ka.data&&((Ea=ka.data.yj)&&fa.Wrc in Ea&&(Ma=Ea[fa.Wrc].toString()),Ea=D.a[ka.data.status],ma=ka.data.Ke.toString());ja.FindSessionFailureReason="FindSessionRequestFailed";ja.HttpErrorCode=ma;ja.HttpErrorStatus=Ea;ja[fa.Wrc]=Ma;h.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
Ea,ma,this.hs,Ma,sa);this.Bkh(ja,sa);I(ma)}}V6f(aa,ja,I=!1){let sa=null;h.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.hs);const ka={};var Ma=this.ugf.g9i();ka[B.a.pDa]=G.a.create().toString();this.HMb&&""!==this.HMb?Ma=String.format("{0}&{1}={2}",Ma,da.a.DXe,this.HMb):this.FSb&&""!==this.FSb&&(Ma=String.format("{0}&{1}={2}",Ma,da.a.DXe,this.FSb),ka[Z.cTl]="True",ka[Z.g6j]="True");Ma=this.BYh+"?"+Ma;I&&(ka[ca.k5i]=L.V_k);const Ea={};Ea.IsNetworkOfflineBeforeSendRequest=
this.hi.eGa;Ea.HasAvailableConnectionsBeforeSendRequest=this.hi.lgg;Ea.MaxConnectionsAllowed=this.hi.h3g;Ea.IsRefreshMachineId=I;this.lUb&&!this.vgf?(this.jhj(this.Rqh(null,Ea,aa,ja,I),this.Jqh(null,Ea,ja,I)),this.vgf=!0):(this.ii&&(sa=this.ii.Ii("WebServiceCall","GetMachineIdFromTheServer")),C.FrequentLoggingMetrics.instance&&C.FrequentLoggingMetrics.instance.qH(2,0),0>this.hi.iW(Ma,1,null,ka,[fa.XNc,fa.Wrc,fa.gmc,fa.BXe,fa.Z4g,fa.U6g,fa.T6g],1,this.Rqh(sa,Ea,aa,ja,I),this.Jqh(sa,Ea,ja,I),null,null,
!1,null,this.h6b,"3",null,!0)&&(5<this.aUb&&200>this.aUb&&h.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.aUb),window.setTimeout(()=>{this.aUb++;ja("-1")},1E3)))}zwg(aa,ja,I){I||(I={});I.IsNetworkOfflineAfterRequestComplete=this.hi.eGa;I.IsRequestSucceeded=ja;aa&&(I.EnqueueTime=aa.OI,I.InvokedTime=aa.iu,I.CompletedTime=aa.wv,aa.yj&&(fa.XNc in aa.yj&&(I.CorrelationId=aa.yj[fa.XNc]),fa.gmc in aa.yj&&(I[fa.gmc]=
aa.yj[fa.gmc])));h.ULS.sendTraceTag(38633565,500,ja?50:15,S.RtcUtils.FIb(I))}Bkh(aa,ja){aa||(aa={});aa.ConnectionState=m.a[this.Oya];ja||this.Fl.Akh(1,aa)}Oak(aa){try{var ja=!1,I=!1,sa=aa.yj,ka=v.a.wB(aa.request.get_url());if(sa&&fa.BXe in sa){const Ca=sa[fa.BXe].toString().toLocaleLowerCase();I="true"===Ca;ja="false"===Ca}sa=!1;const va=0<=ka.toLocaleLowerCase().indexOf("collab");I&&!va?sa=!0:ja&&va&&(sa=!0);if(sa){ja={};ja.HostName=ka;ja.Status=D.a[aa.status];ja.HttpStatus=aa.Ke.toString();var Ma=
aa.request.get_headers();for(let Ca in Ma){var Ea=Ma[Ca];(ka=Ca)&&0<ka.length&&(I=0,Ea&&(I=Ea.toString().length),ja["r_"+ka]=I)}if(aa.yj){const Ca=new r.a;Ca.add(fa.XNc);Ca.add(fa.gmc);Ca.add(fa.Wrc);Ca.add(fa.U6g);Ca.add(fa.T6g);Ca.add(fa.Z4g);fa.xdi(ja,aa.yj,Ca)}fa.sdi(aa.request.get_url(),ja);var ma=w.a.toJSON(ja);h.ULS.sendTraceTag(559437006,500,15,ma)}}catch(va){h.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",va.toString())}}static createInstance(aa,ja,I,sa,ka,Ma,
Ea,ma,va,Ca,oa,Da=null){return fa.yOc(aa,ja,I,sa,ka,Ma,Ea,ma,va,Ca,null,oa,Da)}static RLi(aa,ja,I,sa,ka,Ma,Ea,ma,va,Ca,oa=null){return fa.yOc(aa,ja,I,sa,ka,3,Ma,Ea,ma,va,Ca,oa,null)}static yOc(aa,ja,I,sa,ka,Ma,Ea,ma,va,Ca,oa,Da,ta=null){aa=aa||G.a.create().toString();aa=new fa(aa,ja,I,sa,ka,Ma,Ea,ma,va,Ca,oa,Da,ta);aa.init();return aa}static xdi(aa,ja,I){for(let sa of I)sa in ja&&(aa[sa]=ja[sa])}static sdi(aa,ja){if(aa){var I=aa.indexOf("?");if(-1!==I)for(aa=aa.substr(I+1).split("&"),I=0;I<aa.length;++I){var sa=
aa[I].split("=");if(2===sa.length){const ka=sa[0];if(ka&&0<ka.length){let Ma=0;if(sa=sa[1])Ma=sa.length;ja["q_"+ka]=Ma}}}}}}fa.Skj=3E3;fa.Xuk=3E5;fa.HBi="1.0";fa.Gjg=1E3;fa.XNc="X-CorrelationId";fa.g0d="corrid";fa.Wrc="RtcErrorCode";fa.gmc="X-OfficeCluster";fa.BXe="X-NewEnv";fa.Z4g="X-MSEdge-Ref";fa.T6g="X-OFFICEFD";fa.U6g="X-OfficeFE";Object(K.a)(fa,"FindSessionStrategy",null,[1147])},743:function(K,U,d){K=d(0);class h{constructor(){this.ocf=this.FCd=!1;this.callback=null}tmc(r){this.callback=r;
this.GJh()}D2g(r){this.FCd||(this.FCd=!0,this.XVh=r,this.GJh())}GJh(){this.FCd&&this.callback&&!this.ocf&&(this.ocf=!0,this.callback(this.XVh))}}Object(K.a)(h,"CompletionTask",null,[]);d.d(U,"a",function(){return e});class e{constructor(){this.snf=new h;this.qnf=new h}ejd(r){this.snf.tmc(r)}djd(r){this.qnf.tmc(r)}clc(r){this.snf.D2g(r)}LZa(r){this.qnf.D2g(r)}fIe(){this.clc(2);this.LZa(2)}}Object(K.a)(e,"MessageStatus",null,[1208])}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/19809348/wdjs/ppteditDS.presence1.js.map